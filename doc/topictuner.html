<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.1"/>
    <title>topictuner.topictuner API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#paramPair">paramPair</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#paramPair.__init__">paramPair</a>
                        </li>
                        <li>
                                <a class="variable" href="#paramPair.cs">cs</a>
                        </li>
                        <li>
                                <a class="variable" href="#paramPair.ss">ss</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#BaseHDBSCANTuner">BaseHDBSCANTuner</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.__init__">BaseHDBSCANTuner</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.runHDBSCAN">runHDBSCAN</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.randomSearch">randomSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.psuedoGridSearch">psuedoGridSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.simpleSearch">simpleSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.gridSearch">gridSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.visualizeSearch">visualizeSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.summarizeResults">summarizeResults</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.clearSearches">clearSearches</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.createVizReduction">createVizReduction</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.getVizCoords">getVizCoords</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseHDBSCANTuner.visualizeEmbeddings">visualizeEmbeddings</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TopicModelTuner">TopicModelTuner</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TopicModelTuner.__init__">TopicModelTuner</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.wrapBERTopicModel">wrapBERTopicModel</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.getBERTopicModel">getBERTopicModel</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.createEmbeddings">createEmbeddings</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.reduce">reduce</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.createVizReduction">createVizReduction</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.getVizCoords">getVizCoords</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.visualizeEmbeddings">visualizeEmbeddings</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.load">load</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
topictuner<wbr>.topictuner    </h1>

                
                        <input id="mod-topictuner-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-topictuner-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span> <span class="nn">umap</span> <span class="kn">import</span> <span class="n">UMAP</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">hdbscan</span> <span class="kn">import</span> <span class="n">HDBSCAN</span>         
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">wrap</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">joblib</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randrange</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="n">paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">BaseHDBSCANTuner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>                 <span class="n">HDBSCAN_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1">#: an HDBSCAN instance</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>                 <span class="n">target_vectors</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># vectors to be clustered</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>                 <span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># 2D reduction of the target_vectors</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> 
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>        
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN_model</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span> <span class="o">=</span> <span class="n">target_vectors</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># A running collection of all the parameters and results if a DataFrame</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span><span class="p">,</span> <span class="c1"># a 2D reduction of the embeddings used for visualization</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="c1"># self._paramPair = namedtuple(&#39;paramPair&#39;, &#39;cs ss&#39;) # Used internally to enhance readability</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">paramPair</span>        
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__bestParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>    <span class="k">def</span> <span class="nf">_check_CS_SS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>      <span class="k">if</span> <span class="n">min_cluster_size</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set min_cluster_size==None&#39;</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>      <span class="k">if</span> <span class="n">min_cluster_size</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;min_cluster_size must be more than 1&#39;</span><span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>      <span class="k">if</span> <span class="p">(</span><span class="n">min_samples</span> <span class="o">&gt;</span> <span class="n">min_cluster_size</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;min_samples must be equal or less than min_cluster_size&#39;</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>      <span class="c1"># if (self.bestParams.cs == None) &amp; (self.bestParams.ss == None) :</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>      <span class="c1">#     raise ValueError(&#39;min_cluster_size and min_samples must be set (no default (best) values set for this model)&#39;)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>      <span class="c1"># if min_cluster_size == None : </span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>      <span class="c1">#   min_cluster_size = self.bestParams.cs # go ahead and set - bestParams is either None or a better value</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>      <span class="c1">#   min_samples = self.bestParams.ss # go ahead and set - if min_cluster_size was None then this has to be None or a better value</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>      <span class="k">return</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="nd">@property</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="nf">bestParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bestParams</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="c1"># @bestParams.setter</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="c1"># def bestParams(self, min_cluster_size: int, sample_size: int=None):</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="c1">#    self.__bestParams.cs, self.__bestParams.ss = self._check_CS_SS(min_cluster_size, sample_size)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    <span class="nd">@bestParams</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="k">def</span> <span class="nf">bestParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="n">cs</span><span class="p">,</span> <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_CS_SS</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__bestParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">runHDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">      Cluster reduced embeddings. min_samples must be more than 0 and less than</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">      or equal to min_cluster_size.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>      <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_CS_SS</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>          
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="n">hdbscan_params</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="o">**</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_cluster_size</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_samples</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>  
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>      <span class="k">return</span> <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span><span class="p">)</span>  
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">randomSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_samples_pct_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">      Run a passel of HDBSCAN within a given range of parameters.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">      cluster_size_range is a list of ints and min_samples_pct_range is a list of percentage</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">      values in decimal form e.g. [.1, .25, .50, .75, 1]. </span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">      </span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">      This function will randomly select a min_cluster_size  and a min_samples percent</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">      value from the supplied values. The min_samples percent will be used to calculate</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">      the min_samples parameter to be used. That value will be rounded up to 1 if less than 1</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">      and cannot be larger than the selected cluster_size.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">      All of the search results will be added to TMT.ResultsDF and a separate DataFrame containing</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">      just the results from this search will be returned to the caller.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genRandomSearchParams</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">min_samples_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">psuedoGridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_samples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">      Note that this is not a really a grid search. Rather this function will use each value</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">      in cluster_sizes to initiate a clustering on each percent value in min_sampless. For </span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">      example if the values are [*range(100,102)] and [val/100 for val in [*range(10, 101 ,10)]], a clustering for </span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">      each percentage value in min_sampless for each value in cluster_sizes would be run</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">      for a total of 20 clusterings (cluster sizes 100 and 101 * percent values of those for 10%, 20%, 30%,...100%).</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genGridSearchParams</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">simpleSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_sampless</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">      A clustering for each value in cluster_sizes will be run using the corresponding min_sampless </span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">      value. The len of each list must be the same. Each cluster_size must be &gt; 0 and min_samples must </span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">      be &gt;0 and &lt;= cluster_size.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_sampless</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length of cluster sizes and samples sizes lists must match&#39;</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">min_sampless</span><span class="p">)])</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">gridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchRange</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="p">:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">      For any n (int) in searchRange, generates all possible min_samples values (1 to n) and performs</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">      the search.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>      <span class="n">cs_list</span><span class="p">,</span> <span class="n">ss_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>      <span class="k">for</span> <span class="n">cs_val</span> <span class="ow">in</span> <span class="n">searchRange</span> <span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>          <span class="k">for</span> <span class="n">ss_val</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cs_val</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="p">:</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>            <span class="n">cs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs_val</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>            <span class="n">ss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss_val</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simpleSearch</span><span class="p">(</span><span class="n">cs_list</span><span class="p">,</span> <span class="n">ss_list</span><span class="p">)</span> 
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                   
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">visualizeSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultsDF</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">      Returns a plotly fig of a parrallel coordinates graph of the searches performed on this instance. </span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>          <span class="n">resultsDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>      <span class="k">return</span> <span class="n">px</span><span class="o">.</span><span class="n">parallel_coordinates</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">,</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> 
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                                    <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                                            <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">,</span> 
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                                            <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">:</span> <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>                                            <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">:</span> <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> <span class="p">},)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>  
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">summarizeResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summaryDF</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">      Takes DataFrame of results and returns a DataFrame containing only one record for </span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">      each value of number of clusters. Returns the record with the lowest number of </span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">      uncategorized documents. By default runs against self.ResultsDF - the aggregation of all</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">      searches run for this model.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>          <span class="n">summaryDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No searches run on this TMT instance, or DF to summarize is None&quot;</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>      <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>      <span class="k">for</span> <span class="n">num_clusters</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="p">:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">resultSummaryDF</span><span class="p">,</span> <span class="n">summaryDF</span><span class="p">[</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">num_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]])</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>      <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>      <span class="k">return</span> <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">])</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>  
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">clearSearches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        A convenience function that resets the saved searches</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;UMAP&#39;</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>      <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;UMAP&#39;</span> <span class="p">:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>      <span class="k">else</span> <span class="p">:</span> <span class="c1"># Only TSNE is supported</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a> 
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>      
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided HDBSCAN parameters.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">      If TMT.docs has been set then the first 400 chars of each document will be shown as a </span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">      hover over each data point.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">  </span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">      &#39;&#39;&#39;</span>  
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>      
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>          
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>  
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">_genRandomSearchParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">min_samples_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="n">searchParams</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="n">searchParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">))],</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>                                            <span class="n">min_samples_pct_range</span><span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">min_samples_pct_range</span><span class="p">))]</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>                                           <span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">searchParams</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">_genGridSearchParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">min_samples_pct_range</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>      <span class="k">for</span> <span class="n">cluster_size</span> <span class="ow">in</span> <span class="n">cluster_sizes</span> <span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="k">for</span> <span class="n">min_samples_pct</span> <span class="ow">in</span> <span class="n">min_samples_pct_range</span> <span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>          <span class="n">searchParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">,</span> <span class="n">min_samples_pct</span><span class="p">))</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>      <span class="k">return</span> <span class="n">searchParams</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="k">def</span> <span class="nf">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size</span><span class="p">,</span> <span class="n">min_samples_pct</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">min_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cluster_size</span> <span class="o">*</span> <span class="n">min_samples_pct</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="n">min_samples</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>          <span class="n">min_samples</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>       
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>    <span class="k">def</span> <span class="nf">_runTests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchParams</span><span class="p">):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">      Runs a passel of HDBSCAN clusterings for searchParams</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">))</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)]</span> 
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">))</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">searchParams</span><span class="p">]</span> 
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>      <span class="n">RunResultsDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tupe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;min_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tupe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tupe</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>      <span class="n">uncategorized</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>      <span class="k">for</span> <span class="n">aDict</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tupe</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span> <span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">aDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">uncategorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aDict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="n">uncategorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncategorized</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span><span class="p">,</span> <span class="n">RunResultsDF</span><span class="p">])</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>  
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>      <span class="k">return</span> <span class="n">RunResultsDF</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="k">class</span> <span class="nc">TopicModelTuner</span><span class="p">(</span><span class="n">BaseHDBSCANTuner</span><span class="p">):</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">    TopicModelTuner (TMT) is a tool to optimize the min_clust_size and min_sample parameters </span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">    of HDBSCAN. It is a compliment to the BERTopic default configuration and assumes that </span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">    HDBSCAN is being used to cluster UMAP reductions of embeddings. </span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">    </span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">    The convenience function TMT.wrapBERTopicModel() returns a TMT instance initialized </span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">    with the provided BERTopic model&#39;s embedding model, HDBSCAN and UMAP instances and</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">    parameters. </span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">    </span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">    Alternatively a new TMT instance can be created from scratch and, in either case, </span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">    once the optimized parameters have been identified, calling TMT.getBERTopicModel()</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">    returns a configured BERTopic instance with the desired parameters.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">    </span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    TMT does not explicitly provide functionality for testing alternative UMAP parameters or</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">    HDBSCAN parameters other than min_cluster_size or min_samples. However both the HDBSCAN</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">    and UMAP models are exposed within the class and can be set to any parameters desired. </span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                 <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># pre-generated embeddings</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                 <span class="n">embedding_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># set for alternative transformer embedding model</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                 <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># can be set here or when embeddings are created manually</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                 <span class="n">reducer_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># a UMAP instance</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                 <span class="n">reducer_random_state</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                 <span class="n">reducer_components</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>                 <span class="n">reduced_embeddings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                 <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># an HDBSCAN instance</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                 <span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="c1">#: for UMAP</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>      <span class="n">BaseHDBSCANTuner</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                   <span class="n">HDBSCAN_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                   <span class="n">target_vectors</span> <span class="o">=</span> <span class="n">reduced_embeddings</span><span class="p">,</span> <span class="c1"># Set the reduced embeddings to be clustered </span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                   <span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span><span class="p">,</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>                   <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">      Unless explicitly set, TMT Uses the same default param defaults for the embedding model </span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">      as well as HDBSCAN and UMAP parameters as are used in the BERTopic defaults. </span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">      - &#39;all-MiniLM-L6-v2&#39; sentence transformer as the default language model embedding.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">      - UMAP - metric=&#39;cosine&#39;, n_neighbors=5, min_dist=0.0</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">      - HDBSCAN - metric=&#39;euclidean&#39;, cluster_selection_method=&#39;eom&#39;, prediction_data=True,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">                  min_cluster_size = 10.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">      </span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">      Options include:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">      - Using your own embeddings by setting TMT.embeddings after creating an instance</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">      - Using different UMAP settings or a different dimensional reduction method by setting TMT.reducer_model</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">      - Using different HDBSCAN parameters by setting TMT.hdbscan_model</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">      These can be set in the constructor or after instantiation by setting the instance variables </span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">      before generating the embeddings or reduction.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">      Unlike BERTopic, TMT has an option for saving both embeddings and the doc corpus - or optionally</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">      omitting them.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>      
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span> 
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">reducer_model</span> <span class="c1"># Used to reduce the embeddings (if necessary)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span> <span class="o">=</span> <span class="n">reducer_components</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="n">reducer_random_state</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># A reducer (defaults to UMAP to create a 2D reduction for a</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                              <span class="c1"># scatter plot visualization of the embeddings</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>      
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>      <span class="k">if</span> <span class="n">embedding_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s1">&#39;all-MiniLM-L6-v2&#39;</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">embedding_model</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>      <span class="k">if</span> <span class="n">reducer_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># Use default BERTopic params </span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="p">,</span> 
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                                    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> 
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                                    <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                                    <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                                    <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>      <span class="c1"># Default BERTopic params</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                             <span class="s1">&#39;cluster_selection_method&#39;</span><span class="p">:</span> <span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>                             <span class="s1">&#39;prediction_data&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>                             <span class="s1">&#39;min_cluster_size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                             <span class="p">}</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="k">def</span> <span class="nf">wrapBERTopicModel</span><span class="p">(</span><span class="n">BERTopicModel</span> <span class="p">:</span> <span class="n">BERTopic</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">      This is a helper function which returns a TMT instance using the values from a BERTopic instance.</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>  
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>      <span class="k">return</span> <span class="n">TopicModelTuner</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>                               <span class="n">reducer_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">umap_model</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>                               <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>                            <span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="k">def</span> <span class="nf">getBERTopicModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">      Returns a BERTopic model with the specified HDBSCAN parameters. The user is left</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">      to specify their chosen best settings after running a series of parameters searches.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">      </span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">      This function is necessary because any given HDBSCAN parameters will return somewhat different </span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">      results when clustering a given UMAP reduction, simply using the parameters derived from a tuned</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">      TMT model will not produce the same results for a new BERTopic instance. </span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">      </span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">      The reason for this is that BERTopic re-runs UMAP each time fit() is </span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">      called. Since different runs of UMAP will have  different characteristics, to recreate</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">      the desired results in the new BERTopic model we need to use the same random seed for the BERTopic&#39;s UMAP</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">      as was used in the TMT model.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>      
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>      <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_CS_SS</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>      <span class="n">hdbscan_params</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>      <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>      <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>      <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="o">**</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>      <span class="k">return</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">umap_model</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">),</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                      <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>    
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>    <span class="k">def</span> <span class="nf">createEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">      Create embeddings </span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>      <span class="c1"># if self.embeddings != None :</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Embeddings already created, reset by setting TMT.embeddings=None&#39;</span><span class="p">)</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Docs not specified, set docs=&#39;</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">=</span><span class="n">docs</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>             
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>    
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">        Reduce dimensionality of the embeddings</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings set, call TMT.createEmbeddings() or set TMT.embeddings=&#39;</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>  
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="c1"># The reducer has already set a random_state</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="k">else</span> <span class="p">:</span>  
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>          <span class="n">random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="c1"># could be None</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>          <span class="k">if</span> <span class="n">random_state</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>  <span class="c1"># Reducer random state was not set but tmt random state was</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>  <span class="c1"># set reducer model random state</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>          <span class="k">else</span> <span class="p">:</span> <span class="c1"># set new random state and capture it</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span> <span class="c1"># new value</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="c1"># sync TMT random state</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>    
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span> 
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;UMAP&#39;</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>      <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;UMAP&#39;</span> <span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>      <span class="k">else</span> <span class="p">:</span> <span class="c1"># Only TSNE is supported</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a> 
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>      
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided HDBSCAN parameters.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">      If TMT.docs has been set then the first 400 chars of each document will be shown as a </span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">      hover over each data point.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">  </span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">      &#39;&#39;&#39;</span>  
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>      
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>          
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>             <span class="n">fname</span><span class="p">,</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>             <span class="n">save_docs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>             <span class="n">save_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>             <span class="n">save_viz_reducer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">      Saves the TMT object. User can choose whether or not to save docs, embeddings and/or</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">      the viz reduction</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>      
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>      <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>      <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>      <span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="kc">None</span> 
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_docs</span> <span class="p">:</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embeddings</span> <span class="p">:</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_viz_reducer</span> <span class="p">:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>          <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>          
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span> 
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>     
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>    <span class="nd">@staticmethod</span>    
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">      Restore a saved TMT object from disk</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>      
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>    
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="n">restored</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="n">restored</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span> 
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="k">return</span> <span class="n">restored</span>
</span></pre></div>


            </section>
                <section id="paramPair">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">paramPair</span><wbr>(<span class="base">builtins.tuple</span>):

        
    </div>
    <a class="headerlink" href="#paramPair"></a>
    
            <div class="docstring"><p>paramPair(cs, ss)</p>
</div>


                            <div id="paramPair.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">paramPair</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">cs</span>, </span><span class="param"><span class="n">ss</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#paramPair.__init__"></a>
    
            <div class="docstring"><p>Create new instance of paramPair(cs, ss)</p>
</div>


                            </div>
                            <div id="paramPair.cs" class="classattr">
                                <div class="attr variable">
            <span class="name">cs</span>

        
    </div>
    <a class="headerlink" href="#paramPair.cs"></a>
    
            <div class="docstring"><p>Alias for field number 0</p>
</div>


                            </div>
                            <div id="paramPair.ss" class="classattr">
                                <div class="attr variable">
            <span class="name">ss</span>

        
    </div>
    <a class="headerlink" href="#paramPair.ss"></a>
    
            <div class="docstring"><p>Alias for field number 1</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.tuple</dt>
                                <dd id="paramPair.index" class="function">index</dd>
                <dd id="paramPair.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="BaseHDBSCANTuner">
                            <input id="BaseHDBSCANTuner-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BaseHDBSCANTuner</span>:

                <label class="view-source-button" for="BaseHDBSCANTuner-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner-20"><a href="#BaseHDBSCANTuner-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">BaseHDBSCANTuner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="BaseHDBSCANTuner-21"><a href="#BaseHDBSCANTuner-21"><span class="linenos"> 21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner-22"><a href="#BaseHDBSCANTuner-22"><span class="linenos"> 22</span></a>                 <span class="n">HDBSCAN_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1">#: an HDBSCAN instance</span>
</span><span id="BaseHDBSCANTuner-23"><a href="#BaseHDBSCANTuner-23"><span class="linenos"> 23</span></a>                 <span class="n">target_vectors</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># vectors to be clustered</span>
</span><span id="BaseHDBSCANTuner-24"><a href="#BaseHDBSCANTuner-24"><span class="linenos"> 24</span></a>                 <span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># 2D reduction of the target_vectors</span>
</span><span id="BaseHDBSCANTuner-25"><a href="#BaseHDBSCANTuner-25"><span class="linenos"> 25</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> 
</span><span id="BaseHDBSCANTuner-26"><a href="#BaseHDBSCANTuner-26"><span class="linenos"> 26</span></a>        
</span><span id="BaseHDBSCANTuner-27"><a href="#BaseHDBSCANTuner-27"><span class="linenos"> 27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN_model</span>
</span><span id="BaseHDBSCANTuner-28"><a href="#BaseHDBSCANTuner-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span> <span class="o">=</span> <span class="n">target_vectors</span>
</span><span id="BaseHDBSCANTuner-29"><a href="#BaseHDBSCANTuner-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="BaseHDBSCANTuner-30"><a href="#BaseHDBSCANTuner-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="BaseHDBSCANTuner-31"><a href="#BaseHDBSCANTuner-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># A running collection of all the parameters and results if a DataFrame</span>
</span><span id="BaseHDBSCANTuner-32"><a href="#BaseHDBSCANTuner-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span><span class="p">,</span> <span class="c1"># a 2D reduction of the embeddings used for visualization</span>
</span><span id="BaseHDBSCANTuner-33"><a href="#BaseHDBSCANTuner-33"><span class="linenos"> 33</span></a>
</span><span id="BaseHDBSCANTuner-34"><a href="#BaseHDBSCANTuner-34"><span class="linenos"> 34</span></a>        
</span><span id="BaseHDBSCANTuner-35"><a href="#BaseHDBSCANTuner-35"><span class="linenos"> 35</span></a>        <span class="c1"># self._paramPair = namedtuple(&#39;paramPair&#39;, &#39;cs ss&#39;) # Used internally to enhance readability</span>
</span><span id="BaseHDBSCANTuner-36"><a href="#BaseHDBSCANTuner-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">paramPair</span>        
</span><span id="BaseHDBSCANTuner-37"><a href="#BaseHDBSCANTuner-37"><span class="linenos"> 37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__bestParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-38"><a href="#BaseHDBSCANTuner-38"><span class="linenos"> 38</span></a>    
</span><span id="BaseHDBSCANTuner-39"><a href="#BaseHDBSCANTuner-39"><span class="linenos"> 39</span></a>    <span class="k">def</span> <span class="nf">_check_CS_SS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="BaseHDBSCANTuner-40"><a href="#BaseHDBSCANTuner-40"><span class="linenos"> 40</span></a>
</span><span id="BaseHDBSCANTuner-41"><a href="#BaseHDBSCANTuner-41"><span class="linenos"> 41</span></a>      <span class="k">if</span> <span class="n">min_cluster_size</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-42"><a href="#BaseHDBSCANTuner-42"><span class="linenos"> 42</span></a>          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set min_cluster_size==None&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-43"><a href="#BaseHDBSCANTuner-43"><span class="linenos"> 43</span></a>      <span class="k">if</span> <span class="n">min_cluster_size</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-44"><a href="#BaseHDBSCANTuner-44"><span class="linenos"> 44</span></a>          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;min_cluster_size must be more than 1&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-45"><a href="#BaseHDBSCANTuner-45"><span class="linenos"> 45</span></a>      <span class="k">if</span> <span class="p">(</span><span class="n">min_samples</span> <span class="o">&gt;</span> <span class="n">min_cluster_size</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-46"><a href="#BaseHDBSCANTuner-46"><span class="linenos"> 46</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;min_samples must be equal or less than min_cluster_size&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-47"><a href="#BaseHDBSCANTuner-47"><span class="linenos"> 47</span></a>
</span><span id="BaseHDBSCANTuner-48"><a href="#BaseHDBSCANTuner-48"><span class="linenos"> 48</span></a>      <span class="c1"># if (self.bestParams.cs == None) &amp; (self.bestParams.ss == None) :</span>
</span><span id="BaseHDBSCANTuner-49"><a href="#BaseHDBSCANTuner-49"><span class="linenos"> 49</span></a>      <span class="c1">#     raise ValueError(&#39;min_cluster_size and min_samples must be set (no default (best) values set for this model)&#39;)</span>
</span><span id="BaseHDBSCANTuner-50"><a href="#BaseHDBSCANTuner-50"><span class="linenos"> 50</span></a>
</span><span id="BaseHDBSCANTuner-51"><a href="#BaseHDBSCANTuner-51"><span class="linenos"> 51</span></a>      <span class="c1"># if min_cluster_size == None : </span>
</span><span id="BaseHDBSCANTuner-52"><a href="#BaseHDBSCANTuner-52"><span class="linenos"> 52</span></a>      <span class="c1">#   min_cluster_size = self.bestParams.cs # go ahead and set - bestParams is either None or a better value</span>
</span><span id="BaseHDBSCANTuner-53"><a href="#BaseHDBSCANTuner-53"><span class="linenos"> 53</span></a>      <span class="c1">#   min_samples = self.bestParams.ss # go ahead and set - if min_cluster_size was None then this has to be None or a better value</span>
</span><span id="BaseHDBSCANTuner-54"><a href="#BaseHDBSCANTuner-54"><span class="linenos"> 54</span></a>
</span><span id="BaseHDBSCANTuner-55"><a href="#BaseHDBSCANTuner-55"><span class="linenos"> 55</span></a>      <span class="k">return</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span>
</span><span id="BaseHDBSCANTuner-56"><a href="#BaseHDBSCANTuner-56"><span class="linenos"> 56</span></a>
</span><span id="BaseHDBSCANTuner-57"><a href="#BaseHDBSCANTuner-57"><span class="linenos"> 57</span></a>    <span class="nd">@property</span>
</span><span id="BaseHDBSCANTuner-58"><a href="#BaseHDBSCANTuner-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="nf">bestParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BaseHDBSCANTuner-59"><a href="#BaseHDBSCANTuner-59"><span class="linenos"> 59</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bestParams</span>
</span><span id="BaseHDBSCANTuner-60"><a href="#BaseHDBSCANTuner-60"><span class="linenos"> 60</span></a>
</span><span id="BaseHDBSCANTuner-61"><a href="#BaseHDBSCANTuner-61"><span class="linenos"> 61</span></a>    <span class="c1"># @bestParams.setter</span>
</span><span id="BaseHDBSCANTuner-62"><a href="#BaseHDBSCANTuner-62"><span class="linenos"> 62</span></a>    <span class="c1"># def bestParams(self, min_cluster_size: int, sample_size: int=None):</span>
</span><span id="BaseHDBSCANTuner-63"><a href="#BaseHDBSCANTuner-63"><span class="linenos"> 63</span></a>    <span class="c1">#    self.__bestParams.cs, self.__bestParams.ss = self._check_CS_SS(min_cluster_size, sample_size)</span>
</span><span id="BaseHDBSCANTuner-64"><a href="#BaseHDBSCANTuner-64"><span class="linenos"> 64</span></a>
</span><span id="BaseHDBSCANTuner-65"><a href="#BaseHDBSCANTuner-65"><span class="linenos"> 65</span></a>    <span class="nd">@bestParams</span><span class="o">.</span><span class="n">setter</span>
</span><span id="BaseHDBSCANTuner-66"><a href="#BaseHDBSCANTuner-66"><span class="linenos"> 66</span></a>    <span class="k">def</span> <span class="nf">bestParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="BaseHDBSCANTuner-67"><a href="#BaseHDBSCANTuner-67"><span class="linenos"> 67</span></a>        <span class="n">cs</span><span class="p">,</span> <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_CS_SS</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="BaseHDBSCANTuner-68"><a href="#BaseHDBSCANTuner-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__bestParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-69"><a href="#BaseHDBSCANTuner-69"><span class="linenos"> 69</span></a>            
</span><span id="BaseHDBSCANTuner-70"><a href="#BaseHDBSCANTuner-70"><span class="linenos"> 70</span></a>    <span class="k">def</span> <span class="nf">runHDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-71"><a href="#BaseHDBSCANTuner-71"><span class="linenos"> 71</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-72"><a href="#BaseHDBSCANTuner-72"><span class="linenos"> 72</span></a><span class="sd">      Cluster reduced embeddings. min_samples must be more than 0 and less than</span>
</span><span id="BaseHDBSCANTuner-73"><a href="#BaseHDBSCANTuner-73"><span class="linenos"> 73</span></a><span class="sd">      or equal to min_cluster_size.</span>
</span><span id="BaseHDBSCANTuner-74"><a href="#BaseHDBSCANTuner-74"><span class="linenos"> 74</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-75"><a href="#BaseHDBSCANTuner-75"><span class="linenos"> 75</span></a>      <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_CS_SS</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-76"><a href="#BaseHDBSCANTuner-76"><span class="linenos"> 76</span></a>          
</span><span id="BaseHDBSCANTuner-77"><a href="#BaseHDBSCANTuner-77"><span class="linenos"> 77</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-78"><a href="#BaseHDBSCANTuner-78"><span class="linenos"> 78</span></a>        <span class="n">hdbscan_params</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-79"><a href="#BaseHDBSCANTuner-79"><span class="linenos"> 79</span></a>        <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="BaseHDBSCANTuner-80"><a href="#BaseHDBSCANTuner-80"><span class="linenos"> 80</span></a>        <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="BaseHDBSCANTuner-81"><a href="#BaseHDBSCANTuner-81"><span class="linenos"> 81</span></a>        <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="o">**</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-82"><a href="#BaseHDBSCANTuner-82"><span class="linenos"> 82</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-83"><a href="#BaseHDBSCANTuner-83"><span class="linenos"> 83</span></a>        <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-84"><a href="#BaseHDBSCANTuner-84"><span class="linenos"> 84</span></a>        <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_cluster_size</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="BaseHDBSCANTuner-85"><a href="#BaseHDBSCANTuner-85"><span class="linenos"> 85</span></a>        <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_samples</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="BaseHDBSCANTuner-86"><a href="#BaseHDBSCANTuner-86"><span class="linenos"> 86</span></a>  
</span><span id="BaseHDBSCANTuner-87"><a href="#BaseHDBSCANTuner-87"><span class="linenos"> 87</span></a>      <span class="k">return</span> <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span><span class="p">)</span>  
</span><span id="BaseHDBSCANTuner-88"><a href="#BaseHDBSCANTuner-88"><span class="linenos"> 88</span></a>
</span><span id="BaseHDBSCANTuner-89"><a href="#BaseHDBSCANTuner-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">randomSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_samples_pct_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-90"><a href="#BaseHDBSCANTuner-90"><span class="linenos"> 90</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-91"><a href="#BaseHDBSCANTuner-91"><span class="linenos"> 91</span></a><span class="sd">      Run a passel of HDBSCAN within a given range of parameters.</span>
</span><span id="BaseHDBSCANTuner-92"><a href="#BaseHDBSCANTuner-92"><span class="linenos"> 92</span></a><span class="sd">      cluster_size_range is a list of ints and min_samples_pct_range is a list of percentage</span>
</span><span id="BaseHDBSCANTuner-93"><a href="#BaseHDBSCANTuner-93"><span class="linenos"> 93</span></a><span class="sd">      values in decimal form e.g. [.1, .25, .50, .75, 1]. </span>
</span><span id="BaseHDBSCANTuner-94"><a href="#BaseHDBSCANTuner-94"><span class="linenos"> 94</span></a><span class="sd">      </span>
</span><span id="BaseHDBSCANTuner-95"><a href="#BaseHDBSCANTuner-95"><span class="linenos"> 95</span></a><span class="sd">      This function will randomly select a min_cluster_size  and a min_samples percent</span>
</span><span id="BaseHDBSCANTuner-96"><a href="#BaseHDBSCANTuner-96"><span class="linenos"> 96</span></a><span class="sd">      value from the supplied values. The min_samples percent will be used to calculate</span>
</span><span id="BaseHDBSCANTuner-97"><a href="#BaseHDBSCANTuner-97"><span class="linenos"> 97</span></a><span class="sd">      the min_samples parameter to be used. That value will be rounded up to 1 if less than 1</span>
</span><span id="BaseHDBSCANTuner-98"><a href="#BaseHDBSCANTuner-98"><span class="linenos"> 98</span></a><span class="sd">      and cannot be larger than the selected cluster_size.</span>
</span><span id="BaseHDBSCANTuner-99"><a href="#BaseHDBSCANTuner-99"><span class="linenos"> 99</span></a>
</span><span id="BaseHDBSCANTuner-100"><a href="#BaseHDBSCANTuner-100"><span class="linenos">100</span></a><span class="sd">      All of the search results will be added to TMT.ResultsDF and a separate DataFrame containing</span>
</span><span id="BaseHDBSCANTuner-101"><a href="#BaseHDBSCANTuner-101"><span class="linenos">101</span></a><span class="sd">      just the results from this search will be returned to the caller.</span>
</span><span id="BaseHDBSCANTuner-102"><a href="#BaseHDBSCANTuner-102"><span class="linenos">102</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-103"><a href="#BaseHDBSCANTuner-103"><span class="linenos">103</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genRandomSearchParams</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">min_samples_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-104"><a href="#BaseHDBSCANTuner-104"><span class="linenos">104</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-105"><a href="#BaseHDBSCANTuner-105"><span class="linenos">105</span></a>
</span><span id="BaseHDBSCANTuner-106"><a href="#BaseHDBSCANTuner-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">psuedoGridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_samples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-107"><a href="#BaseHDBSCANTuner-107"><span class="linenos">107</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-108"><a href="#BaseHDBSCANTuner-108"><span class="linenos">108</span></a><span class="sd">      Note that this is not a really a grid search. Rather this function will use each value</span>
</span><span id="BaseHDBSCANTuner-109"><a href="#BaseHDBSCANTuner-109"><span class="linenos">109</span></a><span class="sd">      in cluster_sizes to initiate a clustering on each percent value in min_sampless. For </span>
</span><span id="BaseHDBSCANTuner-110"><a href="#BaseHDBSCANTuner-110"><span class="linenos">110</span></a><span class="sd">      example if the values are [*range(100,102)] and [val/100 for val in [*range(10, 101 ,10)]], a clustering for </span>
</span><span id="BaseHDBSCANTuner-111"><a href="#BaseHDBSCANTuner-111"><span class="linenos">111</span></a><span class="sd">      each percentage value in min_sampless for each value in cluster_sizes would be run</span>
</span><span id="BaseHDBSCANTuner-112"><a href="#BaseHDBSCANTuner-112"><span class="linenos">112</span></a><span class="sd">      for a total of 20 clusterings (cluster sizes 100 and 101 * percent values of those for 10%, 20%, 30%,...100%).</span>
</span><span id="BaseHDBSCANTuner-113"><a href="#BaseHDBSCANTuner-113"><span class="linenos">113</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-114"><a href="#BaseHDBSCANTuner-114"><span class="linenos">114</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genGridSearchParams</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-115"><a href="#BaseHDBSCANTuner-115"><span class="linenos">115</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-116"><a href="#BaseHDBSCANTuner-116"><span class="linenos">116</span></a>
</span><span id="BaseHDBSCANTuner-117"><a href="#BaseHDBSCANTuner-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">simpleSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_sampless</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-118"><a href="#BaseHDBSCANTuner-118"><span class="linenos">118</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-119"><a href="#BaseHDBSCANTuner-119"><span class="linenos">119</span></a><span class="sd">      A clustering for each value in cluster_sizes will be run using the corresponding min_sampless </span>
</span><span id="BaseHDBSCANTuner-120"><a href="#BaseHDBSCANTuner-120"><span class="linenos">120</span></a><span class="sd">      value. The len of each list must be the same. Each cluster_size must be &gt; 0 and min_samples must </span>
</span><span id="BaseHDBSCANTuner-121"><a href="#BaseHDBSCANTuner-121"><span class="linenos">121</span></a><span class="sd">      be &gt;0 and &lt;= cluster_size.</span>
</span><span id="BaseHDBSCANTuner-122"><a href="#BaseHDBSCANTuner-122"><span class="linenos">122</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-123"><a href="#BaseHDBSCANTuner-123"><span class="linenos">123</span></a>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_sampless</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-124"><a href="#BaseHDBSCANTuner-124"><span class="linenos">124</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length of cluster sizes and samples sizes lists must match&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-125"><a href="#BaseHDBSCANTuner-125"><span class="linenos">125</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">min_sampless</span><span class="p">)])</span>
</span><span id="BaseHDBSCANTuner-126"><a href="#BaseHDBSCANTuner-126"><span class="linenos">126</span></a>
</span><span id="BaseHDBSCANTuner-127"><a href="#BaseHDBSCANTuner-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">gridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchRange</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-128"><a href="#BaseHDBSCANTuner-128"><span class="linenos">128</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-129"><a href="#BaseHDBSCANTuner-129"><span class="linenos">129</span></a><span class="sd">      For any n (int) in searchRange, generates all possible min_samples values (1 to n) and performs</span>
</span><span id="BaseHDBSCANTuner-130"><a href="#BaseHDBSCANTuner-130"><span class="linenos">130</span></a><span class="sd">      the search.</span>
</span><span id="BaseHDBSCANTuner-131"><a href="#BaseHDBSCANTuner-131"><span class="linenos">131</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-132"><a href="#BaseHDBSCANTuner-132"><span class="linenos">132</span></a>      <span class="n">cs_list</span><span class="p">,</span> <span class="n">ss_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="BaseHDBSCANTuner-133"><a href="#BaseHDBSCANTuner-133"><span class="linenos">133</span></a>      <span class="k">for</span> <span class="n">cs_val</span> <span class="ow">in</span> <span class="n">searchRange</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-134"><a href="#BaseHDBSCANTuner-134"><span class="linenos">134</span></a>          <span class="k">for</span> <span class="n">ss_val</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cs_val</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-135"><a href="#BaseHDBSCANTuner-135"><span class="linenos">135</span></a>            <span class="n">cs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs_val</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-136"><a href="#BaseHDBSCANTuner-136"><span class="linenos">136</span></a>            <span class="n">ss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss_val</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-137"><a href="#BaseHDBSCANTuner-137"><span class="linenos">137</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simpleSearch</span><span class="p">(</span><span class="n">cs_list</span><span class="p">,</span> <span class="n">ss_list</span><span class="p">)</span> 
</span><span id="BaseHDBSCANTuner-138"><a href="#BaseHDBSCANTuner-138"><span class="linenos">138</span></a>                   
</span><span id="BaseHDBSCANTuner-139"><a href="#BaseHDBSCANTuner-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">visualizeSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultsDF</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-140"><a href="#BaseHDBSCANTuner-140"><span class="linenos">140</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-141"><a href="#BaseHDBSCANTuner-141"><span class="linenos">141</span></a><span class="sd">      Returns a plotly fig of a parrallel coordinates graph of the searches performed on this instance. </span>
</span><span id="BaseHDBSCANTuner-142"><a href="#BaseHDBSCANTuner-142"><span class="linenos">142</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-143"><a href="#BaseHDBSCANTuner-143"><span class="linenos">143</span></a>        
</span><span id="BaseHDBSCANTuner-144"><a href="#BaseHDBSCANTuner-144"><span class="linenos">144</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-145"><a href="#BaseHDBSCANTuner-145"><span class="linenos">145</span></a>          <span class="n">resultsDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span>
</span><span id="BaseHDBSCANTuner-146"><a href="#BaseHDBSCANTuner-146"><span class="linenos">146</span></a>
</span><span id="BaseHDBSCANTuner-147"><a href="#BaseHDBSCANTuner-147"><span class="linenos">147</span></a>      <span class="k">return</span> <span class="n">px</span><span class="o">.</span><span class="n">parallel_coordinates</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner-148"><a href="#BaseHDBSCANTuner-148"><span class="linenos">148</span></a>                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> 
</span><span id="BaseHDBSCANTuner-149"><a href="#BaseHDBSCANTuner-149"><span class="linenos">149</span></a>                                    <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner-150"><a href="#BaseHDBSCANTuner-150"><span class="linenos">150</span></a>                                            <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">,</span> 
</span><span id="BaseHDBSCANTuner-151"><a href="#BaseHDBSCANTuner-151"><span class="linenos">151</span></a>                                            <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">:</span> <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner-152"><a href="#BaseHDBSCANTuner-152"><span class="linenos">152</span></a>                                            <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">:</span> <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> <span class="p">},)</span>
</span><span id="BaseHDBSCANTuner-153"><a href="#BaseHDBSCANTuner-153"><span class="linenos">153</span></a>  
</span><span id="BaseHDBSCANTuner-154"><a href="#BaseHDBSCANTuner-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">summarizeResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summaryDF</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-155"><a href="#BaseHDBSCANTuner-155"><span class="linenos">155</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-156"><a href="#BaseHDBSCANTuner-156"><span class="linenos">156</span></a><span class="sd">      Takes DataFrame of results and returns a DataFrame containing only one record for </span>
</span><span id="BaseHDBSCANTuner-157"><a href="#BaseHDBSCANTuner-157"><span class="linenos">157</span></a><span class="sd">      each value of number of clusters. Returns the record with the lowest number of </span>
</span><span id="BaseHDBSCANTuner-158"><a href="#BaseHDBSCANTuner-158"><span class="linenos">158</span></a><span class="sd">      uncategorized documents. By default runs against self.ResultsDF - the aggregation of all</span>
</span><span id="BaseHDBSCANTuner-159"><a href="#BaseHDBSCANTuner-159"><span class="linenos">159</span></a><span class="sd">      searches run for this model.</span>
</span><span id="BaseHDBSCANTuner-160"><a href="#BaseHDBSCANTuner-160"><span class="linenos">160</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-161"><a href="#BaseHDBSCANTuner-161"><span class="linenos">161</span></a>
</span><span id="BaseHDBSCANTuner-162"><a href="#BaseHDBSCANTuner-162"><span class="linenos">162</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-163"><a href="#BaseHDBSCANTuner-163"><span class="linenos">163</span></a>          <span class="n">summaryDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span>
</span><span id="BaseHDBSCANTuner-164"><a href="#BaseHDBSCANTuner-164"><span class="linenos">164</span></a>
</span><span id="BaseHDBSCANTuner-165"><a href="#BaseHDBSCANTuner-165"><span class="linenos">165</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-166"><a href="#BaseHDBSCANTuner-166"><span class="linenos">166</span></a>          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No searches run on this TMT instance, or DF to summarize is None&quot;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-167"><a href="#BaseHDBSCANTuner-167"><span class="linenos">167</span></a>        
</span><span id="BaseHDBSCANTuner-168"><a href="#BaseHDBSCANTuner-168"><span class="linenos">168</span></a>      <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="BaseHDBSCANTuner-169"><a href="#BaseHDBSCANTuner-169"><span class="linenos">169</span></a>      <span class="k">for</span> <span class="n">num_clusters</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-170"><a href="#BaseHDBSCANTuner-170"><span class="linenos">170</span></a>        <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">resultSummaryDF</span><span class="p">,</span> <span class="n">summaryDF</span><span class="p">[</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">num_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]])</span>
</span><span id="BaseHDBSCANTuner-171"><a href="#BaseHDBSCANTuner-171"><span class="linenos">171</span></a>      <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-172"><a href="#BaseHDBSCANTuner-172"><span class="linenos">172</span></a>      <span class="k">return</span> <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">])</span>
</span><span id="BaseHDBSCANTuner-173"><a href="#BaseHDBSCANTuner-173"><span class="linenos">173</span></a>  
</span><span id="BaseHDBSCANTuner-174"><a href="#BaseHDBSCANTuner-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">clearSearches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BaseHDBSCANTuner-175"><a href="#BaseHDBSCANTuner-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseHDBSCANTuner-176"><a href="#BaseHDBSCANTuner-176"><span class="linenos">176</span></a><span class="sd">        A convenience function that resets the saved searches</span>
</span><span id="BaseHDBSCANTuner-177"><a href="#BaseHDBSCANTuner-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseHDBSCANTuner-178"><a href="#BaseHDBSCANTuner-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="BaseHDBSCANTuner-179"><a href="#BaseHDBSCANTuner-179"><span class="linenos">179</span></a>        
</span><span id="BaseHDBSCANTuner-180"><a href="#BaseHDBSCANTuner-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;UMAP&#39;</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-181"><a href="#BaseHDBSCANTuner-181"><span class="linenos">181</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-182"><a href="#BaseHDBSCANTuner-182"><span class="linenos">182</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="BaseHDBSCANTuner-183"><a href="#BaseHDBSCANTuner-183"><span class="linenos">183</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-184"><a href="#BaseHDBSCANTuner-184"><span class="linenos">184</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-185"><a href="#BaseHDBSCANTuner-185"><span class="linenos">185</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-186"><a href="#BaseHDBSCANTuner-186"><span class="linenos">186</span></a>
</span><span id="BaseHDBSCANTuner-187"><a href="#BaseHDBSCANTuner-187"><span class="linenos">187</span></a>      <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;UMAP&#39;</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-188"><a href="#BaseHDBSCANTuner-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-189"><a href="#BaseHDBSCANTuner-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="BaseHDBSCANTuner-190"><a href="#BaseHDBSCANTuner-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-191"><a href="#BaseHDBSCANTuner-191"><span class="linenos">191</span></a>      <span class="k">else</span> <span class="p">:</span> <span class="c1"># Only TSNE is supported</span>
</span><span id="BaseHDBSCANTuner-192"><a href="#BaseHDBSCANTuner-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-193"><a href="#BaseHDBSCANTuner-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-194"><a href="#BaseHDBSCANTuner-194"><span class="linenos">194</span></a>
</span><span id="BaseHDBSCANTuner-195"><a href="#BaseHDBSCANTuner-195"><span class="linenos">195</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span>
</span><span id="BaseHDBSCANTuner-196"><a href="#BaseHDBSCANTuner-196"><span class="linenos">196</span></a>
</span><span id="BaseHDBSCANTuner-197"><a href="#BaseHDBSCANTuner-197"><span class="linenos">197</span></a>
</span><span id="BaseHDBSCANTuner-198"><a href="#BaseHDBSCANTuner-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-199"><a href="#BaseHDBSCANTuner-199"><span class="linenos">199</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-200"><a href="#BaseHDBSCANTuner-200"><span class="linenos">200</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="BaseHDBSCANTuner-201"><a href="#BaseHDBSCANTuner-201"><span class="linenos">201</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-202"><a href="#BaseHDBSCANTuner-202"><span class="linenos">202</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-203"><a href="#BaseHDBSCANTuner-203"><span class="linenos">203</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-204"><a href="#BaseHDBSCANTuner-204"><span class="linenos">204</span></a> 
</span><span id="BaseHDBSCANTuner-205"><a href="#BaseHDBSCANTuner-205"><span class="linenos">205</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="BaseHDBSCANTuner-206"><a href="#BaseHDBSCANTuner-206"><span class="linenos">206</span></a>
</span><span id="BaseHDBSCANTuner-207"><a href="#BaseHDBSCANTuner-207"><span class="linenos">207</span></a>      
</span><span id="BaseHDBSCANTuner-208"><a href="#BaseHDBSCANTuner-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-209"><a href="#BaseHDBSCANTuner-209"><span class="linenos">209</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-210"><a href="#BaseHDBSCANTuner-210"><span class="linenos">210</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided HDBSCAN parameters.</span>
</span><span id="BaseHDBSCANTuner-211"><a href="#BaseHDBSCANTuner-211"><span class="linenos">211</span></a><span class="sd">      If TMT.docs has been set then the first 400 chars of each document will be shown as a </span>
</span><span id="BaseHDBSCANTuner-212"><a href="#BaseHDBSCANTuner-212"><span class="linenos">212</span></a><span class="sd">      hover over each data point.</span>
</span><span id="BaseHDBSCANTuner-213"><a href="#BaseHDBSCANTuner-213"><span class="linenos">213</span></a><span class="sd">  </span>
</span><span id="BaseHDBSCANTuner-214"><a href="#BaseHDBSCANTuner-214"><span class="linenos">214</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="BaseHDBSCANTuner-215"><a href="#BaseHDBSCANTuner-215"><span class="linenos">215</span></a><span class="sd">      &#39;&#39;&#39;</span>  
</span><span id="BaseHDBSCANTuner-216"><a href="#BaseHDBSCANTuner-216"><span class="linenos">216</span></a>      
</span><span id="BaseHDBSCANTuner-217"><a href="#BaseHDBSCANTuner-217"><span class="linenos">217</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-218"><a href="#BaseHDBSCANTuner-218"><span class="linenos">218</span></a>
</span><span id="BaseHDBSCANTuner-219"><a href="#BaseHDBSCANTuner-219"><span class="linenos">219</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="BaseHDBSCANTuner-220"><a href="#BaseHDBSCANTuner-220"><span class="linenos">220</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="BaseHDBSCANTuner-221"><a href="#BaseHDBSCANTuner-221"><span class="linenos">221</span></a>
</span><span id="BaseHDBSCANTuner-222"><a href="#BaseHDBSCANTuner-222"><span class="linenos">222</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-223"><a href="#BaseHDBSCANTuner-223"><span class="linenos">223</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="BaseHDBSCANTuner-224"><a href="#BaseHDBSCANTuner-224"><span class="linenos">224</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="BaseHDBSCANTuner-225"><a href="#BaseHDBSCANTuner-225"><span class="linenos">225</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="BaseHDBSCANTuner-226"><a href="#BaseHDBSCANTuner-226"><span class="linenos">226</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-227"><a href="#BaseHDBSCANTuner-227"><span class="linenos">227</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="BaseHDBSCANTuner-228"><a href="#BaseHDBSCANTuner-228"><span class="linenos">228</span></a>          
</span><span id="BaseHDBSCANTuner-229"><a href="#BaseHDBSCANTuner-229"><span class="linenos">229</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner-230"><a href="#BaseHDBSCANTuner-230"><span class="linenos">230</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner-231"><a href="#BaseHDBSCANTuner-231"><span class="linenos">231</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner-232"><a href="#BaseHDBSCANTuner-232"><span class="linenos">232</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner-233"><a href="#BaseHDBSCANTuner-233"><span class="linenos">233</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="BaseHDBSCANTuner-234"><a href="#BaseHDBSCANTuner-234"><span class="linenos">234</span></a>
</span><span id="BaseHDBSCANTuner-235"><a href="#BaseHDBSCANTuner-235"><span class="linenos">235</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span><span id="BaseHDBSCANTuner-236"><a href="#BaseHDBSCANTuner-236"><span class="linenos">236</span></a>        
</span><span id="BaseHDBSCANTuner-237"><a href="#BaseHDBSCANTuner-237"><span class="linenos">237</span></a>  
</span><span id="BaseHDBSCANTuner-238"><a href="#BaseHDBSCANTuner-238"><span class="linenos">238</span></a>    <span class="k">def</span> <span class="nf">_genRandomSearchParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">min_samples_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-239"><a href="#BaseHDBSCANTuner-239"><span class="linenos">239</span></a>        <span class="n">searchParams</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="BaseHDBSCANTuner-240"><a href="#BaseHDBSCANTuner-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-241"><a href="#BaseHDBSCANTuner-241"><span class="linenos">241</span></a>            <span class="n">searchParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="BaseHDBSCANTuner-242"><a href="#BaseHDBSCANTuner-242"><span class="linenos">242</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">))],</span>
</span><span id="BaseHDBSCANTuner-243"><a href="#BaseHDBSCANTuner-243"><span class="linenos">243</span></a>                                            <span class="n">min_samples_pct_range</span><span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">min_samples_pct_range</span><span class="p">))]</span>
</span><span id="BaseHDBSCANTuner-244"><a href="#BaseHDBSCANTuner-244"><span class="linenos">244</span></a>                                           <span class="p">)</span>
</span><span id="BaseHDBSCANTuner-245"><a href="#BaseHDBSCANTuner-245"><span class="linenos">245</span></a>        <span class="p">)</span>
</span><span id="BaseHDBSCANTuner-246"><a href="#BaseHDBSCANTuner-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">searchParams</span>
</span><span id="BaseHDBSCANTuner-247"><a href="#BaseHDBSCANTuner-247"><span class="linenos">247</span></a>    
</span><span id="BaseHDBSCANTuner-248"><a href="#BaseHDBSCANTuner-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">_genGridSearchParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">min_samples_pct_range</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-249"><a href="#BaseHDBSCANTuner-249"><span class="linenos">249</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="BaseHDBSCANTuner-250"><a href="#BaseHDBSCANTuner-250"><span class="linenos">250</span></a>      <span class="k">for</span> <span class="n">cluster_size</span> <span class="ow">in</span> <span class="n">cluster_sizes</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-251"><a href="#BaseHDBSCANTuner-251"><span class="linenos">251</span></a>        <span class="k">for</span> <span class="n">min_samples_pct</span> <span class="ow">in</span> <span class="n">min_samples_pct_range</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-252"><a href="#BaseHDBSCANTuner-252"><span class="linenos">252</span></a>          <span class="n">searchParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">,</span> <span class="n">min_samples_pct</span><span class="p">))</span>
</span><span id="BaseHDBSCANTuner-253"><a href="#BaseHDBSCANTuner-253"><span class="linenos">253</span></a>      <span class="k">return</span> <span class="n">searchParams</span>
</span><span id="BaseHDBSCANTuner-254"><a href="#BaseHDBSCANTuner-254"><span class="linenos">254</span></a>
</span><span id="BaseHDBSCANTuner-255"><a href="#BaseHDBSCANTuner-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size</span><span class="p">,</span> <span class="n">min_samples_pct</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-256"><a href="#BaseHDBSCANTuner-256"><span class="linenos">256</span></a>        <span class="n">min_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cluster_size</span> <span class="o">*</span> <span class="n">min_samples_pct</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-257"><a href="#BaseHDBSCANTuner-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="n">min_samples</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-258"><a href="#BaseHDBSCANTuner-258"><span class="linenos">258</span></a>          <span class="n">min_samples</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="BaseHDBSCANTuner-259"><a href="#BaseHDBSCANTuner-259"><span class="linenos">259</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-260"><a href="#BaseHDBSCANTuner-260"><span class="linenos">260</span></a>       
</span><span id="BaseHDBSCANTuner-261"><a href="#BaseHDBSCANTuner-261"><span class="linenos">261</span></a>    <span class="k">def</span> <span class="nf">_runTests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchParams</span><span class="p">):</span>
</span><span id="BaseHDBSCANTuner-262"><a href="#BaseHDBSCANTuner-262"><span class="linenos">262</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-263"><a href="#BaseHDBSCANTuner-263"><span class="linenos">263</span></a><span class="sd">      Runs a passel of HDBSCAN clusterings for searchParams</span>
</span><span id="BaseHDBSCANTuner-264"><a href="#BaseHDBSCANTuner-264"><span class="linenos">264</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner-265"><a href="#BaseHDBSCANTuner-265"><span class="linenos">265</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-266"><a href="#BaseHDBSCANTuner-266"><span class="linenos">266</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">))</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)]</span> 
</span><span id="BaseHDBSCANTuner-267"><a href="#BaseHDBSCANTuner-267"><span class="linenos">267</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-268"><a href="#BaseHDBSCANTuner-268"><span class="linenos">268</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">))</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">searchParams</span><span class="p">]</span> 
</span><span id="BaseHDBSCANTuner-269"><a href="#BaseHDBSCANTuner-269"><span class="linenos">269</span></a>      <span class="n">RunResultsDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="BaseHDBSCANTuner-270"><a href="#BaseHDBSCANTuner-270"><span class="linenos">270</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tupe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="BaseHDBSCANTuner-271"><a href="#BaseHDBSCANTuner-271"><span class="linenos">271</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;min_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tupe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="BaseHDBSCANTuner-272"><a href="#BaseHDBSCANTuner-272"><span class="linenos">272</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tupe</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="BaseHDBSCANTuner-273"><a href="#BaseHDBSCANTuner-273"><span class="linenos">273</span></a>      <span class="n">uncategorized</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="BaseHDBSCANTuner-274"><a href="#BaseHDBSCANTuner-274"><span class="linenos">274</span></a>      <span class="k">for</span> <span class="n">aDict</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tupe</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-275"><a href="#BaseHDBSCANTuner-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">aDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner-276"><a href="#BaseHDBSCANTuner-276"><span class="linenos">276</span></a>            <span class="n">uncategorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aDict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="BaseHDBSCANTuner-277"><a href="#BaseHDBSCANTuner-277"><span class="linenos">277</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BaseHDBSCANTuner-278"><a href="#BaseHDBSCANTuner-278"><span class="linenos">278</span></a>            <span class="n">uncategorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-279"><a href="#BaseHDBSCANTuner-279"><span class="linenos">279</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncategorized</span>
</span><span id="BaseHDBSCANTuner-280"><a href="#BaseHDBSCANTuner-280"><span class="linenos">280</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span><span class="p">,</span> <span class="n">RunResultsDF</span><span class="p">])</span>
</span><span id="BaseHDBSCANTuner-281"><a href="#BaseHDBSCANTuner-281"><span class="linenos">281</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner-282"><a href="#BaseHDBSCANTuner-282"><span class="linenos">282</span></a>  
</span><span id="BaseHDBSCANTuner-283"><a href="#BaseHDBSCANTuner-283"><span class="linenos">283</span></a>      <span class="k">return</span> <span class="n">RunResultsDF</span>
</span></pre></div>


    

                            <div id="BaseHDBSCANTuner.__init__" class="classattr">
                                        <input id="BaseHDBSCANTuner.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">BaseHDBSCANTuner</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">HDBSCAN_model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">target_vectors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">viz_reduction</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span>)</span>

                <label class="view-source-button" for="BaseHDBSCANTuner.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.__init__-21"><a href="#BaseHDBSCANTuner.__init__-21"><span class="linenos">21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner.__init__-22"><a href="#BaseHDBSCANTuner.__init__-22"><span class="linenos">22</span></a>                 <span class="n">HDBSCAN_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1">#: an HDBSCAN instance</span>
</span><span id="BaseHDBSCANTuner.__init__-23"><a href="#BaseHDBSCANTuner.__init__-23"><span class="linenos">23</span></a>                 <span class="n">target_vectors</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># vectors to be clustered</span>
</span><span id="BaseHDBSCANTuner.__init__-24"><a href="#BaseHDBSCANTuner.__init__-24"><span class="linenos">24</span></a>                 <span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># 2D reduction of the target_vectors</span>
</span><span id="BaseHDBSCANTuner.__init__-25"><a href="#BaseHDBSCANTuner.__init__-25"><span class="linenos">25</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> 
</span><span id="BaseHDBSCANTuner.__init__-26"><a href="#BaseHDBSCANTuner.__init__-26"><span class="linenos">26</span></a>        
</span><span id="BaseHDBSCANTuner.__init__-27"><a href="#BaseHDBSCANTuner.__init__-27"><span class="linenos">27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN_model</span>
</span><span id="BaseHDBSCANTuner.__init__-28"><a href="#BaseHDBSCANTuner.__init__-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span> <span class="o">=</span> <span class="n">target_vectors</span>
</span><span id="BaseHDBSCANTuner.__init__-29"><a href="#BaseHDBSCANTuner.__init__-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="BaseHDBSCANTuner.__init__-30"><a href="#BaseHDBSCANTuner.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="BaseHDBSCANTuner.__init__-31"><a href="#BaseHDBSCANTuner.__init__-31"><span class="linenos">31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># A running collection of all the parameters and results if a DataFrame</span>
</span><span id="BaseHDBSCANTuner.__init__-32"><a href="#BaseHDBSCANTuner.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span><span class="p">,</span> <span class="c1"># a 2D reduction of the embeddings used for visualization</span>
</span><span id="BaseHDBSCANTuner.__init__-33"><a href="#BaseHDBSCANTuner.__init__-33"><span class="linenos">33</span></a>
</span><span id="BaseHDBSCANTuner.__init__-34"><a href="#BaseHDBSCANTuner.__init__-34"><span class="linenos">34</span></a>        
</span><span id="BaseHDBSCANTuner.__init__-35"><a href="#BaseHDBSCANTuner.__init__-35"><span class="linenos">35</span></a>        <span class="c1"># self._paramPair = namedtuple(&#39;paramPair&#39;, &#39;cs ss&#39;) # Used internally to enhance readability</span>
</span><span id="BaseHDBSCANTuner.__init__-36"><a href="#BaseHDBSCANTuner.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">paramPair</span>        
</span><span id="BaseHDBSCANTuner.__init__-37"><a href="#BaseHDBSCANTuner.__init__-37"><span class="linenos">37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__bestParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="BaseHDBSCANTuner.runHDBSCAN" class="classattr">
                                        <input id="BaseHDBSCANTuner.runHDBSCAN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">runHDBSCAN</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.runHDBSCAN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.runHDBSCAN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.runHDBSCAN-70"><a href="#BaseHDBSCANTuner.runHDBSCAN-70"><span class="linenos">70</span></a>    <span class="k">def</span> <span class="nf">runHDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-71"><a href="#BaseHDBSCANTuner.runHDBSCAN-71"><span class="linenos">71</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-72"><a href="#BaseHDBSCANTuner.runHDBSCAN-72"><span class="linenos">72</span></a><span class="sd">      Cluster reduced embeddings. min_samples must be more than 0 and less than</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-73"><a href="#BaseHDBSCANTuner.runHDBSCAN-73"><span class="linenos">73</span></a><span class="sd">      or equal to min_cluster_size.</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-74"><a href="#BaseHDBSCANTuner.runHDBSCAN-74"><span class="linenos">74</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-75"><a href="#BaseHDBSCANTuner.runHDBSCAN-75"><span class="linenos">75</span></a>      <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_CS_SS</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-76"><a href="#BaseHDBSCANTuner.runHDBSCAN-76"><span class="linenos">76</span></a>          
</span><span id="BaseHDBSCANTuner.runHDBSCAN-77"><a href="#BaseHDBSCANTuner.runHDBSCAN-77"><span class="linenos">77</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-78"><a href="#BaseHDBSCANTuner.runHDBSCAN-78"><span class="linenos">78</span></a>        <span class="n">hdbscan_params</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-79"><a href="#BaseHDBSCANTuner.runHDBSCAN-79"><span class="linenos">79</span></a>        <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-80"><a href="#BaseHDBSCANTuner.runHDBSCAN-80"><span class="linenos">80</span></a>        <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-81"><a href="#BaseHDBSCANTuner.runHDBSCAN-81"><span class="linenos">81</span></a>        <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="o">**</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-82"><a href="#BaseHDBSCANTuner.runHDBSCAN-82"><span class="linenos">82</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-83"><a href="#BaseHDBSCANTuner.runHDBSCAN-83"><span class="linenos">83</span></a>        <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-84"><a href="#BaseHDBSCANTuner.runHDBSCAN-84"><span class="linenos">84</span></a>        <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_cluster_size</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-85"><a href="#BaseHDBSCANTuner.runHDBSCAN-85"><span class="linenos">85</span></a>        <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_samples</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="BaseHDBSCANTuner.runHDBSCAN-86"><a href="#BaseHDBSCANTuner.runHDBSCAN-86"><span class="linenos">86</span></a>  
</span><span id="BaseHDBSCANTuner.runHDBSCAN-87"><a href="#BaseHDBSCANTuner.runHDBSCAN-87"><span class="linenos">87</span></a>      <span class="k">return</span> <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span><span class="p">)</span>  
</span></pre></div>


            <div class="docstring"><p>Cluster reduced embeddings. min_samples must be more than 0 and less than
or equal to min_cluster_size.</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.randomSearch" class="classattr">
                                        <input id="BaseHDBSCANTuner.randomSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">randomSearch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">cluster_size_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">min_samples_pct_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>,</span><span class="param">	<span class="n">iters</span><span class="o">=</span><span class="mi">20</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.randomSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.randomSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.randomSearch-89"><a href="#BaseHDBSCANTuner.randomSearch-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">randomSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_samples_pct_range</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.randomSearch-90"><a href="#BaseHDBSCANTuner.randomSearch-90"><span class="linenos"> 90</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.randomSearch-91"><a href="#BaseHDBSCANTuner.randomSearch-91"><span class="linenos"> 91</span></a><span class="sd">      Run a passel of HDBSCAN within a given range of parameters.</span>
</span><span id="BaseHDBSCANTuner.randomSearch-92"><a href="#BaseHDBSCANTuner.randomSearch-92"><span class="linenos"> 92</span></a><span class="sd">      cluster_size_range is a list of ints and min_samples_pct_range is a list of percentage</span>
</span><span id="BaseHDBSCANTuner.randomSearch-93"><a href="#BaseHDBSCANTuner.randomSearch-93"><span class="linenos"> 93</span></a><span class="sd">      values in decimal form e.g. [.1, .25, .50, .75, 1]. </span>
</span><span id="BaseHDBSCANTuner.randomSearch-94"><a href="#BaseHDBSCANTuner.randomSearch-94"><span class="linenos"> 94</span></a><span class="sd">      </span>
</span><span id="BaseHDBSCANTuner.randomSearch-95"><a href="#BaseHDBSCANTuner.randomSearch-95"><span class="linenos"> 95</span></a><span class="sd">      This function will randomly select a min_cluster_size  and a min_samples percent</span>
</span><span id="BaseHDBSCANTuner.randomSearch-96"><a href="#BaseHDBSCANTuner.randomSearch-96"><span class="linenos"> 96</span></a><span class="sd">      value from the supplied values. The min_samples percent will be used to calculate</span>
</span><span id="BaseHDBSCANTuner.randomSearch-97"><a href="#BaseHDBSCANTuner.randomSearch-97"><span class="linenos"> 97</span></a><span class="sd">      the min_samples parameter to be used. That value will be rounded up to 1 if less than 1</span>
</span><span id="BaseHDBSCANTuner.randomSearch-98"><a href="#BaseHDBSCANTuner.randomSearch-98"><span class="linenos"> 98</span></a><span class="sd">      and cannot be larger than the selected cluster_size.</span>
</span><span id="BaseHDBSCANTuner.randomSearch-99"><a href="#BaseHDBSCANTuner.randomSearch-99"><span class="linenos"> 99</span></a>
</span><span id="BaseHDBSCANTuner.randomSearch-100"><a href="#BaseHDBSCANTuner.randomSearch-100"><span class="linenos">100</span></a><span class="sd">      All of the search results will be added to TMT.ResultsDF and a separate DataFrame containing</span>
</span><span id="BaseHDBSCANTuner.randomSearch-101"><a href="#BaseHDBSCANTuner.randomSearch-101"><span class="linenos">101</span></a><span class="sd">      just the results from this search will be returned to the caller.</span>
</span><span id="BaseHDBSCANTuner.randomSearch-102"><a href="#BaseHDBSCANTuner.randomSearch-102"><span class="linenos">102</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.randomSearch-103"><a href="#BaseHDBSCANTuner.randomSearch-103"><span class="linenos">103</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genRandomSearchParams</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">min_samples_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.randomSearch-104"><a href="#BaseHDBSCANTuner.randomSearch-104"><span class="linenos">104</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run a passel of HDBSCAN within a given range of parameters.
cluster_size_range is a list of ints and min_samples_pct_range is a list of percentage
values in decimal form e.g. [.1, .25, .50, .75, 1]. </p>

<p>This function will randomly select a min_cluster_size  and a min_samples percent
value from the supplied values. The min_samples percent will be used to calculate
the min_samples parameter to be used. That value will be rounded up to 1 if less than 1
and cannot be larger than the selected cluster_size.</p>

<p>All of the search results will be added to TMT.ResultsDF and a separate DataFrame containing
just the results from this search will be returned to the caller.</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.psuedoGridSearch" class="classattr">
                                        <input id="BaseHDBSCANTuner.psuedoGridSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">psuedoGridSearch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cluster_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>, </span><span class="param"><span class="n">min_samples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.psuedoGridSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.psuedoGridSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.psuedoGridSearch-106"><a href="#BaseHDBSCANTuner.psuedoGridSearch-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">psuedoGridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_samples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-107"><a href="#BaseHDBSCANTuner.psuedoGridSearch-107"><span class="linenos">107</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-108"><a href="#BaseHDBSCANTuner.psuedoGridSearch-108"><span class="linenos">108</span></a><span class="sd">      Note that this is not a really a grid search. Rather this function will use each value</span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-109"><a href="#BaseHDBSCANTuner.psuedoGridSearch-109"><span class="linenos">109</span></a><span class="sd">      in cluster_sizes to initiate a clustering on each percent value in min_sampless. For </span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-110"><a href="#BaseHDBSCANTuner.psuedoGridSearch-110"><span class="linenos">110</span></a><span class="sd">      example if the values are [*range(100,102)] and [val/100 for val in [*range(10, 101 ,10)]], a clustering for </span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-111"><a href="#BaseHDBSCANTuner.psuedoGridSearch-111"><span class="linenos">111</span></a><span class="sd">      each percentage value in min_sampless for each value in cluster_sizes would be run</span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-112"><a href="#BaseHDBSCANTuner.psuedoGridSearch-112"><span class="linenos">112</span></a><span class="sd">      for a total of 20 clusterings (cluster sizes 100 and 101 * percent values of those for 10%, 20%, 30%,...100%).</span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-113"><a href="#BaseHDBSCANTuner.psuedoGridSearch-113"><span class="linenos">113</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-114"><a href="#BaseHDBSCANTuner.psuedoGridSearch-114"><span class="linenos">114</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genGridSearchParams</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.psuedoGridSearch-115"><a href="#BaseHDBSCANTuner.psuedoGridSearch-115"><span class="linenos">115</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Note that this is not a really a grid search. Rather this function will use each value
in cluster_sizes to initiate a clustering on each percent value in min_sampless. For 
example if the values are [<em>range(100,102)] and [val/100 for val in [</em>range(10, 101 ,10)]], a clustering for 
each percentage value in min_sampless for each value in cluster_sizes would be run
for a total of 20 clusterings (cluster sizes 100 and 101 * percent values of those for 10%, 20%, 30%,...100%).</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.simpleSearch" class="classattr">
                                        <input id="BaseHDBSCANTuner.simpleSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">simpleSearch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cluster_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>, </span><span class="param"><span class="n">min_sampless</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.simpleSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.simpleSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.simpleSearch-117"><a href="#BaseHDBSCANTuner.simpleSearch-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">simpleSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">min_sampless</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.simpleSearch-118"><a href="#BaseHDBSCANTuner.simpleSearch-118"><span class="linenos">118</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.simpleSearch-119"><a href="#BaseHDBSCANTuner.simpleSearch-119"><span class="linenos">119</span></a><span class="sd">      A clustering for each value in cluster_sizes will be run using the corresponding min_sampless </span>
</span><span id="BaseHDBSCANTuner.simpleSearch-120"><a href="#BaseHDBSCANTuner.simpleSearch-120"><span class="linenos">120</span></a><span class="sd">      value. The len of each list must be the same. Each cluster_size must be &gt; 0 and min_samples must </span>
</span><span id="BaseHDBSCANTuner.simpleSearch-121"><a href="#BaseHDBSCANTuner.simpleSearch-121"><span class="linenos">121</span></a><span class="sd">      be &gt;0 and &lt;= cluster_size.</span>
</span><span id="BaseHDBSCANTuner.simpleSearch-122"><a href="#BaseHDBSCANTuner.simpleSearch-122"><span class="linenos">122</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.simpleSearch-123"><a href="#BaseHDBSCANTuner.simpleSearch-123"><span class="linenos">123</span></a>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_sampless</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.simpleSearch-124"><a href="#BaseHDBSCANTuner.simpleSearch-124"><span class="linenos">124</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length of cluster sizes and samples sizes lists must match&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.simpleSearch-125"><a href="#BaseHDBSCANTuner.simpleSearch-125"><span class="linenos">125</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">min_sampless</span><span class="p">)])</span>
</span></pre></div>


            <div class="docstring"><p>A clustering for each value in cluster_sizes will be run using the corresponding min_sampless 
value. The len of each list must be the same. Each cluster_size must be &gt; 0 and min_samples must 
be &gt;0 and &lt;= cluster_size.</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.gridSearch" class="classattr">
                                        <input id="BaseHDBSCANTuner.gridSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gridSearch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">searchRange</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.gridSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.gridSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.gridSearch-127"><a href="#BaseHDBSCANTuner.gridSearch-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">gridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchRange</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.gridSearch-128"><a href="#BaseHDBSCANTuner.gridSearch-128"><span class="linenos">128</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.gridSearch-129"><a href="#BaseHDBSCANTuner.gridSearch-129"><span class="linenos">129</span></a><span class="sd">      For any n (int) in searchRange, generates all possible min_samples values (1 to n) and performs</span>
</span><span id="BaseHDBSCANTuner.gridSearch-130"><a href="#BaseHDBSCANTuner.gridSearch-130"><span class="linenos">130</span></a><span class="sd">      the search.</span>
</span><span id="BaseHDBSCANTuner.gridSearch-131"><a href="#BaseHDBSCANTuner.gridSearch-131"><span class="linenos">131</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.gridSearch-132"><a href="#BaseHDBSCANTuner.gridSearch-132"><span class="linenos">132</span></a>      <span class="n">cs_list</span><span class="p">,</span> <span class="n">ss_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="BaseHDBSCANTuner.gridSearch-133"><a href="#BaseHDBSCANTuner.gridSearch-133"><span class="linenos">133</span></a>      <span class="k">for</span> <span class="n">cs_val</span> <span class="ow">in</span> <span class="n">searchRange</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.gridSearch-134"><a href="#BaseHDBSCANTuner.gridSearch-134"><span class="linenos">134</span></a>          <span class="k">for</span> <span class="n">ss_val</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cs_val</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.gridSearch-135"><a href="#BaseHDBSCANTuner.gridSearch-135"><span class="linenos">135</span></a>            <span class="n">cs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs_val</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.gridSearch-136"><a href="#BaseHDBSCANTuner.gridSearch-136"><span class="linenos">136</span></a>            <span class="n">ss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss_val</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.gridSearch-137"><a href="#BaseHDBSCANTuner.gridSearch-137"><span class="linenos">137</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simpleSearch</span><span class="p">(</span><span class="n">cs_list</span><span class="p">,</span> <span class="n">ss_list</span><span class="p">)</span> 
</span></pre></div>


            <div class="docstring"><p>For any n (int) in searchRange, generates all possible min_samples values (1 to n) and performs
the search.</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.visualizeSearch" class="classattr">
                                        <input id="BaseHDBSCANTuner.visualizeSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualizeSearch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">resultsDF</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.visualizeSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.visualizeSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.visualizeSearch-139"><a href="#BaseHDBSCANTuner.visualizeSearch-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">visualizeSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultsDF</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-140"><a href="#BaseHDBSCANTuner.visualizeSearch-140"><span class="linenos">140</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-141"><a href="#BaseHDBSCANTuner.visualizeSearch-141"><span class="linenos">141</span></a><span class="sd">      Returns a plotly fig of a parrallel coordinates graph of the searches performed on this instance. </span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-142"><a href="#BaseHDBSCANTuner.visualizeSearch-142"><span class="linenos">142</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-143"><a href="#BaseHDBSCANTuner.visualizeSearch-143"><span class="linenos">143</span></a>        
</span><span id="BaseHDBSCANTuner.visualizeSearch-144"><a href="#BaseHDBSCANTuner.visualizeSearch-144"><span class="linenos">144</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-145"><a href="#BaseHDBSCANTuner.visualizeSearch-145"><span class="linenos">145</span></a>          <span class="n">resultsDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-146"><a href="#BaseHDBSCANTuner.visualizeSearch-146"><span class="linenos">146</span></a>
</span><span id="BaseHDBSCANTuner.visualizeSearch-147"><a href="#BaseHDBSCANTuner.visualizeSearch-147"><span class="linenos">147</span></a>      <span class="k">return</span> <span class="n">px</span><span class="o">.</span><span class="n">parallel_coordinates</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-148"><a href="#BaseHDBSCANTuner.visualizeSearch-148"><span class="linenos">148</span></a>                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> 
</span><span id="BaseHDBSCANTuner.visualizeSearch-149"><a href="#BaseHDBSCANTuner.visualizeSearch-149"><span class="linenos">149</span></a>                                    <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-150"><a href="#BaseHDBSCANTuner.visualizeSearch-150"><span class="linenos">150</span></a>                                            <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">,</span> 
</span><span id="BaseHDBSCANTuner.visualizeSearch-151"><a href="#BaseHDBSCANTuner.visualizeSearch-151"><span class="linenos">151</span></a>                                            <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">:</span> <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner.visualizeSearch-152"><a href="#BaseHDBSCANTuner.visualizeSearch-152"><span class="linenos">152</span></a>                                            <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">:</span> <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> <span class="p">},)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a plotly fig of a parrallel coordinates graph of the searches performed on this instance.</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.summarizeResults" class="classattr">
                                        <input id="BaseHDBSCANTuner.summarizeResults-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">summarizeResults</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">summaryDF</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.summarizeResults-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.summarizeResults"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.summarizeResults-154"><a href="#BaseHDBSCANTuner.summarizeResults-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">summarizeResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summaryDF</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-155"><a href="#BaseHDBSCANTuner.summarizeResults-155"><span class="linenos">155</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-156"><a href="#BaseHDBSCANTuner.summarizeResults-156"><span class="linenos">156</span></a><span class="sd">      Takes DataFrame of results and returns a DataFrame containing only one record for </span>
</span><span id="BaseHDBSCANTuner.summarizeResults-157"><a href="#BaseHDBSCANTuner.summarizeResults-157"><span class="linenos">157</span></a><span class="sd">      each value of number of clusters. Returns the record with the lowest number of </span>
</span><span id="BaseHDBSCANTuner.summarizeResults-158"><a href="#BaseHDBSCANTuner.summarizeResults-158"><span class="linenos">158</span></a><span class="sd">      uncategorized documents. By default runs against self.ResultsDF - the aggregation of all</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-159"><a href="#BaseHDBSCANTuner.summarizeResults-159"><span class="linenos">159</span></a><span class="sd">      searches run for this model.</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-160"><a href="#BaseHDBSCANTuner.summarizeResults-160"><span class="linenos">160</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-161"><a href="#BaseHDBSCANTuner.summarizeResults-161"><span class="linenos">161</span></a>
</span><span id="BaseHDBSCANTuner.summarizeResults-162"><a href="#BaseHDBSCANTuner.summarizeResults-162"><span class="linenos">162</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-163"><a href="#BaseHDBSCANTuner.summarizeResults-163"><span class="linenos">163</span></a>          <span class="n">summaryDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-164"><a href="#BaseHDBSCANTuner.summarizeResults-164"><span class="linenos">164</span></a>
</span><span id="BaseHDBSCANTuner.summarizeResults-165"><a href="#BaseHDBSCANTuner.summarizeResults-165"><span class="linenos">165</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-166"><a href="#BaseHDBSCANTuner.summarizeResults-166"><span class="linenos">166</span></a>          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No searches run on this TMT instance, or DF to summarize is None&quot;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-167"><a href="#BaseHDBSCANTuner.summarizeResults-167"><span class="linenos">167</span></a>        
</span><span id="BaseHDBSCANTuner.summarizeResults-168"><a href="#BaseHDBSCANTuner.summarizeResults-168"><span class="linenos">168</span></a>      <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-169"><a href="#BaseHDBSCANTuner.summarizeResults-169"><span class="linenos">169</span></a>      <span class="k">for</span> <span class="n">num_clusters</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-170"><a href="#BaseHDBSCANTuner.summarizeResults-170"><span class="linenos">170</span></a>        <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">resultSummaryDF</span><span class="p">,</span> <span class="n">summaryDF</span><span class="p">[</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">num_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]])</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-171"><a href="#BaseHDBSCANTuner.summarizeResults-171"><span class="linenos">171</span></a>      <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.summarizeResults-172"><a href="#BaseHDBSCANTuner.summarizeResults-172"><span class="linenos">172</span></a>      <span class="k">return</span> <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Takes DataFrame of results and returns a DataFrame containing only one record for 
each value of number of clusters. Returns the record with the lowest number of 
uncategorized documents. By default runs against self.ResultsDF - the aggregation of all
searches run for this model.</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.clearSearches" class="classattr">
                                        <input id="BaseHDBSCANTuner.clearSearches-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clearSearches</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.clearSearches-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.clearSearches"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.clearSearches-174"><a href="#BaseHDBSCANTuner.clearSearches-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">clearSearches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BaseHDBSCANTuner.clearSearches-175"><a href="#BaseHDBSCANTuner.clearSearches-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseHDBSCANTuner.clearSearches-176"><a href="#BaseHDBSCANTuner.clearSearches-176"><span class="linenos">176</span></a><span class="sd">        A convenience function that resets the saved searches</span>
</span><span id="BaseHDBSCANTuner.clearSearches-177"><a href="#BaseHDBSCANTuner.clearSearches-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseHDBSCANTuner.clearSearches-178"><a href="#BaseHDBSCANTuner.clearSearches-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>A convenience function that resets the saved searches</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.createVizReduction" class="classattr">
                                        <input id="BaseHDBSCANTuner.createVizReduction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">createVizReduction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="s1">&#39;UMAP&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.createVizReduction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.createVizReduction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.createVizReduction-180"><a href="#BaseHDBSCANTuner.createVizReduction-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;UMAP&#39;</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-181"><a href="#BaseHDBSCANTuner.createVizReduction-181"><span class="linenos">181</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-182"><a href="#BaseHDBSCANTuner.createVizReduction-182"><span class="linenos">182</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-183"><a href="#BaseHDBSCANTuner.createVizReduction-183"><span class="linenos">183</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-184"><a href="#BaseHDBSCANTuner.createVizReduction-184"><span class="linenos">184</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-185"><a href="#BaseHDBSCANTuner.createVizReduction-185"><span class="linenos">185</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-186"><a href="#BaseHDBSCANTuner.createVizReduction-186"><span class="linenos">186</span></a>
</span><span id="BaseHDBSCANTuner.createVizReduction-187"><a href="#BaseHDBSCANTuner.createVizReduction-187"><span class="linenos">187</span></a>      <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;UMAP&#39;</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-188"><a href="#BaseHDBSCANTuner.createVizReduction-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-189"><a href="#BaseHDBSCANTuner.createVizReduction-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-190"><a href="#BaseHDBSCANTuner.createVizReduction-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-191"><a href="#BaseHDBSCANTuner.createVizReduction-191"><span class="linenos">191</span></a>      <span class="k">else</span> <span class="p">:</span> <span class="c1"># Only TSNE is supported</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-192"><a href="#BaseHDBSCANTuner.createVizReduction-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-193"><a href="#BaseHDBSCANTuner.createVizReduction-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.createVizReduction-194"><a href="#BaseHDBSCANTuner.createVizReduction-194"><span class="linenos">194</span></a>
</span><span id="BaseHDBSCANTuner.createVizReduction-195"><a href="#BaseHDBSCANTuner.createVizReduction-195"><span class="linenos">195</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span>
</span></pre></div>


            <div class="docstring"><p>Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.getVizCoords" class="classattr">
                                        <input id="BaseHDBSCANTuner.getVizCoords-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getVizCoords</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.getVizCoords-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.getVizCoords"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.getVizCoords-198"><a href="#BaseHDBSCANTuner.getVizCoords-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.getVizCoords-199"><a href="#BaseHDBSCANTuner.getVizCoords-199"><span class="linenos">199</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.getVizCoords-200"><a href="#BaseHDBSCANTuner.getVizCoords-200"><span class="linenos">200</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="BaseHDBSCANTuner.getVizCoords-201"><a href="#BaseHDBSCANTuner.getVizCoords-201"><span class="linenos">201</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.getVizCoords-202"><a href="#BaseHDBSCANTuner.getVizCoords-202"><span class="linenos">202</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.getVizCoords-203"><a href="#BaseHDBSCANTuner.getVizCoords-203"><span class="linenos">203</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.getVizCoords-204"><a href="#BaseHDBSCANTuner.getVizCoords-204"><span class="linenos">204</span></a> 
</span><span id="BaseHDBSCANTuner.getVizCoords-205"><a href="#BaseHDBSCANTuner.getVizCoords-205"><span class="linenos">205</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</p>
</div>


                            </div>
                            <div id="BaseHDBSCANTuner.visualizeEmbeddings" class="classattr">
                                        <input id="BaseHDBSCANTuner.visualizeEmbeddings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualizeEmbeddings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="BaseHDBSCANTuner.visualizeEmbeddings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseHDBSCANTuner.visualizeEmbeddings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseHDBSCANTuner.visualizeEmbeddings-208"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-209"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-209"><span class="linenos">209</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-210"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-210"><span class="linenos">210</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided HDBSCAN parameters.</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-211"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-211"><span class="linenos">211</span></a><span class="sd">      If TMT.docs has been set then the first 400 chars of each document will be shown as a </span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-212"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-212"><span class="linenos">212</span></a><span class="sd">      hover over each data point.</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-213"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-213"><span class="linenos">213</span></a><span class="sd">  </span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-214"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-214"><span class="linenos">214</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-215"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-215"><span class="linenos">215</span></a><span class="sd">      &#39;&#39;&#39;</span>  
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-216"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-216"><span class="linenos">216</span></a>      
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-217"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-217"><span class="linenos">217</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-218"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-218"><span class="linenos">218</span></a>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-219"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-219"><span class="linenos">219</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-220"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-220"><span class="linenos">220</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-221"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-221"><span class="linenos">221</span></a>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-222"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-222"><span class="linenos">222</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-223"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-223"><span class="linenos">223</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-224"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-224"><span class="linenos">224</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-225"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-225"><span class="linenos">225</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-226"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-226"><span class="linenos">226</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-227"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-227"><span class="linenos">227</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-228"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-228"><span class="linenos">228</span></a>          
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-229"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-229"><span class="linenos">229</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-230"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-230"><span class="linenos">230</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-231"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-231"><span class="linenos">231</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-232"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-232"><span class="linenos">232</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-233"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-233"><span class="linenos">233</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-234"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-234"><span class="linenos">234</span></a>
</span><span id="BaseHDBSCANTuner.visualizeEmbeddings-235"><a href="#BaseHDBSCANTuner.visualizeEmbeddings-235"><span class="linenos">235</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span></pre></div>


            <div class="docstring"><p>Visualize the embeddings, clustered according to the provided HDBSCAN parameters.
If TMT.docs has been set then the first 400 chars of each document will be shown as a 
hover over each data point.</p>

<p>Returns a plotly fig object</p>
</div>


                            </div>
                </section>
                <section id="TopicModelTuner">
                            <input id="TopicModelTuner-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TopicModelTuner</span><wbr>(<span class="base"><a href="#BaseHDBSCANTuner">BaseHDBSCANTuner</a></span>):

                <label class="view-source-button" for="TopicModelTuner-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner-285"><a href="#TopicModelTuner-285"><span class="linenos">285</span></a><span class="k">class</span> <span class="nc">TopicModelTuner</span><span class="p">(</span><span class="n">BaseHDBSCANTuner</span><span class="p">):</span>
</span><span id="TopicModelTuner-286"><a href="#TopicModelTuner-286"><span class="linenos">286</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-287"><a href="#TopicModelTuner-287"><span class="linenos">287</span></a><span class="sd">    TopicModelTuner (TMT) is a tool to optimize the min_clust_size and min_sample parameters </span>
</span><span id="TopicModelTuner-288"><a href="#TopicModelTuner-288"><span class="linenos">288</span></a><span class="sd">    of HDBSCAN. It is a compliment to the BERTopic default configuration and assumes that </span>
</span><span id="TopicModelTuner-289"><a href="#TopicModelTuner-289"><span class="linenos">289</span></a><span class="sd">    HDBSCAN is being used to cluster UMAP reductions of embeddings. </span>
</span><span id="TopicModelTuner-290"><a href="#TopicModelTuner-290"><span class="linenos">290</span></a><span class="sd">    </span>
</span><span id="TopicModelTuner-291"><a href="#TopicModelTuner-291"><span class="linenos">291</span></a><span class="sd">    The convenience function TMT.wrapBERTopicModel() returns a TMT instance initialized </span>
</span><span id="TopicModelTuner-292"><a href="#TopicModelTuner-292"><span class="linenos">292</span></a><span class="sd">    with the provided BERTopic model&#39;s embedding model, HDBSCAN and UMAP instances and</span>
</span><span id="TopicModelTuner-293"><a href="#TopicModelTuner-293"><span class="linenos">293</span></a><span class="sd">    parameters. </span>
</span><span id="TopicModelTuner-294"><a href="#TopicModelTuner-294"><span class="linenos">294</span></a><span class="sd">    </span>
</span><span id="TopicModelTuner-295"><a href="#TopicModelTuner-295"><span class="linenos">295</span></a><span class="sd">    Alternatively a new TMT instance can be created from scratch and, in either case, </span>
</span><span id="TopicModelTuner-296"><a href="#TopicModelTuner-296"><span class="linenos">296</span></a><span class="sd">    once the optimized parameters have been identified, calling TMT.getBERTopicModel()</span>
</span><span id="TopicModelTuner-297"><a href="#TopicModelTuner-297"><span class="linenos">297</span></a><span class="sd">    returns a configured BERTopic instance with the desired parameters.</span>
</span><span id="TopicModelTuner-298"><a href="#TopicModelTuner-298"><span class="linenos">298</span></a><span class="sd">    </span>
</span><span id="TopicModelTuner-299"><a href="#TopicModelTuner-299"><span class="linenos">299</span></a><span class="sd">    TMT does not explicitly provide functionality for testing alternative UMAP parameters or</span>
</span><span id="TopicModelTuner-300"><a href="#TopicModelTuner-300"><span class="linenos">300</span></a><span class="sd">    HDBSCAN parameters other than min_cluster_size or min_samples. However both the HDBSCAN</span>
</span><span id="TopicModelTuner-301"><a href="#TopicModelTuner-301"><span class="linenos">301</span></a><span class="sd">    and UMAP models are exposed within the class and can be set to any parameters desired. </span>
</span><span id="TopicModelTuner-302"><a href="#TopicModelTuner-302"><span class="linenos">302</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-303"><a href="#TopicModelTuner-303"><span class="linenos">303</span></a>    
</span><span id="TopicModelTuner-304"><a href="#TopicModelTuner-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner-305"><a href="#TopicModelTuner-305"><span class="linenos">305</span></a>                 <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># pre-generated embeddings</span>
</span><span id="TopicModelTuner-306"><a href="#TopicModelTuner-306"><span class="linenos">306</span></a>                 <span class="n">embedding_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># set for alternative transformer embedding model</span>
</span><span id="TopicModelTuner-307"><a href="#TopicModelTuner-307"><span class="linenos">307</span></a>                 <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># can be set here or when embeddings are created manually</span>
</span><span id="TopicModelTuner-308"><a href="#TopicModelTuner-308"><span class="linenos">308</span></a>                 <span class="n">reducer_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># a UMAP instance</span>
</span><span id="TopicModelTuner-309"><a href="#TopicModelTuner-309"><span class="linenos">309</span></a>                 <span class="n">reducer_random_state</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TopicModelTuner-310"><a href="#TopicModelTuner-310"><span class="linenos">310</span></a>                 <span class="n">reducer_components</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
</span><span id="TopicModelTuner-311"><a href="#TopicModelTuner-311"><span class="linenos">311</span></a>                 <span class="n">reduced_embeddings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TopicModelTuner-312"><a href="#TopicModelTuner-312"><span class="linenos">312</span></a>                 <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># an HDBSCAN instance</span>
</span><span id="TopicModelTuner-313"><a href="#TopicModelTuner-313"><span class="linenos">313</span></a>                 <span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TopicModelTuner-314"><a href="#TopicModelTuner-314"><span class="linenos">314</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="c1">#: for UMAP</span>
</span><span id="TopicModelTuner-315"><a href="#TopicModelTuner-315"><span class="linenos">315</span></a>        
</span><span id="TopicModelTuner-316"><a href="#TopicModelTuner-316"><span class="linenos">316</span></a>      <span class="n">BaseHDBSCANTuner</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner-317"><a href="#TopicModelTuner-317"><span class="linenos">317</span></a>                   <span class="n">HDBSCAN_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="TopicModelTuner-318"><a href="#TopicModelTuner-318"><span class="linenos">318</span></a>                   <span class="n">target_vectors</span> <span class="o">=</span> <span class="n">reduced_embeddings</span><span class="p">,</span> <span class="c1"># Set the reduced embeddings to be clustered </span>
</span><span id="TopicModelTuner-319"><a href="#TopicModelTuner-319"><span class="linenos">319</span></a>                   <span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span><span class="p">,</span>
</span><span id="TopicModelTuner-320"><a href="#TopicModelTuner-320"><span class="linenos">320</span></a>                   <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="TopicModelTuner-321"><a href="#TopicModelTuner-321"><span class="linenos">321</span></a>
</span><span id="TopicModelTuner-322"><a href="#TopicModelTuner-322"><span class="linenos">322</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-323"><a href="#TopicModelTuner-323"><span class="linenos">323</span></a><span class="sd">      Unless explicitly set, TMT Uses the same default param defaults for the embedding model </span>
</span><span id="TopicModelTuner-324"><a href="#TopicModelTuner-324"><span class="linenos">324</span></a><span class="sd">      as well as HDBSCAN and UMAP parameters as are used in the BERTopic defaults. </span>
</span><span id="TopicModelTuner-325"><a href="#TopicModelTuner-325"><span class="linenos">325</span></a>
</span><span id="TopicModelTuner-326"><a href="#TopicModelTuner-326"><span class="linenos">326</span></a><span class="sd">      - &#39;all-MiniLM-L6-v2&#39; sentence transformer as the default language model embedding.</span>
</span><span id="TopicModelTuner-327"><a href="#TopicModelTuner-327"><span class="linenos">327</span></a><span class="sd">      - UMAP - metric=&#39;cosine&#39;, n_neighbors=5, min_dist=0.0</span>
</span><span id="TopicModelTuner-328"><a href="#TopicModelTuner-328"><span class="linenos">328</span></a><span class="sd">      - HDBSCAN - metric=&#39;euclidean&#39;, cluster_selection_method=&#39;eom&#39;, prediction_data=True,</span>
</span><span id="TopicModelTuner-329"><a href="#TopicModelTuner-329"><span class="linenos">329</span></a><span class="sd">                  min_cluster_size = 10.</span>
</span><span id="TopicModelTuner-330"><a href="#TopicModelTuner-330"><span class="linenos">330</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner-331"><a href="#TopicModelTuner-331"><span class="linenos">331</span></a><span class="sd">      Options include:</span>
</span><span id="TopicModelTuner-332"><a href="#TopicModelTuner-332"><span class="linenos">332</span></a>
</span><span id="TopicModelTuner-333"><a href="#TopicModelTuner-333"><span class="linenos">333</span></a><span class="sd">      - Using your own embeddings by setting TMT.embeddings after creating an instance</span>
</span><span id="TopicModelTuner-334"><a href="#TopicModelTuner-334"><span class="linenos">334</span></a><span class="sd">      - Using different UMAP settings or a different dimensional reduction method by setting TMT.reducer_model</span>
</span><span id="TopicModelTuner-335"><a href="#TopicModelTuner-335"><span class="linenos">335</span></a><span class="sd">      - Using different HDBSCAN parameters by setting TMT.hdbscan_model</span>
</span><span id="TopicModelTuner-336"><a href="#TopicModelTuner-336"><span class="linenos">336</span></a>
</span><span id="TopicModelTuner-337"><a href="#TopicModelTuner-337"><span class="linenos">337</span></a><span class="sd">      These can be set in the constructor or after instantiation by setting the instance variables </span>
</span><span id="TopicModelTuner-338"><a href="#TopicModelTuner-338"><span class="linenos">338</span></a><span class="sd">      before generating the embeddings or reduction.</span>
</span><span id="TopicModelTuner-339"><a href="#TopicModelTuner-339"><span class="linenos">339</span></a>
</span><span id="TopicModelTuner-340"><a href="#TopicModelTuner-340"><span class="linenos">340</span></a><span class="sd">      Unlike BERTopic, TMT has an option for saving both embeddings and the doc corpus - or optionally</span>
</span><span id="TopicModelTuner-341"><a href="#TopicModelTuner-341"><span class="linenos">341</span></a><span class="sd">      omitting them.</span>
</span><span id="TopicModelTuner-342"><a href="#TopicModelTuner-342"><span class="linenos">342</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-343"><a href="#TopicModelTuner-343"><span class="linenos">343</span></a>      
</span><span id="TopicModelTuner-344"><a href="#TopicModelTuner-344"><span class="linenos">344</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span> 
</span><span id="TopicModelTuner-345"><a href="#TopicModelTuner-345"><span class="linenos">345</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">reducer_model</span> <span class="c1"># Used to reduce the embeddings (if necessary)</span>
</span><span id="TopicModelTuner-346"><a href="#TopicModelTuner-346"><span class="linenos">346</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span> <span class="o">=</span> <span class="n">reducer_components</span>
</span><span id="TopicModelTuner-347"><a href="#TopicModelTuner-347"><span class="linenos">347</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="n">reducer_random_state</span>
</span><span id="TopicModelTuner-348"><a href="#TopicModelTuner-348"><span class="linenos">348</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner-349"><a href="#TopicModelTuner-349"><span class="linenos">349</span></a>
</span><span id="TopicModelTuner-350"><a href="#TopicModelTuner-350"><span class="linenos">350</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># A reducer (defaults to UMAP to create a 2D reduction for a</span>
</span><span id="TopicModelTuner-351"><a href="#TopicModelTuner-351"><span class="linenos">351</span></a>                              <span class="c1"># scatter plot visualization of the embeddings</span>
</span><span id="TopicModelTuner-352"><a href="#TopicModelTuner-352"><span class="linenos">352</span></a>
</span><span id="TopicModelTuner-353"><a href="#TopicModelTuner-353"><span class="linenos">353</span></a>
</span><span id="TopicModelTuner-354"><a href="#TopicModelTuner-354"><span class="linenos">354</span></a>      
</span><span id="TopicModelTuner-355"><a href="#TopicModelTuner-355"><span class="linenos">355</span></a>      <span class="k">if</span> <span class="n">embedding_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-356"><a href="#TopicModelTuner-356"><span class="linenos">356</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s1">&#39;all-MiniLM-L6-v2&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-357"><a href="#TopicModelTuner-357"><span class="linenos">357</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner-358"><a href="#TopicModelTuner-358"><span class="linenos">358</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">embedding_model</span>
</span><span id="TopicModelTuner-359"><a href="#TopicModelTuner-359"><span class="linenos">359</span></a>    
</span><span id="TopicModelTuner-360"><a href="#TopicModelTuner-360"><span class="linenos">360</span></a>      <span class="k">if</span> <span class="n">reducer_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># Use default BERTopic params </span>
</span><span id="TopicModelTuner-361"><a href="#TopicModelTuner-361"><span class="linenos">361</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="p">,</span> 
</span><span id="TopicModelTuner-362"><a href="#TopicModelTuner-362"><span class="linenos">362</span></a>                                    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> 
</span><span id="TopicModelTuner-363"><a href="#TopicModelTuner-363"><span class="linenos">363</span></a>                                    <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
</span><span id="TopicModelTuner-364"><a href="#TopicModelTuner-364"><span class="linenos">364</span></a>                                    <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
</span><span id="TopicModelTuner-365"><a href="#TopicModelTuner-365"><span class="linenos">365</span></a>                                    <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="TopicModelTuner-366"><a href="#TopicModelTuner-366"><span class="linenos">366</span></a>
</span><span id="TopicModelTuner-367"><a href="#TopicModelTuner-367"><span class="linenos">367</span></a>      <span class="c1"># Default BERTopic params</span>
</span><span id="TopicModelTuner-368"><a href="#TopicModelTuner-368"><span class="linenos">368</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-369"><a href="#TopicModelTuner-369"><span class="linenos">369</span></a>                             <span class="s1">&#39;cluster_selection_method&#39;</span><span class="p">:</span> <span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-370"><a href="#TopicModelTuner-370"><span class="linenos">370</span></a>                             <span class="s1">&#39;prediction_data&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner-371"><a href="#TopicModelTuner-371"><span class="linenos">371</span></a>                             <span class="s1">&#39;min_cluster_size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="TopicModelTuner-372"><a href="#TopicModelTuner-372"><span class="linenos">372</span></a>                             <span class="p">}</span>
</span><span id="TopicModelTuner-373"><a href="#TopicModelTuner-373"><span class="linenos">373</span></a>
</span><span id="TopicModelTuner-374"><a href="#TopicModelTuner-374"><span class="linenos">374</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TopicModelTuner-375"><a href="#TopicModelTuner-375"><span class="linenos">375</span></a>    <span class="k">def</span> <span class="nf">wrapBERTopicModel</span><span class="p">(</span><span class="n">BERTopicModel</span> <span class="p">:</span> <span class="n">BERTopic</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-376"><a href="#TopicModelTuner-376"><span class="linenos">376</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-377"><a href="#TopicModelTuner-377"><span class="linenos">377</span></a><span class="sd">      This is a helper function which returns a TMT instance using the values from a BERTopic instance.</span>
</span><span id="TopicModelTuner-378"><a href="#TopicModelTuner-378"><span class="linenos">378</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-379"><a href="#TopicModelTuner-379"><span class="linenos">379</span></a>  
</span><span id="TopicModelTuner-380"><a href="#TopicModelTuner-380"><span class="linenos">380</span></a>      <span class="k">return</span> <span class="n">TopicModelTuner</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
</span><span id="TopicModelTuner-381"><a href="#TopicModelTuner-381"><span class="linenos">381</span></a>                               <span class="n">reducer_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">umap_model</span><span class="p">,</span>
</span><span id="TopicModelTuner-382"><a href="#TopicModelTuner-382"><span class="linenos">382</span></a>                               <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="TopicModelTuner-383"><a href="#TopicModelTuner-383"><span class="linenos">383</span></a>                            <span class="p">)</span>
</span><span id="TopicModelTuner-384"><a href="#TopicModelTuner-384"><span class="linenos">384</span></a>
</span><span id="TopicModelTuner-385"><a href="#TopicModelTuner-385"><span class="linenos">385</span></a>    <span class="k">def</span> <span class="nf">getBERTopicModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TopicModelTuner-386"><a href="#TopicModelTuner-386"><span class="linenos">386</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-387"><a href="#TopicModelTuner-387"><span class="linenos">387</span></a><span class="sd">      Returns a BERTopic model with the specified HDBSCAN parameters. The user is left</span>
</span><span id="TopicModelTuner-388"><a href="#TopicModelTuner-388"><span class="linenos">388</span></a><span class="sd">      to specify their chosen best settings after running a series of parameters searches.</span>
</span><span id="TopicModelTuner-389"><a href="#TopicModelTuner-389"><span class="linenos">389</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner-390"><a href="#TopicModelTuner-390"><span class="linenos">390</span></a><span class="sd">      This function is necessary because any given HDBSCAN parameters will return somewhat different </span>
</span><span id="TopicModelTuner-391"><a href="#TopicModelTuner-391"><span class="linenos">391</span></a><span class="sd">      results when clustering a given UMAP reduction, simply using the parameters derived from a tuned</span>
</span><span id="TopicModelTuner-392"><a href="#TopicModelTuner-392"><span class="linenos">392</span></a><span class="sd">      TMT model will not produce the same results for a new BERTopic instance. </span>
</span><span id="TopicModelTuner-393"><a href="#TopicModelTuner-393"><span class="linenos">393</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner-394"><a href="#TopicModelTuner-394"><span class="linenos">394</span></a><span class="sd">      The reason for this is that BERTopic re-runs UMAP each time fit() is </span>
</span><span id="TopicModelTuner-395"><a href="#TopicModelTuner-395"><span class="linenos">395</span></a><span class="sd">      called. Since different runs of UMAP will have  different characteristics, to recreate</span>
</span><span id="TopicModelTuner-396"><a href="#TopicModelTuner-396"><span class="linenos">396</span></a><span class="sd">      the desired results in the new BERTopic model we need to use the same random seed for the BERTopic&#39;s UMAP</span>
</span><span id="TopicModelTuner-397"><a href="#TopicModelTuner-397"><span class="linenos">397</span></a><span class="sd">      as was used in the TMT model.</span>
</span><span id="TopicModelTuner-398"><a href="#TopicModelTuner-398"><span class="linenos">398</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-399"><a href="#TopicModelTuner-399"><span class="linenos">399</span></a>      
</span><span id="TopicModelTuner-400"><a href="#TopicModelTuner-400"><span class="linenos">400</span></a>      <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_CS_SS</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="TopicModelTuner-401"><a href="#TopicModelTuner-401"><span class="linenos">401</span></a>
</span><span id="TopicModelTuner-402"><a href="#TopicModelTuner-402"><span class="linenos">402</span></a>      <span class="n">hdbscan_params</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="TopicModelTuner-403"><a href="#TopicModelTuner-403"><span class="linenos">403</span></a>      <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="TopicModelTuner-404"><a href="#TopicModelTuner-404"><span class="linenos">404</span></a>      <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="TopicModelTuner-405"><a href="#TopicModelTuner-405"><span class="linenos">405</span></a>        
</span><span id="TopicModelTuner-406"><a href="#TopicModelTuner-406"><span class="linenos">406</span></a>      <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="o">**</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="TopicModelTuner-407"><a href="#TopicModelTuner-407"><span class="linenos">407</span></a>
</span><span id="TopicModelTuner-408"><a href="#TopicModelTuner-408"><span class="linenos">408</span></a>      <span class="k">return</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">umap_model</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">),</span>
</span><span id="TopicModelTuner-409"><a href="#TopicModelTuner-409"><span class="linenos">409</span></a>                      <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="TopicModelTuner-410"><a href="#TopicModelTuner-410"><span class="linenos">410</span></a>
</span><span id="TopicModelTuner-411"><a href="#TopicModelTuner-411"><span class="linenos">411</span></a>    
</span><span id="TopicModelTuner-412"><a href="#TopicModelTuner-412"><span class="linenos">412</span></a>    <span class="k">def</span> <span class="nf">createEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-413"><a href="#TopicModelTuner-413"><span class="linenos">413</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-414"><a href="#TopicModelTuner-414"><span class="linenos">414</span></a><span class="sd">      Create embeddings </span>
</span><span id="TopicModelTuner-415"><a href="#TopicModelTuner-415"><span class="linenos">415</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-416"><a href="#TopicModelTuner-416"><span class="linenos">416</span></a>      <span class="c1"># if self.embeddings != None :</span>
</span><span id="TopicModelTuner-417"><a href="#TopicModelTuner-417"><span class="linenos">417</span></a>      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-418"><a href="#TopicModelTuner-418"><span class="linenos">418</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Embeddings already created, reset by setting TMT.embeddings=None&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-419"><a href="#TopicModelTuner-419"><span class="linenos">419</span></a>        
</span><span id="TopicModelTuner-420"><a href="#TopicModelTuner-420"><span class="linenos">420</span></a>      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-421"><a href="#TopicModelTuner-421"><span class="linenos">421</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Docs not specified, set docs=&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-422"><a href="#TopicModelTuner-422"><span class="linenos">422</span></a>        
</span><span id="TopicModelTuner-423"><a href="#TopicModelTuner-423"><span class="linenos">423</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">=</span><span class="n">docs</span>
</span><span id="TopicModelTuner-424"><a href="#TopicModelTuner-424"><span class="linenos">424</span></a>             
</span><span id="TopicModelTuner-425"><a href="#TopicModelTuner-425"><span class="linenos">425</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
</span><span id="TopicModelTuner-426"><a href="#TopicModelTuner-426"><span class="linenos">426</span></a>    
</span><span id="TopicModelTuner-427"><a href="#TopicModelTuner-427"><span class="linenos">427</span></a>        
</span><span id="TopicModelTuner-428"><a href="#TopicModelTuner-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-429"><a href="#TopicModelTuner-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-430"><a href="#TopicModelTuner-430"><span class="linenos">430</span></a><span class="sd">        Reduce dimensionality of the embeddings</span>
</span><span id="TopicModelTuner-431"><a href="#TopicModelTuner-431"><span class="linenos">431</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-432"><a href="#TopicModelTuner-432"><span class="linenos">432</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-433"><a href="#TopicModelTuner-433"><span class="linenos">433</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings set, call TMT.createEmbeddings() or set TMT.embeddings=&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-434"><a href="#TopicModelTuner-434"><span class="linenos">434</span></a>        
</span><span id="TopicModelTuner-435"><a href="#TopicModelTuner-435"><span class="linenos">435</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>  
</span><span id="TopicModelTuner-436"><a href="#TopicModelTuner-436"><span class="linenos">436</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="c1"># The reducer has already set a random_state</span>
</span><span id="TopicModelTuner-437"><a href="#TopicModelTuner-437"><span class="linenos">437</span></a>        <span class="k">else</span> <span class="p">:</span>  
</span><span id="TopicModelTuner-438"><a href="#TopicModelTuner-438"><span class="linenos">438</span></a>          <span class="n">random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="c1"># could be None</span>
</span><span id="TopicModelTuner-439"><a href="#TopicModelTuner-439"><span class="linenos">439</span></a>          <span class="k">if</span> <span class="n">random_state</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>  <span class="c1"># Reducer random state was not set but tmt random state was</span>
</span><span id="TopicModelTuner-440"><a href="#TopicModelTuner-440"><span class="linenos">440</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>  <span class="c1"># set reducer model random state</span>
</span><span id="TopicModelTuner-441"><a href="#TopicModelTuner-441"><span class="linenos">441</span></a>          <span class="k">else</span> <span class="p">:</span> <span class="c1"># set new random state and capture it</span>
</span><span id="TopicModelTuner-442"><a href="#TopicModelTuner-442"><span class="linenos">442</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span> <span class="c1"># new value</span>
</span><span id="TopicModelTuner-443"><a href="#TopicModelTuner-443"><span class="linenos">443</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="c1"># sync TMT random state</span>
</span><span id="TopicModelTuner-444"><a href="#TopicModelTuner-444"><span class="linenos">444</span></a>        
</span><span id="TopicModelTuner-445"><a href="#TopicModelTuner-445"><span class="linenos">445</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>    
</span><span id="TopicModelTuner-446"><a href="#TopicModelTuner-446"><span class="linenos">446</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span> 
</span><span id="TopicModelTuner-447"><a href="#TopicModelTuner-447"><span class="linenos">447</span></a>    
</span><span id="TopicModelTuner-448"><a href="#TopicModelTuner-448"><span class="linenos">448</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;UMAP&#39;</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-449"><a href="#TopicModelTuner-449"><span class="linenos">449</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-450"><a href="#TopicModelTuner-450"><span class="linenos">450</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="TopicModelTuner-451"><a href="#TopicModelTuner-451"><span class="linenos">451</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-452"><a href="#TopicModelTuner-452"><span class="linenos">452</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-453"><a href="#TopicModelTuner-453"><span class="linenos">453</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-454"><a href="#TopicModelTuner-454"><span class="linenos">454</span></a>
</span><span id="TopicModelTuner-455"><a href="#TopicModelTuner-455"><span class="linenos">455</span></a>      <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;UMAP&#39;</span> <span class="p">:</span>
</span><span id="TopicModelTuner-456"><a href="#TopicModelTuner-456"><span class="linenos">456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="TopicModelTuner-457"><a href="#TopicModelTuner-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="TopicModelTuner-458"><a href="#TopicModelTuner-458"><span class="linenos">458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="TopicModelTuner-459"><a href="#TopicModelTuner-459"><span class="linenos">459</span></a>      <span class="k">else</span> <span class="p">:</span> <span class="c1"># Only TSNE is supported</span>
</span><span id="TopicModelTuner-460"><a href="#TopicModelTuner-460"><span class="linenos">460</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span><span class="p">)</span>
</span><span id="TopicModelTuner-461"><a href="#TopicModelTuner-461"><span class="linenos">461</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="TopicModelTuner-462"><a href="#TopicModelTuner-462"><span class="linenos">462</span></a>        
</span><span id="TopicModelTuner-463"><a href="#TopicModelTuner-463"><span class="linenos">463</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span>
</span><span id="TopicModelTuner-464"><a href="#TopicModelTuner-464"><span class="linenos">464</span></a>
</span><span id="TopicModelTuner-465"><a href="#TopicModelTuner-465"><span class="linenos">465</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-466"><a href="#TopicModelTuner-466"><span class="linenos">466</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-467"><a href="#TopicModelTuner-467"><span class="linenos">467</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="TopicModelTuner-468"><a href="#TopicModelTuner-468"><span class="linenos">468</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-469"><a href="#TopicModelTuner-469"><span class="linenos">469</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-470"><a href="#TopicModelTuner-470"><span class="linenos">470</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-471"><a href="#TopicModelTuner-471"><span class="linenos">471</span></a> 
</span><span id="TopicModelTuner-472"><a href="#TopicModelTuner-472"><span class="linenos">472</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TopicModelTuner-473"><a href="#TopicModelTuner-473"><span class="linenos">473</span></a>
</span><span id="TopicModelTuner-474"><a href="#TopicModelTuner-474"><span class="linenos">474</span></a>      
</span><span id="TopicModelTuner-475"><a href="#TopicModelTuner-475"><span class="linenos">475</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-476"><a href="#TopicModelTuner-476"><span class="linenos">476</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-477"><a href="#TopicModelTuner-477"><span class="linenos">477</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided HDBSCAN parameters.</span>
</span><span id="TopicModelTuner-478"><a href="#TopicModelTuner-478"><span class="linenos">478</span></a><span class="sd">      If TMT.docs has been set then the first 400 chars of each document will be shown as a </span>
</span><span id="TopicModelTuner-479"><a href="#TopicModelTuner-479"><span class="linenos">479</span></a><span class="sd">      hover over each data point.</span>
</span><span id="TopicModelTuner-480"><a href="#TopicModelTuner-480"><span class="linenos">480</span></a><span class="sd">  </span>
</span><span id="TopicModelTuner-481"><a href="#TopicModelTuner-481"><span class="linenos">481</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="TopicModelTuner-482"><a href="#TopicModelTuner-482"><span class="linenos">482</span></a><span class="sd">      &#39;&#39;&#39;</span>  
</span><span id="TopicModelTuner-483"><a href="#TopicModelTuner-483"><span class="linenos">483</span></a>      
</span><span id="TopicModelTuner-484"><a href="#TopicModelTuner-484"><span class="linenos">484</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="TopicModelTuner-485"><a href="#TopicModelTuner-485"><span class="linenos">485</span></a>
</span><span id="TopicModelTuner-486"><a href="#TopicModelTuner-486"><span class="linenos">486</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="TopicModelTuner-487"><a href="#TopicModelTuner-487"><span class="linenos">487</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="TopicModelTuner-488"><a href="#TopicModelTuner-488"><span class="linenos">488</span></a>
</span><span id="TopicModelTuner-489"><a href="#TopicModelTuner-489"><span class="linenos">489</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-490"><a href="#TopicModelTuner-490"><span class="linenos">490</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="TopicModelTuner-491"><a href="#TopicModelTuner-491"><span class="linenos">491</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="TopicModelTuner-492"><a href="#TopicModelTuner-492"><span class="linenos">492</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="TopicModelTuner-493"><a href="#TopicModelTuner-493"><span class="linenos">493</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner-494"><a href="#TopicModelTuner-494"><span class="linenos">494</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-495"><a href="#TopicModelTuner-495"><span class="linenos">495</span></a>          
</span><span id="TopicModelTuner-496"><a href="#TopicModelTuner-496"><span class="linenos">496</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="TopicModelTuner-497"><a href="#TopicModelTuner-497"><span class="linenos">497</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-498"><a href="#TopicModelTuner-498"><span class="linenos">498</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-499"><a href="#TopicModelTuner-499"><span class="linenos">499</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="TopicModelTuner-500"><a href="#TopicModelTuner-500"><span class="linenos">500</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="TopicModelTuner-501"><a href="#TopicModelTuner-501"><span class="linenos">501</span></a>
</span><span id="TopicModelTuner-502"><a href="#TopicModelTuner-502"><span class="linenos">502</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span><span id="TopicModelTuner-503"><a href="#TopicModelTuner-503"><span class="linenos">503</span></a>        
</span><span id="TopicModelTuner-504"><a href="#TopicModelTuner-504"><span class="linenos">504</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner-505"><a href="#TopicModelTuner-505"><span class="linenos">505</span></a>             <span class="n">fname</span><span class="p">,</span>
</span><span id="TopicModelTuner-506"><a href="#TopicModelTuner-506"><span class="linenos">506</span></a>             <span class="n">save_docs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner-507"><a href="#TopicModelTuner-507"><span class="linenos">507</span></a>             <span class="n">save_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner-508"><a href="#TopicModelTuner-508"><span class="linenos">508</span></a>             <span class="n">save_viz_reducer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-509"><a href="#TopicModelTuner-509"><span class="linenos">509</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-510"><a href="#TopicModelTuner-510"><span class="linenos">510</span></a><span class="sd">      Saves the TMT object. User can choose whether or not to save docs, embeddings and/or</span>
</span><span id="TopicModelTuner-511"><a href="#TopicModelTuner-511"><span class="linenos">511</span></a><span class="sd">      the viz reduction</span>
</span><span id="TopicModelTuner-512"><a href="#TopicModelTuner-512"><span class="linenos">512</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-513"><a href="#TopicModelTuner-513"><span class="linenos">513</span></a>      
</span><span id="TopicModelTuner-514"><a href="#TopicModelTuner-514"><span class="linenos">514</span></a>      <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
</span><span id="TopicModelTuner-515"><a href="#TopicModelTuner-515"><span class="linenos">515</span></a>      <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span>
</span><span id="TopicModelTuner-516"><a href="#TopicModelTuner-516"><span class="linenos">516</span></a>      <span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span>
</span><span id="TopicModelTuner-517"><a href="#TopicModelTuner-517"><span class="linenos">517</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="kc">None</span> 
</span><span id="TopicModelTuner-518"><a href="#TopicModelTuner-518"><span class="linenos">518</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>
</span><span id="TopicModelTuner-519"><a href="#TopicModelTuner-519"><span class="linenos">519</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_docs</span> <span class="p">:</span>
</span><span id="TopicModelTuner-520"><a href="#TopicModelTuner-520"><span class="linenos">520</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-521"><a href="#TopicModelTuner-521"><span class="linenos">521</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embeddings</span> <span class="p">:</span>
</span><span id="TopicModelTuner-522"><a href="#TopicModelTuner-522"><span class="linenos">522</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-523"><a href="#TopicModelTuner-523"><span class="linenos">523</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_viz_reducer</span> <span class="p">:</span>
</span><span id="TopicModelTuner-524"><a href="#TopicModelTuner-524"><span class="linenos">524</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-525"><a href="#TopicModelTuner-525"><span class="linenos">525</span></a>          <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="TopicModelTuner-526"><a href="#TopicModelTuner-526"><span class="linenos">526</span></a>          
</span><span id="TopicModelTuner-527"><a href="#TopicModelTuner-527"><span class="linenos">527</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner-528"><a href="#TopicModelTuner-528"><span class="linenos">528</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span>
</span><span id="TopicModelTuner-529"><a href="#TopicModelTuner-529"><span class="linenos">529</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span>
</span><span id="TopicModelTuner-530"><a href="#TopicModelTuner-530"><span class="linenos">530</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span> 
</span><span id="TopicModelTuner-531"><a href="#TopicModelTuner-531"><span class="linenos">531</span></a>     
</span><span id="TopicModelTuner-532"><a href="#TopicModelTuner-532"><span class="linenos">532</span></a>    <span class="nd">@staticmethod</span>    
</span><span id="TopicModelTuner-533"><a href="#TopicModelTuner-533"><span class="linenos">533</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-534"><a href="#TopicModelTuner-534"><span class="linenos">534</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-535"><a href="#TopicModelTuner-535"><span class="linenos">535</span></a><span class="sd">      Restore a saved TMT object from disk</span>
</span><span id="TopicModelTuner-536"><a href="#TopicModelTuner-536"><span class="linenos">536</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-537"><a href="#TopicModelTuner-537"><span class="linenos">537</span></a>      
</span><span id="TopicModelTuner-538"><a href="#TopicModelTuner-538"><span class="linenos">538</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>    
</span><span id="TopicModelTuner-539"><a href="#TopicModelTuner-539"><span class="linenos">539</span></a>        <span class="n">restored</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="TopicModelTuner-540"><a href="#TopicModelTuner-540"><span class="linenos">540</span></a>        <span class="n">restored</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span> 
</span><span id="TopicModelTuner-541"><a href="#TopicModelTuner-541"><span class="linenos">541</span></a>        <span class="k">return</span> <span class="n">restored</span>
</span></pre></div>


            <div class="docstring"><p>TopicModelTuner (TMT) is a tool to optimize the min_clust_size and min_sample parameters 
of HDBSCAN. It is a compliment to the BERTopic default configuration and assumes that 
HDBSCAN is being used to cluster UMAP reductions of embeddings. </p>

<p>The convenience function TMT.wrapBERTopicModel() returns a TMT instance initialized 
with the provided BERTopic model's embedding model, HDBSCAN and UMAP instances and
parameters. </p>

<p>Alternatively a new TMT instance can be created from scratch and, in either case, 
once the optimized parameters have been identified, calling TMT.getBERTopicModel()
returns a configured BERTopic instance with the desired parameters.</p>

<p>TMT does not explicitly provide functionality for testing alternative UMAP parameters or
HDBSCAN parameters other than min_cluster_size or min_samples. However both the HDBSCAN
and UMAP models are exposed within the class and can be set to any parameters desired.</p>
</div>


                            <div id="TopicModelTuner.__init__" class="classattr">
                                        <input id="TopicModelTuner.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TopicModelTuner</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">embeddings</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reducer_model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">reducer_random_state</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">reducer_components</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">reduced_embeddings</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">hdbscan_model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">viz_reduction</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span>)</span>

                <label class="view-source-button" for="TopicModelTuner.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.__init__-304"><a href="#TopicModelTuner.__init__-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-305"><a href="#TopicModelTuner.__init__-305"><span class="linenos">305</span></a>                 <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># pre-generated embeddings</span>
</span><span id="TopicModelTuner.__init__-306"><a href="#TopicModelTuner.__init__-306"><span class="linenos">306</span></a>                 <span class="n">embedding_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># set for alternative transformer embedding model</span>
</span><span id="TopicModelTuner.__init__-307"><a href="#TopicModelTuner.__init__-307"><span class="linenos">307</span></a>                 <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># can be set here or when embeddings are created manually</span>
</span><span id="TopicModelTuner.__init__-308"><a href="#TopicModelTuner.__init__-308"><span class="linenos">308</span></a>                 <span class="n">reducer_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># a UMAP instance</span>
</span><span id="TopicModelTuner.__init__-309"><a href="#TopicModelTuner.__init__-309"><span class="linenos">309</span></a>                 <span class="n">reducer_random_state</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-310"><a href="#TopicModelTuner.__init__-310"><span class="linenos">310</span></a>                 <span class="n">reducer_components</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-311"><a href="#TopicModelTuner.__init__-311"><span class="linenos">311</span></a>                 <span class="n">reduced_embeddings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-312"><a href="#TopicModelTuner.__init__-312"><span class="linenos">312</span></a>                 <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># an HDBSCAN instance</span>
</span><span id="TopicModelTuner.__init__-313"><a href="#TopicModelTuner.__init__-313"><span class="linenos">313</span></a>                 <span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-314"><a href="#TopicModelTuner.__init__-314"><span class="linenos">314</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="c1">#: for UMAP</span>
</span><span id="TopicModelTuner.__init__-315"><a href="#TopicModelTuner.__init__-315"><span class="linenos">315</span></a>        
</span><span id="TopicModelTuner.__init__-316"><a href="#TopicModelTuner.__init__-316"><span class="linenos">316</span></a>      <span class="n">BaseHDBSCANTuner</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-317"><a href="#TopicModelTuner.__init__-317"><span class="linenos">317</span></a>                   <span class="n">HDBSCAN_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-318"><a href="#TopicModelTuner.__init__-318"><span class="linenos">318</span></a>                   <span class="n">target_vectors</span> <span class="o">=</span> <span class="n">reduced_embeddings</span><span class="p">,</span> <span class="c1"># Set the reduced embeddings to be clustered </span>
</span><span id="TopicModelTuner.__init__-319"><a href="#TopicModelTuner.__init__-319"><span class="linenos">319</span></a>                   <span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-320"><a href="#TopicModelTuner.__init__-320"><span class="linenos">320</span></a>                   <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="TopicModelTuner.__init__-321"><a href="#TopicModelTuner.__init__-321"><span class="linenos">321</span></a>
</span><span id="TopicModelTuner.__init__-322"><a href="#TopicModelTuner.__init__-322"><span class="linenos">322</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.__init__-323"><a href="#TopicModelTuner.__init__-323"><span class="linenos">323</span></a><span class="sd">      Unless explicitly set, TMT Uses the same default param defaults for the embedding model </span>
</span><span id="TopicModelTuner.__init__-324"><a href="#TopicModelTuner.__init__-324"><span class="linenos">324</span></a><span class="sd">      as well as HDBSCAN and UMAP parameters as are used in the BERTopic defaults. </span>
</span><span id="TopicModelTuner.__init__-325"><a href="#TopicModelTuner.__init__-325"><span class="linenos">325</span></a>
</span><span id="TopicModelTuner.__init__-326"><a href="#TopicModelTuner.__init__-326"><span class="linenos">326</span></a><span class="sd">      - &#39;all-MiniLM-L6-v2&#39; sentence transformer as the default language model embedding.</span>
</span><span id="TopicModelTuner.__init__-327"><a href="#TopicModelTuner.__init__-327"><span class="linenos">327</span></a><span class="sd">      - UMAP - metric=&#39;cosine&#39;, n_neighbors=5, min_dist=0.0</span>
</span><span id="TopicModelTuner.__init__-328"><a href="#TopicModelTuner.__init__-328"><span class="linenos">328</span></a><span class="sd">      - HDBSCAN - metric=&#39;euclidean&#39;, cluster_selection_method=&#39;eom&#39;, prediction_data=True,</span>
</span><span id="TopicModelTuner.__init__-329"><a href="#TopicModelTuner.__init__-329"><span class="linenos">329</span></a><span class="sd">                  min_cluster_size = 10.</span>
</span><span id="TopicModelTuner.__init__-330"><a href="#TopicModelTuner.__init__-330"><span class="linenos">330</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner.__init__-331"><a href="#TopicModelTuner.__init__-331"><span class="linenos">331</span></a><span class="sd">      Options include:</span>
</span><span id="TopicModelTuner.__init__-332"><a href="#TopicModelTuner.__init__-332"><span class="linenos">332</span></a>
</span><span id="TopicModelTuner.__init__-333"><a href="#TopicModelTuner.__init__-333"><span class="linenos">333</span></a><span class="sd">      - Using your own embeddings by setting TMT.embeddings after creating an instance</span>
</span><span id="TopicModelTuner.__init__-334"><a href="#TopicModelTuner.__init__-334"><span class="linenos">334</span></a><span class="sd">      - Using different UMAP settings or a different dimensional reduction method by setting TMT.reducer_model</span>
</span><span id="TopicModelTuner.__init__-335"><a href="#TopicModelTuner.__init__-335"><span class="linenos">335</span></a><span class="sd">      - Using different HDBSCAN parameters by setting TMT.hdbscan_model</span>
</span><span id="TopicModelTuner.__init__-336"><a href="#TopicModelTuner.__init__-336"><span class="linenos">336</span></a>
</span><span id="TopicModelTuner.__init__-337"><a href="#TopicModelTuner.__init__-337"><span class="linenos">337</span></a><span class="sd">      These can be set in the constructor or after instantiation by setting the instance variables </span>
</span><span id="TopicModelTuner.__init__-338"><a href="#TopicModelTuner.__init__-338"><span class="linenos">338</span></a><span class="sd">      before generating the embeddings or reduction.</span>
</span><span id="TopicModelTuner.__init__-339"><a href="#TopicModelTuner.__init__-339"><span class="linenos">339</span></a>
</span><span id="TopicModelTuner.__init__-340"><a href="#TopicModelTuner.__init__-340"><span class="linenos">340</span></a><span class="sd">      Unlike BERTopic, TMT has an option for saving both embeddings and the doc corpus - or optionally</span>
</span><span id="TopicModelTuner.__init__-341"><a href="#TopicModelTuner.__init__-341"><span class="linenos">341</span></a><span class="sd">      omitting them.</span>
</span><span id="TopicModelTuner.__init__-342"><a href="#TopicModelTuner.__init__-342"><span class="linenos">342</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.__init__-343"><a href="#TopicModelTuner.__init__-343"><span class="linenos">343</span></a>      
</span><span id="TopicModelTuner.__init__-344"><a href="#TopicModelTuner.__init__-344"><span class="linenos">344</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span> 
</span><span id="TopicModelTuner.__init__-345"><a href="#TopicModelTuner.__init__-345"><span class="linenos">345</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">reducer_model</span> <span class="c1"># Used to reduce the embeddings (if necessary)</span>
</span><span id="TopicModelTuner.__init__-346"><a href="#TopicModelTuner.__init__-346"><span class="linenos">346</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span> <span class="o">=</span> <span class="n">reducer_components</span>
</span><span id="TopicModelTuner.__init__-347"><a href="#TopicModelTuner.__init__-347"><span class="linenos">347</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="n">reducer_random_state</span>
</span><span id="TopicModelTuner.__init__-348"><a href="#TopicModelTuner.__init__-348"><span class="linenos">348</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner.__init__-349"><a href="#TopicModelTuner.__init__-349"><span class="linenos">349</span></a>
</span><span id="TopicModelTuner.__init__-350"><a href="#TopicModelTuner.__init__-350"><span class="linenos">350</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># A reducer (defaults to UMAP to create a 2D reduction for a</span>
</span><span id="TopicModelTuner.__init__-351"><a href="#TopicModelTuner.__init__-351"><span class="linenos">351</span></a>                              <span class="c1"># scatter plot visualization of the embeddings</span>
</span><span id="TopicModelTuner.__init__-352"><a href="#TopicModelTuner.__init__-352"><span class="linenos">352</span></a>
</span><span id="TopicModelTuner.__init__-353"><a href="#TopicModelTuner.__init__-353"><span class="linenos">353</span></a>
</span><span id="TopicModelTuner.__init__-354"><a href="#TopicModelTuner.__init__-354"><span class="linenos">354</span></a>      
</span><span id="TopicModelTuner.__init__-355"><a href="#TopicModelTuner.__init__-355"><span class="linenos">355</span></a>      <span class="k">if</span> <span class="n">embedding_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.__init__-356"><a href="#TopicModelTuner.__init__-356"><span class="linenos">356</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s1">&#39;all-MiniLM-L6-v2&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.__init__-357"><a href="#TopicModelTuner.__init__-357"><span class="linenos">357</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner.__init__-358"><a href="#TopicModelTuner.__init__-358"><span class="linenos">358</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">embedding_model</span>
</span><span id="TopicModelTuner.__init__-359"><a href="#TopicModelTuner.__init__-359"><span class="linenos">359</span></a>    
</span><span id="TopicModelTuner.__init__-360"><a href="#TopicModelTuner.__init__-360"><span class="linenos">360</span></a>      <span class="k">if</span> <span class="n">reducer_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># Use default BERTopic params </span>
</span><span id="TopicModelTuner.__init__-361"><a href="#TopicModelTuner.__init__-361"><span class="linenos">361</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-362"><a href="#TopicModelTuner.__init__-362"><span class="linenos">362</span></a>                                    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-363"><a href="#TopicModelTuner.__init__-363"><span class="linenos">363</span></a>                                    <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-364"><a href="#TopicModelTuner.__init__-364"><span class="linenos">364</span></a>                                    <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-365"><a href="#TopicModelTuner.__init__-365"><span class="linenos">365</span></a>                                    <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="TopicModelTuner.__init__-366"><a href="#TopicModelTuner.__init__-366"><span class="linenos">366</span></a>
</span><span id="TopicModelTuner.__init__-367"><a href="#TopicModelTuner.__init__-367"><span class="linenos">367</span></a>      <span class="c1"># Default BERTopic params</span>
</span><span id="TopicModelTuner.__init__-368"><a href="#TopicModelTuner.__init__-368"><span class="linenos">368</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-369"><a href="#TopicModelTuner.__init__-369"><span class="linenos">369</span></a>                             <span class="s1">&#39;cluster_selection_method&#39;</span><span class="p">:</span> <span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-370"><a href="#TopicModelTuner.__init__-370"><span class="linenos">370</span></a>                             <span class="s1">&#39;prediction_data&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-371"><a href="#TopicModelTuner.__init__-371"><span class="linenos">371</span></a>                             <span class="s1">&#39;min_cluster_size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="TopicModelTuner.__init__-372"><a href="#TopicModelTuner.__init__-372"><span class="linenos">372</span></a>                             <span class="p">}</span>
</span></pre></div>


    

                            </div>
                            <div id="TopicModelTuner.wrapBERTopicModel" class="classattr">
                                        <input id="TopicModelTuner.wrapBERTopicModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">wrapBERTopicModel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">BERTopicModel</span><span class="p">:</span> <span class="n">bertopic</span><span class="o">.</span><span class="n">_bertopic</span><span class="o">.</span><span class="n">BERTopic</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.wrapBERTopicModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.wrapBERTopicModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.wrapBERTopicModel-374"><a href="#TopicModelTuner.wrapBERTopicModel-374"><span class="linenos">374</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-375"><a href="#TopicModelTuner.wrapBERTopicModel-375"><span class="linenos">375</span></a>    <span class="k">def</span> <span class="nf">wrapBERTopicModel</span><span class="p">(</span><span class="n">BERTopicModel</span> <span class="p">:</span> <span class="n">BERTopic</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-376"><a href="#TopicModelTuner.wrapBERTopicModel-376"><span class="linenos">376</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-377"><a href="#TopicModelTuner.wrapBERTopicModel-377"><span class="linenos">377</span></a><span class="sd">      This is a helper function which returns a TMT instance using the values from a BERTopic instance.</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-378"><a href="#TopicModelTuner.wrapBERTopicModel-378"><span class="linenos">378</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-379"><a href="#TopicModelTuner.wrapBERTopicModel-379"><span class="linenos">379</span></a>  
</span><span id="TopicModelTuner.wrapBERTopicModel-380"><a href="#TopicModelTuner.wrapBERTopicModel-380"><span class="linenos">380</span></a>      <span class="k">return</span> <span class="n">TopicModelTuner</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-381"><a href="#TopicModelTuner.wrapBERTopicModel-381"><span class="linenos">381</span></a>                               <span class="n">reducer_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">umap_model</span><span class="p">,</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-382"><a href="#TopicModelTuner.wrapBERTopicModel-382"><span class="linenos">382</span></a>                               <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-383"><a href="#TopicModelTuner.wrapBERTopicModel-383"><span class="linenos">383</span></a>                            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This is a helper function which returns a TMT instance using the values from a BERTopic instance.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.getBERTopicModel" class="classattr">
                                        <input id="TopicModelTuner.getBERTopicModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getBERTopicModel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.getBERTopicModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.getBERTopicModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.getBERTopicModel-385"><a href="#TopicModelTuner.getBERTopicModel-385"><span class="linenos">385</span></a>    <span class="k">def</span> <span class="nf">getBERTopicModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TopicModelTuner.getBERTopicModel-386"><a href="#TopicModelTuner.getBERTopicModel-386"><span class="linenos">386</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.getBERTopicModel-387"><a href="#TopicModelTuner.getBERTopicModel-387"><span class="linenos">387</span></a><span class="sd">      Returns a BERTopic model with the specified HDBSCAN parameters. The user is left</span>
</span><span id="TopicModelTuner.getBERTopicModel-388"><a href="#TopicModelTuner.getBERTopicModel-388"><span class="linenos">388</span></a><span class="sd">      to specify their chosen best settings after running a series of parameters searches.</span>
</span><span id="TopicModelTuner.getBERTopicModel-389"><a href="#TopicModelTuner.getBERTopicModel-389"><span class="linenos">389</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner.getBERTopicModel-390"><a href="#TopicModelTuner.getBERTopicModel-390"><span class="linenos">390</span></a><span class="sd">      This function is necessary because any given HDBSCAN parameters will return somewhat different </span>
</span><span id="TopicModelTuner.getBERTopicModel-391"><a href="#TopicModelTuner.getBERTopicModel-391"><span class="linenos">391</span></a><span class="sd">      results when clustering a given UMAP reduction, simply using the parameters derived from a tuned</span>
</span><span id="TopicModelTuner.getBERTopicModel-392"><a href="#TopicModelTuner.getBERTopicModel-392"><span class="linenos">392</span></a><span class="sd">      TMT model will not produce the same results for a new BERTopic instance. </span>
</span><span id="TopicModelTuner.getBERTopicModel-393"><a href="#TopicModelTuner.getBERTopicModel-393"><span class="linenos">393</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner.getBERTopicModel-394"><a href="#TopicModelTuner.getBERTopicModel-394"><span class="linenos">394</span></a><span class="sd">      The reason for this is that BERTopic re-runs UMAP each time fit() is </span>
</span><span id="TopicModelTuner.getBERTopicModel-395"><a href="#TopicModelTuner.getBERTopicModel-395"><span class="linenos">395</span></a><span class="sd">      called. Since different runs of UMAP will have  different characteristics, to recreate</span>
</span><span id="TopicModelTuner.getBERTopicModel-396"><a href="#TopicModelTuner.getBERTopicModel-396"><span class="linenos">396</span></a><span class="sd">      the desired results in the new BERTopic model we need to use the same random seed for the BERTopic&#39;s UMAP</span>
</span><span id="TopicModelTuner.getBERTopicModel-397"><a href="#TopicModelTuner.getBERTopicModel-397"><span class="linenos">397</span></a><span class="sd">      as was used in the TMT model.</span>
</span><span id="TopicModelTuner.getBERTopicModel-398"><a href="#TopicModelTuner.getBERTopicModel-398"><span class="linenos">398</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.getBERTopicModel-399"><a href="#TopicModelTuner.getBERTopicModel-399"><span class="linenos">399</span></a>      
</span><span id="TopicModelTuner.getBERTopicModel-400"><a href="#TopicModelTuner.getBERTopicModel-400"><span class="linenos">400</span></a>      <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_CS_SS</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="TopicModelTuner.getBERTopicModel-401"><a href="#TopicModelTuner.getBERTopicModel-401"><span class="linenos">401</span></a>
</span><span id="TopicModelTuner.getBERTopicModel-402"><a href="#TopicModelTuner.getBERTopicModel-402"><span class="linenos">402</span></a>      <span class="n">hdbscan_params</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="TopicModelTuner.getBERTopicModel-403"><a href="#TopicModelTuner.getBERTopicModel-403"><span class="linenos">403</span></a>      <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="TopicModelTuner.getBERTopicModel-404"><a href="#TopicModelTuner.getBERTopicModel-404"><span class="linenos">404</span></a>      <span class="n">hdbscan_params</span><span class="p">[</span><span class="s1">&#39;min_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_samples</span>
</span><span id="TopicModelTuner.getBERTopicModel-405"><a href="#TopicModelTuner.getBERTopicModel-405"><span class="linenos">405</span></a>        
</span><span id="TopicModelTuner.getBERTopicModel-406"><a href="#TopicModelTuner.getBERTopicModel-406"><span class="linenos">406</span></a>      <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="o">**</span><span class="n">hdbscan_params</span><span class="p">)</span>
</span><span id="TopicModelTuner.getBERTopicModel-407"><a href="#TopicModelTuner.getBERTopicModel-407"><span class="linenos">407</span></a>
</span><span id="TopicModelTuner.getBERTopicModel-408"><a href="#TopicModelTuner.getBERTopicModel-408"><span class="linenos">408</span></a>      <span class="k">return</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">umap_model</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">),</span>
</span><span id="TopicModelTuner.getBERTopicModel-409"><a href="#TopicModelTuner.getBERTopicModel-409"><span class="linenos">409</span></a>                      <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a BERTopic model with the specified HDBSCAN parameters. The user is left
to specify their chosen best settings after running a series of parameters searches.</p>

<p>This function is necessary because any given HDBSCAN parameters will return somewhat different 
results when clustering a given UMAP reduction, simply using the parameters derived from a tuned
TMT model will not produce the same results for a new BERTopic instance. </p>

<p>The reason for this is that BERTopic re-runs UMAP each time fit() is 
called. Since different runs of UMAP will have  different characteristics, to recreate
the desired results in the new BERTopic model we need to use the same random seed for the BERTopic's UMAP
as was used in the TMT model.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.createEmbeddings" class="classattr">
                                        <input id="TopicModelTuner.createEmbeddings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">createEmbeddings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.createEmbeddings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.createEmbeddings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.createEmbeddings-412"><a href="#TopicModelTuner.createEmbeddings-412"><span class="linenos">412</span></a>    <span class="k">def</span> <span class="nf">createEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createEmbeddings-413"><a href="#TopicModelTuner.createEmbeddings-413"><span class="linenos">413</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.createEmbeddings-414"><a href="#TopicModelTuner.createEmbeddings-414"><span class="linenos">414</span></a><span class="sd">      Create embeddings </span>
</span><span id="TopicModelTuner.createEmbeddings-415"><a href="#TopicModelTuner.createEmbeddings-415"><span class="linenos">415</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.createEmbeddings-416"><a href="#TopicModelTuner.createEmbeddings-416"><span class="linenos">416</span></a>      <span class="c1"># if self.embeddings != None :</span>
</span><span id="TopicModelTuner.createEmbeddings-417"><a href="#TopicModelTuner.createEmbeddings-417"><span class="linenos">417</span></a>      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createEmbeddings-418"><a href="#TopicModelTuner.createEmbeddings-418"><span class="linenos">418</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Embeddings already created, reset by setting TMT.embeddings=None&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.createEmbeddings-419"><a href="#TopicModelTuner.createEmbeddings-419"><span class="linenos">419</span></a>        
</span><span id="TopicModelTuner.createEmbeddings-420"><a href="#TopicModelTuner.createEmbeddings-420"><span class="linenos">420</span></a>      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createEmbeddings-421"><a href="#TopicModelTuner.createEmbeddings-421"><span class="linenos">421</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Docs not specified, set docs=&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.createEmbeddings-422"><a href="#TopicModelTuner.createEmbeddings-422"><span class="linenos">422</span></a>        
</span><span id="TopicModelTuner.createEmbeddings-423"><a href="#TopicModelTuner.createEmbeddings-423"><span class="linenos">423</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">=</span><span class="n">docs</span>
</span><span id="TopicModelTuner.createEmbeddings-424"><a href="#TopicModelTuner.createEmbeddings-424"><span class="linenos">424</span></a>             
</span><span id="TopicModelTuner.createEmbeddings-425"><a href="#TopicModelTuner.createEmbeddings-425"><span class="linenos">425</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create embeddings</p>
</div>


                            </div>
                            <div id="TopicModelTuner.reduce" class="classattr">
                                        <input id="TopicModelTuner.reduce-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.reduce-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.reduce"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.reduce-428"><a href="#TopicModelTuner.reduce-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.reduce-429"><a href="#TopicModelTuner.reduce-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.reduce-430"><a href="#TopicModelTuner.reduce-430"><span class="linenos">430</span></a><span class="sd">        Reduce dimensionality of the embeddings</span>
</span><span id="TopicModelTuner.reduce-431"><a href="#TopicModelTuner.reduce-431"><span class="linenos">431</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.reduce-432"><a href="#TopicModelTuner.reduce-432"><span class="linenos">432</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.reduce-433"><a href="#TopicModelTuner.reduce-433"><span class="linenos">433</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings set, call TMT.createEmbeddings() or set TMT.embeddings=&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.reduce-434"><a href="#TopicModelTuner.reduce-434"><span class="linenos">434</span></a>        
</span><span id="TopicModelTuner.reduce-435"><a href="#TopicModelTuner.reduce-435"><span class="linenos">435</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>  
</span><span id="TopicModelTuner.reduce-436"><a href="#TopicModelTuner.reduce-436"><span class="linenos">436</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="c1"># The reducer has already set a random_state</span>
</span><span id="TopicModelTuner.reduce-437"><a href="#TopicModelTuner.reduce-437"><span class="linenos">437</span></a>        <span class="k">else</span> <span class="p">:</span>  
</span><span id="TopicModelTuner.reduce-438"><a href="#TopicModelTuner.reduce-438"><span class="linenos">438</span></a>          <span class="n">random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="c1"># could be None</span>
</span><span id="TopicModelTuner.reduce-439"><a href="#TopicModelTuner.reduce-439"><span class="linenos">439</span></a>          <span class="k">if</span> <span class="n">random_state</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>  <span class="c1"># Reducer random state was not set but tmt random state was</span>
</span><span id="TopicModelTuner.reduce-440"><a href="#TopicModelTuner.reduce-440"><span class="linenos">440</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>  <span class="c1"># set reducer model random state</span>
</span><span id="TopicModelTuner.reduce-441"><a href="#TopicModelTuner.reduce-441"><span class="linenos">441</span></a>          <span class="k">else</span> <span class="p">:</span> <span class="c1"># set new random state and capture it</span>
</span><span id="TopicModelTuner.reduce-442"><a href="#TopicModelTuner.reduce-442"><span class="linenos">442</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span> <span class="c1"># new value</span>
</span><span id="TopicModelTuner.reduce-443"><a href="#TopicModelTuner.reduce-443"><span class="linenos">443</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">random_state</span> <span class="c1"># sync TMT random state</span>
</span><span id="TopicModelTuner.reduce-444"><a href="#TopicModelTuner.reduce-444"><span class="linenos">444</span></a>        
</span><span id="TopicModelTuner.reduce-445"><a href="#TopicModelTuner.reduce-445"><span class="linenos">445</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>    
</span><span id="TopicModelTuner.reduce-446"><a href="#TopicModelTuner.reduce-446"><span class="linenos">446</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span> 
</span></pre></div>


            <div class="docstring"><p>Reduce dimensionality of the embeddings</p>
</div>


                            </div>
                            <div id="TopicModelTuner.createVizReduction" class="classattr">
                                        <input id="TopicModelTuner.createVizReduction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">createVizReduction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="s1">&#39;UMAP&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.createVizReduction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.createVizReduction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.createVizReduction-448"><a href="#TopicModelTuner.createVizReduction-448"><span class="linenos">448</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;UMAP&#39;</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createVizReduction-449"><a href="#TopicModelTuner.createVizReduction-449"><span class="linenos">449</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.createVizReduction-450"><a href="#TopicModelTuner.createVizReduction-450"><span class="linenos">450</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="TopicModelTuner.createVizReduction-451"><a href="#TopicModelTuner.createVizReduction-451"><span class="linenos">451</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.createVizReduction-452"><a href="#TopicModelTuner.createVizReduction-452"><span class="linenos">452</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createVizReduction-453"><a href="#TopicModelTuner.createVizReduction-453"><span class="linenos">453</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.createVizReduction-454"><a href="#TopicModelTuner.createVizReduction-454"><span class="linenos">454</span></a>
</span><span id="TopicModelTuner.createVizReduction-455"><a href="#TopicModelTuner.createVizReduction-455"><span class="linenos">455</span></a>      <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;UMAP&#39;</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createVizReduction-456"><a href="#TopicModelTuner.createVizReduction-456"><span class="linenos">456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="TopicModelTuner.createVizReduction-457"><a href="#TopicModelTuner.createVizReduction-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="TopicModelTuner.createVizReduction-458"><a href="#TopicModelTuner.createVizReduction-458"><span class="linenos">458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="TopicModelTuner.createVizReduction-459"><a href="#TopicModelTuner.createVizReduction-459"><span class="linenos">459</span></a>      <span class="k">else</span> <span class="p">:</span> <span class="c1"># Only TSNE is supported</span>
</span><span id="TopicModelTuner.createVizReduction-460"><a href="#TopicModelTuner.createVizReduction-460"><span class="linenos">460</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_random_state</span><span class="p">)</span>
</span><span id="TopicModelTuner.createVizReduction-461"><a href="#TopicModelTuner.createVizReduction-461"><span class="linenos">461</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="TopicModelTuner.createVizReduction-462"><a href="#TopicModelTuner.createVizReduction-462"><span class="linenos">462</span></a>        
</span><span id="TopicModelTuner.createVizReduction-463"><a href="#TopicModelTuner.createVizReduction-463"><span class="linenos">463</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span>
</span></pre></div>


            <div class="docstring"><p>Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</p>
</div>


                            </div>
                            <div id="TopicModelTuner.getVizCoords" class="classattr">
                                        <input id="TopicModelTuner.getVizCoords-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getVizCoords</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.getVizCoords-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.getVizCoords"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.getVizCoords-465"><a href="#TopicModelTuner.getVizCoords-465"><span class="linenos">465</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.getVizCoords-466"><a href="#TopicModelTuner.getVizCoords-466"><span class="linenos">466</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.getVizCoords-467"><a href="#TopicModelTuner.getVizCoords-467"><span class="linenos">467</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="TopicModelTuner.getVizCoords-468"><a href="#TopicModelTuner.getVizCoords-468"><span class="linenos">468</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.getVizCoords-469"><a href="#TopicModelTuner.getVizCoords-469"><span class="linenos">469</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.getVizCoords-470"><a href="#TopicModelTuner.getVizCoords-470"><span class="linenos">470</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.getVizCoords-471"><a href="#TopicModelTuner.getVizCoords-471"><span class="linenos">471</span></a> 
</span><span id="TopicModelTuner.getVizCoords-472"><a href="#TopicModelTuner.getVizCoords-472"><span class="linenos">472</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.visualizeEmbeddings" class="classattr">
                                        <input id="TopicModelTuner.visualizeEmbeddings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualizeEmbeddings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.visualizeEmbeddings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.visualizeEmbeddings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.visualizeEmbeddings-475"><a href="#TopicModelTuner.visualizeEmbeddings-475"><span class="linenos">475</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-476"><a href="#TopicModelTuner.visualizeEmbeddings-476"><span class="linenos">476</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-477"><a href="#TopicModelTuner.visualizeEmbeddings-477"><span class="linenos">477</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided HDBSCAN parameters.</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-478"><a href="#TopicModelTuner.visualizeEmbeddings-478"><span class="linenos">478</span></a><span class="sd">      If TMT.docs has been set then the first 400 chars of each document will be shown as a </span>
</span><span id="TopicModelTuner.visualizeEmbeddings-479"><a href="#TopicModelTuner.visualizeEmbeddings-479"><span class="linenos">479</span></a><span class="sd">      hover over each data point.</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-480"><a href="#TopicModelTuner.visualizeEmbeddings-480"><span class="linenos">480</span></a><span class="sd">  </span>
</span><span id="TopicModelTuner.visualizeEmbeddings-481"><a href="#TopicModelTuner.visualizeEmbeddings-481"><span class="linenos">481</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-482"><a href="#TopicModelTuner.visualizeEmbeddings-482"><span class="linenos">482</span></a><span class="sd">      &#39;&#39;&#39;</span>  
</span><span id="TopicModelTuner.visualizeEmbeddings-483"><a href="#TopicModelTuner.visualizeEmbeddings-483"><span class="linenos">483</span></a>      
</span><span id="TopicModelTuner.visualizeEmbeddings-484"><a href="#TopicModelTuner.visualizeEmbeddings-484"><span class="linenos">484</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">)</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-485"><a href="#TopicModelTuner.visualizeEmbeddings-485"><span class="linenos">485</span></a>
</span><span id="TopicModelTuner.visualizeEmbeddings-486"><a href="#TopicModelTuner.visualizeEmbeddings-486"><span class="linenos">486</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-487"><a href="#TopicModelTuner.visualizeEmbeddings-487"><span class="linenos">487</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-488"><a href="#TopicModelTuner.visualizeEmbeddings-488"><span class="linenos">488</span></a>
</span><span id="TopicModelTuner.visualizeEmbeddings-489"><a href="#TopicModelTuner.visualizeEmbeddings-489"><span class="linenos">489</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-490"><a href="#TopicModelTuner.visualizeEmbeddings-490"><span class="linenos">490</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-491"><a href="#TopicModelTuner.visualizeEmbeddings-491"><span class="linenos">491</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-492"><a href="#TopicModelTuner.visualizeEmbeddings-492"><span class="linenos">492</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-493"><a href="#TopicModelTuner.visualizeEmbeddings-493"><span class="linenos">493</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-494"><a href="#TopicModelTuner.visualizeEmbeddings-494"><span class="linenos">494</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-495"><a href="#TopicModelTuner.visualizeEmbeddings-495"><span class="linenos">495</span></a>          
</span><span id="TopicModelTuner.visualizeEmbeddings-496"><a href="#TopicModelTuner.visualizeEmbeddings-496"><span class="linenos">496</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-497"><a href="#TopicModelTuner.visualizeEmbeddings-497"><span class="linenos">497</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-498"><a href="#TopicModelTuner.visualizeEmbeddings-498"><span class="linenos">498</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-499"><a href="#TopicModelTuner.visualizeEmbeddings-499"><span class="linenos">499</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-500"><a href="#TopicModelTuner.visualizeEmbeddings-500"><span class="linenos">500</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-501"><a href="#TopicModelTuner.visualizeEmbeddings-501"><span class="linenos">501</span></a>
</span><span id="TopicModelTuner.visualizeEmbeddings-502"><a href="#TopicModelTuner.visualizeEmbeddings-502"><span class="linenos">502</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span></pre></div>


            <div class="docstring"><p>Visualize the embeddings, clustered according to the provided HDBSCAN parameters.
If TMT.docs has been set then the first 400 chars of each document will be shown as a 
hover over each data point.</p>

<p>Returns a plotly fig object</p>
</div>


                            </div>
                            <div id="TopicModelTuner.save" class="classattr">
                                        <input id="TopicModelTuner.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fname</span>,</span><span class="param">	<span class="n">save_docs</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">save_embeddings</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">save_viz_reducer</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.save-504"><a href="#TopicModelTuner.save-504"><span class="linenos">504</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner.save-505"><a href="#TopicModelTuner.save-505"><span class="linenos">505</span></a>             <span class="n">fname</span><span class="p">,</span>
</span><span id="TopicModelTuner.save-506"><a href="#TopicModelTuner.save-506"><span class="linenos">506</span></a>             <span class="n">save_docs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner.save-507"><a href="#TopicModelTuner.save-507"><span class="linenos">507</span></a>             <span class="n">save_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner.save-508"><a href="#TopicModelTuner.save-508"><span class="linenos">508</span></a>             <span class="n">save_viz_reducer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-509"><a href="#TopicModelTuner.save-509"><span class="linenos">509</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.save-510"><a href="#TopicModelTuner.save-510"><span class="linenos">510</span></a><span class="sd">      Saves the TMT object. User can choose whether or not to save docs, embeddings and/or</span>
</span><span id="TopicModelTuner.save-511"><a href="#TopicModelTuner.save-511"><span class="linenos">511</span></a><span class="sd">      the viz reduction</span>
</span><span id="TopicModelTuner.save-512"><a href="#TopicModelTuner.save-512"><span class="linenos">512</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.save-513"><a href="#TopicModelTuner.save-513"><span class="linenos">513</span></a>      
</span><span id="TopicModelTuner.save-514"><a href="#TopicModelTuner.save-514"><span class="linenos">514</span></a>      <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
</span><span id="TopicModelTuner.save-515"><a href="#TopicModelTuner.save-515"><span class="linenos">515</span></a>      <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span>
</span><span id="TopicModelTuner.save-516"><a href="#TopicModelTuner.save-516"><span class="linenos">516</span></a>      <span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span>
</span><span id="TopicModelTuner.save-517"><a href="#TopicModelTuner.save-517"><span class="linenos">517</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="kc">None</span> 
</span><span id="TopicModelTuner.save-518"><a href="#TopicModelTuner.save-518"><span class="linenos">518</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-519"><a href="#TopicModelTuner.save-519"><span class="linenos">519</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_docs</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-520"><a href="#TopicModelTuner.save-520"><span class="linenos">520</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.save-521"><a href="#TopicModelTuner.save-521"><span class="linenos">521</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embeddings</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-522"><a href="#TopicModelTuner.save-522"><span class="linenos">522</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.save-523"><a href="#TopicModelTuner.save-523"><span class="linenos">523</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_viz_reducer</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-524"><a href="#TopicModelTuner.save-524"><span class="linenos">524</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.save-525"><a href="#TopicModelTuner.save-525"><span class="linenos">525</span></a>          <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="TopicModelTuner.save-526"><a href="#TopicModelTuner.save-526"><span class="linenos">526</span></a>          
</span><span id="TopicModelTuner.save-527"><a href="#TopicModelTuner.save-527"><span class="linenos">527</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner.save-528"><a href="#TopicModelTuner.save-528"><span class="linenos">528</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span>
</span><span id="TopicModelTuner.save-529"><a href="#TopicModelTuner.save-529"><span class="linenos">529</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span>
</span><span id="TopicModelTuner.save-530"><a href="#TopicModelTuner.save-530"><span class="linenos">530</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span> 
</span></pre></div>


            <div class="docstring"><p>Saves the TMT object. User can choose whether or not to save docs, embeddings and/or
the viz reduction</p>
</div>


                            </div>
                            <div id="TopicModelTuner.load" class="classattr">
                                        <input id="TopicModelTuner.load-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">load</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fname</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.load-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.load"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.load-532"><a href="#TopicModelTuner.load-532"><span class="linenos">532</span></a>    <span class="nd">@staticmethod</span>    
</span><span id="TopicModelTuner.load-533"><a href="#TopicModelTuner.load-533"><span class="linenos">533</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.load-534"><a href="#TopicModelTuner.load-534"><span class="linenos">534</span></a><span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.load-535"><a href="#TopicModelTuner.load-535"><span class="linenos">535</span></a><span class="sd">      Restore a saved TMT object from disk</span>
</span><span id="TopicModelTuner.load-536"><a href="#TopicModelTuner.load-536"><span class="linenos">536</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.load-537"><a href="#TopicModelTuner.load-537"><span class="linenos">537</span></a>      
</span><span id="TopicModelTuner.load-538"><a href="#TopicModelTuner.load-538"><span class="linenos">538</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>    
</span><span id="TopicModelTuner.load-539"><a href="#TopicModelTuner.load-539"><span class="linenos">539</span></a>        <span class="n">restored</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="TopicModelTuner.load-540"><a href="#TopicModelTuner.load-540"><span class="linenos">540</span></a>        <span class="n">restored</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span> 
</span><span id="TopicModelTuner.load-541"><a href="#TopicModelTuner.load-541"><span class="linenos">541</span></a>        <span class="k">return</span> <span class="n">restored</span>
</span></pre></div>


            <div class="docstring"><p>Restore a saved TMT object from disk</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#BaseHDBSCANTuner">BaseHDBSCANTuner</a></dt>
                                <dd id="TopicModelTuner.runHDBSCAN" class="function"><a href="#BaseHDBSCANTuner.runHDBSCAN">runHDBSCAN</a></dd>
                <dd id="TopicModelTuner.randomSearch" class="function"><a href="#BaseHDBSCANTuner.randomSearch">randomSearch</a></dd>
                <dd id="TopicModelTuner.psuedoGridSearch" class="function"><a href="#BaseHDBSCANTuner.psuedoGridSearch">psuedoGridSearch</a></dd>
                <dd id="TopicModelTuner.simpleSearch" class="function"><a href="#BaseHDBSCANTuner.simpleSearch">simpleSearch</a></dd>
                <dd id="TopicModelTuner.gridSearch" class="function"><a href="#BaseHDBSCANTuner.gridSearch">gridSearch</a></dd>
                <dd id="TopicModelTuner.visualizeSearch" class="function"><a href="#BaseHDBSCANTuner.visualizeSearch">visualizeSearch</a></dd>
                <dd id="TopicModelTuner.summarizeResults" class="function"><a href="#BaseHDBSCANTuner.summarizeResults">summarizeResults</a></dd>
                <dd id="TopicModelTuner.clearSearches" class="function"><a href="#BaseHDBSCANTuner.clearSearches">clearSearches</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
</body>
</html>