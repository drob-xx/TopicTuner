<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.2.0"/>
    <title>TopicTuner.topictuner API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../TopicTuner.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;TopicTuner</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#TopicModelTuner">TopicModelTuner</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TopicModelTuner.__init__">TopicModelTuner</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.wrapBERTopicModel">wrapBERTopicModel</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.getBERTopicModel">getBERTopicModel</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.createEmbeddings">createEmbeddings</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.reduce">reduce</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.createVizReduction">createVizReduction</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.getVizCoords">getVizCoords</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.visualizeEmbeddings">visualizeEmbeddings</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.runHDBSCAN">runHDBSCAN</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.randomSearch">randomSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.gridSearch">gridSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.simpleSearch">simpleSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.visualizeSearch">visualizeSearch</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.summarizeResults">summarizeResults</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#TopicModelTuner.load">load</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#UMAP_facade">UMAP_facade</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#UMAP_facade.__init__">UMAP_facade</a>
                        </li>
                        <li>
                                <a class="function" href="#UMAP_facade.fit">fit</a>
                        </li>
                        <li>
                                <a class="function" href="#UMAP_facade.transform">transform</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../TopicTuner.html">TopicTuner</a><wbr>.topictuner    </h1>

                        <div class="docstring"><p>Created on Jul 19, 2022</p>

<p>@author: Dan Robinson</p>
</div>

                        <input id="mod-topictuner-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-topictuner-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Created on Jul 19, 2022</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">@author: Dan Robinson</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">bertopic</span> <span class="kn">import</span> <span class="n">BERTopic</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">umap</span> <span class="kn">import</span> <span class="n">UMAP</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">hdbscan</span> <span class="kn">import</span> <span class="n">HDBSCAN</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randrange</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">wrap</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span> <span class="nn">joblib</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="k">class</span> <span class="nc">TopicModelTuner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>    <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    TopicModelTuner (TMT) provides a set of tools to  </span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    optimize the min_clust_size and min_sample parameters of HDBSCAN. It is written</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    to compliment BERTopic default models and assumes that HDBSCAN is being used</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    to cluster a UMAP reduction of embeddings. </span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    </span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    A TMT instance can be initialized with the convenience TMT.wrapBERTopicModel() function which</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    returns a TMT instance initialized with the embedding model, HDBSCAN and UMAP</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    parameters in a given BERTopic model. Otherwise, a new TMT instance can be</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    created from scratch. In either case, once the optimized parameters have been identified</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    TMT.getBERTopicModel() will return a BERTopic instance with the desired parameters.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    </span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    TMT does not explicitly provide functionality for testing alternative UMAP parameters or</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    HDBSCAN parameters other than min_cluster_size or min_samples. However both the HDBSCAN</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    and UMAP models are exposed within the class and can be set to any parameters desired. </span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>                 <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: pre-generated embeddings</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>                 <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: set for alternative transformer embedding model</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>                 <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: can be set here or when embeddings are created manually</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>                 <span class="n">reducer_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: a UMAP instance</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>                 <span class="n">hdbscan_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: an HDBSCAN instance</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>                 <span class="n">reducer_components</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="c1">#: for UMAP</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span> <span class="c1">#: for UMAP</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">      Default initialization which assumes the BERTopic defaults for the embedding model </span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">      (&#39;all-MiniLM-L6-v2&#39; sentence transformer) as well as HDBSCAN and UMAP parameters. </span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">      </span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">      1) &#39;all-MiniLM-L6-v2&#39; sentence transformer as the default language model embedding.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">      2) UMAP as the reduction method set to 5 features using the same parameters as BERTopic defaults to.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">      3) HDBSCAN as the clustering mechansim</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">      Options include:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">      - Using your own embeddings by setting TMT.embeddings after creating an instance</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">      - Using different UMAP settings or a different dimensional reduction method by setting TMT.reducer_model</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">      - Using different HDBSCAN parameters by setting TMT.hdbscan_model</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">      These can be set in the constructor or after instantiation by setting the instance variables.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">      Unlike BERTopic, TMT has an option for saving both embeddings and the doc corpus - or optionally</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">      omitting them.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>      
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="c1">#: Passed through to UMAP</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span> <span class="c1">#: Can be set with pre-generated embedding</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="o">=</span><span class="n">reducer_components</span> 
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">reducer_model</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>      <span class="k">if</span> <span class="n">embedding_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s1">&#39;all-MiniLM-L6-v2&#39;</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">embedding_model</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>          
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>      <span class="k">if</span> <span class="n">reducer_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> 
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="p">,</span> 
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>                             <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> 
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>                             <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                             <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>                             <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>          <span class="c1"># this is a kludge.  See below for test to see if UMAP model has been fitted.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="nf">wrapBERTopicModel</span><span class="p">(</span><span class="n">BERTopicModel</span> <span class="p">:</span> <span class="n">BERTopic</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">      This is a helper function which returns a TMT instance using the values from a BERTopic instance.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>  
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>      <span class="k">return</span> <span class="n">TopicModelTuner</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                               <span class="n">reducer_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">umap_model</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                               <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>                               <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">getBERTopicModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">):</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">      Returns a BERTopic model with the specified HDBSCAN parameters, regardles</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">      of whether or not the TMT instance was created using the default __init__() or </span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">      the helper wrapBERTopicModel() funciton.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">      </span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">      The user is left to specify their chosen best settings after running a series of </span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">      candidate parameters.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">      </span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">      The reason for this function is to return a BERTopic instance with create a </span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">      UMAP_facade object as an argument to the BERTopic initialization, since any </span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">      given HDBSCAN parameter set will be specific to a particular run of UMAP. </span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">      Just using a tuned HDBSCAN</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">      instance (or simply using the parameters derived from a tuning session) will </span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">      not provide the best results in a new BERTopic instance. This is because BERTopic</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">      will re-run UMAP each time fit() is called. Different runs of UMAP will have slightly </span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">      different characteristics and will therefore perform differently with different </span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">      HDBSCAN settings. HDBSCAN on the other hand will always return the same values assuming</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">      that all the paremeters, and the data being clustered, are the same.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>      <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>                                      <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>                                      <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>                                      <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>                                      <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                                      <span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>      <span class="k">return</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">umap_model</span><span class="o">=</span><span class="n">UMAP_facade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span><span class="p">),</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                      <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">createEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">      Create embeddings using the embedding model specified during initiliazation.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Embeddings already created, reset by setting embeddings=None&#39;</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Docs not specified, set docs=&#39;</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>      <span class="k">if</span> <span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">=</span><span class="n">docs</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>             
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">      Reduce dimensionality of the embeddings</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>      <span class="k">try</span> <span class="p">:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings set, call TMT.createEmbeddings() or set TMT.embeddings directly&#39;</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>      <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>          <span class="k">pass</span> <span class="c1"># embeddings already set</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>      <span class="k">try</span> <span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>      <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>          <span class="k">pass</span> <span class="c1"># embeddings already set</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>      
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided parameters.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">      If docs has been set then the first 400 chars of each document will be </span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">      shown as a hover over each data point.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">  </span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>          
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">runHDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">      Cluster reduced embeddings. sample_size must be more than 0 and less than</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">      or equal to min_cluster_size.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>          <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>                                      <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>                                      <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                                      <span class="n">min_samples</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                                      <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                                      <span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>          <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>          <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_samples</span> <span class="o">=</span> <span class="n">sample_size</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>          <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_cluster_size</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>  
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>      <span class="k">return</span> <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span><span class="p">)</span>  
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">_runTests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchParams</span><span class="p">):</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">      Internal call to run a passel of HDBSCAN within a given range of parameters.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">      cluster_size_range is a list of ints and sample_size_pct_range is a list of percentages e.g.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">      [.1, .25, .50, .75, 1]. One of the percent values will be randomly chosen and </span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">      multiplied by the randomly chosen cluster_size_range to produce a min_samples</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">      value for HDBSCAN. The calulated min_samples value must be larger than 0 and not </span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">      greater than the selected cluster_size_range value.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>      <span class="c1"># results = []</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>      <span class="c1"># for params in tqdm(searchParams) :</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>      <span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">))</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)]</span> 
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>          <span class="c1"># results.append((params.cs, params.ss, self.runHDBSCAN(params.cs, params.ss)))</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>      <span class="n">RunResultsDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tupe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;sample_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tupe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tupe</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>      <span class="n">uncategorized</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>      <span class="k">for</span> <span class="n">aDict</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tupe</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span> <span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">aDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">uncategorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aDict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">uncategorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncategorized</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span><span class="p">,</span> <span class="n">RunResultsDF</span><span class="p">])</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>  
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>      <span class="k">return</span> <span class="n">RunResultsDF</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>    <span class="k">def</span> <span class="nf">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size</span><span class="p">,</span> <span class="n">sample_size_pct</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="n">sample_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cluster_size</span> <span class="o">*</span> <span class="n">sample_size_pct</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">sample_size</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>          <span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>      
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>  
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>    <span class="k">def</span> <span class="nf">_genRandomSearchParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>      <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">searchParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">))],</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>                                        <span class="n">sample_size_pct_range</span><span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_size_pct_range</span><span class="p">))]</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>                                       <span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>      <span class="k">return</span> <span class="n">searchParams</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="k">def</span> <span class="nf">_genGridSearchParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>      <span class="k">for</span> <span class="n">cluster_size</span> <span class="ow">in</span> <span class="n">cluster_sizes</span> <span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">for</span> <span class="n">sample_size_pct</span> <span class="ow">in</span> <span class="n">sample_size_pct_range</span> <span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>          <span class="n">searchParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">,</span> <span class="n">sample_size_pct</span><span class="p">))</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>      <span class="k">return</span> <span class="n">searchParams</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>  
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>    <span class="k">def</span> <span class="nf">randomSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genRandomSearchParams</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>    <span class="k">def</span> <span class="nf">gridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genGridSearchParams</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">simpleSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length of cluster sizes and samples sizes lists must match&#39;</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)])</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>  
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">visualizeSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultsDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">      Runs iters number of randomly generated cluster size and sample range pairs</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">      against the embeddings. Note that sample sizes have to be a percentage value of </span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">      a given cluster_size and cannot be 0. </span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">      Returns both a plotly fig with a parrallel_coordinates chart of the run as well</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">      as a summarized version of the data produced by the run. Each run will produce</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">      its own summary table, but a history of all runs is also stored in the objects ResultsDF</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">      attribute.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>    
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>      <span class="c1"># if self.reducer_model.embedding_.sum() == 0  :</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>      <span class="c1">#     raise AttributeError(&#39;Reducer not run yet, call createReduction() first&#39;)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">parallel_coordinates</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">,</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> 
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                                    <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                                            <span class="s2">&quot;sample_size&quot;</span><span class="p">:</span> <span class="s2">&quot;ample_size&quot;</span><span class="p">,</span> 
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                                            <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">:</span> <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>                                            <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">:</span> <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> <span class="p">},)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>      <span class="k">return</span> <span class="n">fig</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>  
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="k">def</span> <span class="nf">summarizeResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summaryDF</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">      Pass this a DataFrame with run results - either the summary DF from a given</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">      run or the historical table run and it will return a table where each record </span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">      represents contains the smallest number of uncategorized documents for a given</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">      number of clusters.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>      <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>      <span class="k">for</span> <span class="n">num_clusters</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">resultSummaryDF</span><span class="p">,</span> <span class="n">summaryDF</span><span class="p">[</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">num_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]])</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>      <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>      <span class="k">return</span> <span class="n">resultSummaryDF</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>             <span class="n">fname</span><span class="p">,</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>             <span class="n">save_docs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>             <span class="n">save_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>             <span class="n">save_viz_reduction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">      Saves the TMT object. User can choose whether or not to save docs, embeddings and/or</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">      the viz reduction</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>      
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>      <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>      <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>      <span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_docs</span> <span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embeddings</span> <span class="p">:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_viz_reduction</span> <span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>          <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>          
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>     
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>    <span class="nd">@staticmethod</span>    
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">      Restore a saved TMT object from disk</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>      
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>    
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="k">class</span> <span class="nc">UMAP_facade</span> <span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">    Since by default BERTopic re-runs UMAP each time fit() is called,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">    this class allows for a BERTopic instance to have fixed UMAP embedding. </span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">    Necessary to achieve the best optimized HDBSCAN results because each </span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">    UMAP reduction will vary and require slightly different HDBSCAN parameters.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">):</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        Pass in the umap_embeddings you want to optimize HDBSCAN for. </span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        &#39;&#39;&#39;</span> 
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings_</span> <span class="o">=</span> <span class="n">umap_embeddings</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        Does nothing except conform to the interface BERTopic expects.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">        Returns fixed embeddings,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        NOTE RE EMBEDDINGS PARAM</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        &#39;&#39;&#39;</span> 
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings_</span> 
</span></pre></div>


            </section>
                <section id="TopicModelTuner">
                            <input id="TopicModelTuner-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TopicModelTuner</span>:

                <label class="view-source-button" for="TopicModelTuner-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner-25"><a href="#TopicModelTuner-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">TopicModelTuner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="TopicModelTuner-26"><a href="#TopicModelTuner-26"><span class="linenos"> 26</span></a>    <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-27"><a href="#TopicModelTuner-27"><span class="linenos"> 27</span></a><span class="sd">    TopicModelTuner (TMT) provides a set of tools to  </span>
</span><span id="TopicModelTuner-28"><a href="#TopicModelTuner-28"><span class="linenos"> 28</span></a><span class="sd">    optimize the min_clust_size and min_sample parameters of HDBSCAN. It is written</span>
</span><span id="TopicModelTuner-29"><a href="#TopicModelTuner-29"><span class="linenos"> 29</span></a><span class="sd">    to compliment BERTopic default models and assumes that HDBSCAN is being used</span>
</span><span id="TopicModelTuner-30"><a href="#TopicModelTuner-30"><span class="linenos"> 30</span></a><span class="sd">    to cluster a UMAP reduction of embeddings. </span>
</span><span id="TopicModelTuner-31"><a href="#TopicModelTuner-31"><span class="linenos"> 31</span></a><span class="sd">    </span>
</span><span id="TopicModelTuner-32"><a href="#TopicModelTuner-32"><span class="linenos"> 32</span></a><span class="sd">    A TMT instance can be initialized with the convenience TMT.wrapBERTopicModel() function which</span>
</span><span id="TopicModelTuner-33"><a href="#TopicModelTuner-33"><span class="linenos"> 33</span></a><span class="sd">    returns a TMT instance initialized with the embedding model, HDBSCAN and UMAP</span>
</span><span id="TopicModelTuner-34"><a href="#TopicModelTuner-34"><span class="linenos"> 34</span></a><span class="sd">    parameters in a given BERTopic model. Otherwise, a new TMT instance can be</span>
</span><span id="TopicModelTuner-35"><a href="#TopicModelTuner-35"><span class="linenos"> 35</span></a><span class="sd">    created from scratch. In either case, once the optimized parameters have been identified</span>
</span><span id="TopicModelTuner-36"><a href="#TopicModelTuner-36"><span class="linenos"> 36</span></a><span class="sd">    TMT.getBERTopicModel() will return a BERTopic instance with the desired parameters.</span>
</span><span id="TopicModelTuner-37"><a href="#TopicModelTuner-37"><span class="linenos"> 37</span></a><span class="sd">    </span>
</span><span id="TopicModelTuner-38"><a href="#TopicModelTuner-38"><span class="linenos"> 38</span></a><span class="sd">    TMT does not explicitly provide functionality for testing alternative UMAP parameters or</span>
</span><span id="TopicModelTuner-39"><a href="#TopicModelTuner-39"><span class="linenos"> 39</span></a><span class="sd">    HDBSCAN parameters other than min_cluster_size or min_samples. However both the HDBSCAN</span>
</span><span id="TopicModelTuner-40"><a href="#TopicModelTuner-40"><span class="linenos"> 40</span></a><span class="sd">    and UMAP models are exposed within the class and can be set to any parameters desired. </span>
</span><span id="TopicModelTuner-41"><a href="#TopicModelTuner-41"><span class="linenos"> 41</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-42"><a href="#TopicModelTuner-42"><span class="linenos"> 42</span></a>    
</span><span id="TopicModelTuner-43"><a href="#TopicModelTuner-43"><span class="linenos"> 43</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner-44"><a href="#TopicModelTuner-44"><span class="linenos"> 44</span></a>                 <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: pre-generated embeddings</span>
</span><span id="TopicModelTuner-45"><a href="#TopicModelTuner-45"><span class="linenos"> 45</span></a>                 <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: set for alternative transformer embedding model</span>
</span><span id="TopicModelTuner-46"><a href="#TopicModelTuner-46"><span class="linenos"> 46</span></a>                 <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: can be set here or when embeddings are created manually</span>
</span><span id="TopicModelTuner-47"><a href="#TopicModelTuner-47"><span class="linenos"> 47</span></a>                 <span class="n">reducer_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: a UMAP instance</span>
</span><span id="TopicModelTuner-48"><a href="#TopicModelTuner-48"><span class="linenos"> 48</span></a>                 <span class="n">hdbscan_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: an HDBSCAN instance</span>
</span><span id="TopicModelTuner-49"><a href="#TopicModelTuner-49"><span class="linenos"> 49</span></a>                 <span class="n">reducer_components</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="c1">#: for UMAP</span>
</span><span id="TopicModelTuner-50"><a href="#TopicModelTuner-50"><span class="linenos"> 50</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span> <span class="c1">#: for UMAP</span>
</span><span id="TopicModelTuner-51"><a href="#TopicModelTuner-51"><span class="linenos"> 51</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-52"><a href="#TopicModelTuner-52"><span class="linenos"> 52</span></a><span class="sd">      Default initialization which assumes the BERTopic defaults for the embedding model </span>
</span><span id="TopicModelTuner-53"><a href="#TopicModelTuner-53"><span class="linenos"> 53</span></a><span class="sd">      (&#39;all-MiniLM-L6-v2&#39; sentence transformer) as well as HDBSCAN and UMAP parameters. </span>
</span><span id="TopicModelTuner-54"><a href="#TopicModelTuner-54"><span class="linenos"> 54</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner-55"><a href="#TopicModelTuner-55"><span class="linenos"> 55</span></a><span class="sd">      1) &#39;all-MiniLM-L6-v2&#39; sentence transformer as the default language model embedding.</span>
</span><span id="TopicModelTuner-56"><a href="#TopicModelTuner-56"><span class="linenos"> 56</span></a><span class="sd">      2) UMAP as the reduction method set to 5 features using the same parameters as BERTopic defaults to.</span>
</span><span id="TopicModelTuner-57"><a href="#TopicModelTuner-57"><span class="linenos"> 57</span></a><span class="sd">      3) HDBSCAN as the clustering mechansim</span>
</span><span id="TopicModelTuner-58"><a href="#TopicModelTuner-58"><span class="linenos"> 58</span></a>
</span><span id="TopicModelTuner-59"><a href="#TopicModelTuner-59"><span class="linenos"> 59</span></a><span class="sd">      Options include:</span>
</span><span id="TopicModelTuner-60"><a href="#TopicModelTuner-60"><span class="linenos"> 60</span></a>
</span><span id="TopicModelTuner-61"><a href="#TopicModelTuner-61"><span class="linenos"> 61</span></a><span class="sd">      - Using your own embeddings by setting TMT.embeddings after creating an instance</span>
</span><span id="TopicModelTuner-62"><a href="#TopicModelTuner-62"><span class="linenos"> 62</span></a><span class="sd">      - Using different UMAP settings or a different dimensional reduction method by setting TMT.reducer_model</span>
</span><span id="TopicModelTuner-63"><a href="#TopicModelTuner-63"><span class="linenos"> 63</span></a><span class="sd">      - Using different HDBSCAN parameters by setting TMT.hdbscan_model</span>
</span><span id="TopicModelTuner-64"><a href="#TopicModelTuner-64"><span class="linenos"> 64</span></a>
</span><span id="TopicModelTuner-65"><a href="#TopicModelTuner-65"><span class="linenos"> 65</span></a><span class="sd">      These can be set in the constructor or after instantiation by setting the instance variables.</span>
</span><span id="TopicModelTuner-66"><a href="#TopicModelTuner-66"><span class="linenos"> 66</span></a>
</span><span id="TopicModelTuner-67"><a href="#TopicModelTuner-67"><span class="linenos"> 67</span></a><span class="sd">      Unlike BERTopic, TMT has an option for saving both embeddings and the doc corpus - or optionally</span>
</span><span id="TopicModelTuner-68"><a href="#TopicModelTuner-68"><span class="linenos"> 68</span></a><span class="sd">      omitting them.</span>
</span><span id="TopicModelTuner-69"><a href="#TopicModelTuner-69"><span class="linenos"> 69</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-70"><a href="#TopicModelTuner-70"><span class="linenos"> 70</span></a>      
</span><span id="TopicModelTuner-71"><a href="#TopicModelTuner-71"><span class="linenos"> 71</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="c1">#: Passed through to UMAP</span>
</span><span id="TopicModelTuner-72"><a href="#TopicModelTuner-72"><span class="linenos"> 72</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span> <span class="c1">#: Can be set with pre-generated embedding</span>
</span><span id="TopicModelTuner-73"><a href="#TopicModelTuner-73"><span class="linenos"> 73</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="o">=</span><span class="n">reducer_components</span> 
</span><span id="TopicModelTuner-74"><a href="#TopicModelTuner-74"><span class="linenos"> 74</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-75"><a href="#TopicModelTuner-75"><span class="linenos"> 75</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">reducer_model</span>
</span><span id="TopicModelTuner-76"><a href="#TopicModelTuner-76"><span class="linenos"> 76</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="TopicModelTuner-77"><a href="#TopicModelTuner-77"><span class="linenos"> 77</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span>
</span><span id="TopicModelTuner-78"><a href="#TopicModelTuner-78"><span class="linenos"> 78</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-79"><a href="#TopicModelTuner-79"><span class="linenos"> 79</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner-80"><a href="#TopicModelTuner-80"><span class="linenos"> 80</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-81"><a href="#TopicModelTuner-81"><span class="linenos"> 81</span></a>
</span><span id="TopicModelTuner-82"><a href="#TopicModelTuner-82"><span class="linenos"> 82</span></a>      <span class="k">if</span> <span class="n">embedding_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-83"><a href="#TopicModelTuner-83"><span class="linenos"> 83</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s1">&#39;all-MiniLM-L6-v2&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-84"><a href="#TopicModelTuner-84"><span class="linenos"> 84</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner-85"><a href="#TopicModelTuner-85"><span class="linenos"> 85</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">embedding_model</span>
</span><span id="TopicModelTuner-86"><a href="#TopicModelTuner-86"><span class="linenos"> 86</span></a>          
</span><span id="TopicModelTuner-87"><a href="#TopicModelTuner-87"><span class="linenos"> 87</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner-88"><a href="#TopicModelTuner-88"><span class="linenos"> 88</span></a>      <span class="k">if</span> <span class="n">reducer_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> 
</span><span id="TopicModelTuner-89"><a href="#TopicModelTuner-89"><span class="linenos"> 89</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="p">,</span> 
</span><span id="TopicModelTuner-90"><a href="#TopicModelTuner-90"><span class="linenos"> 90</span></a>                             <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> 
</span><span id="TopicModelTuner-91"><a href="#TopicModelTuner-91"><span class="linenos"> 91</span></a>                             <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
</span><span id="TopicModelTuner-92"><a href="#TopicModelTuner-92"><span class="linenos"> 92</span></a>                             <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
</span><span id="TopicModelTuner-93"><a href="#TopicModelTuner-93"><span class="linenos"> 93</span></a>                             <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="TopicModelTuner-94"><a href="#TopicModelTuner-94"><span class="linenos"> 94</span></a>          <span class="c1"># this is a kludge.  See below for test to see if UMAP model has been fitted.</span>
</span><span id="TopicModelTuner-95"><a href="#TopicModelTuner-95"><span class="linenos"> 95</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="TopicModelTuner-96"><a href="#TopicModelTuner-96"><span class="linenos"> 96</span></a>
</span><span id="TopicModelTuner-97"><a href="#TopicModelTuner-97"><span class="linenos"> 97</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TopicModelTuner-98"><a href="#TopicModelTuner-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">wrapBERTopicModel</span><span class="p">(</span><span class="n">BERTopicModel</span> <span class="p">:</span> <span class="n">BERTopic</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-99"><a href="#TopicModelTuner-99"><span class="linenos"> 99</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-100"><a href="#TopicModelTuner-100"><span class="linenos">100</span></a><span class="sd">      This is a helper function which returns a TMT instance using the values from a BERTopic instance.</span>
</span><span id="TopicModelTuner-101"><a href="#TopicModelTuner-101"><span class="linenos">101</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-102"><a href="#TopicModelTuner-102"><span class="linenos">102</span></a>  
</span><span id="TopicModelTuner-103"><a href="#TopicModelTuner-103"><span class="linenos">103</span></a>      <span class="k">return</span> <span class="n">TopicModelTuner</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
</span><span id="TopicModelTuner-104"><a href="#TopicModelTuner-104"><span class="linenos">104</span></a>                               <span class="n">reducer_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">umap_model</span><span class="p">,</span>
</span><span id="TopicModelTuner-105"><a href="#TopicModelTuner-105"><span class="linenos">105</span></a>                               <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="TopicModelTuner-106"><a href="#TopicModelTuner-106"><span class="linenos">106</span></a>                               <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="TopicModelTuner-107"><a href="#TopicModelTuner-107"><span class="linenos">107</span></a>
</span><span id="TopicModelTuner-108"><a href="#TopicModelTuner-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="nf">getBERTopicModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">):</span>
</span><span id="TopicModelTuner-109"><a href="#TopicModelTuner-109"><span class="linenos">109</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-110"><a href="#TopicModelTuner-110"><span class="linenos">110</span></a><span class="sd">      Returns a BERTopic model with the specified HDBSCAN parameters, regardles</span>
</span><span id="TopicModelTuner-111"><a href="#TopicModelTuner-111"><span class="linenos">111</span></a><span class="sd">      of whether or not the TMT instance was created using the default __init__() or </span>
</span><span id="TopicModelTuner-112"><a href="#TopicModelTuner-112"><span class="linenos">112</span></a><span class="sd">      the helper wrapBERTopicModel() funciton.</span>
</span><span id="TopicModelTuner-113"><a href="#TopicModelTuner-113"><span class="linenos">113</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner-114"><a href="#TopicModelTuner-114"><span class="linenos">114</span></a><span class="sd">      The user is left to specify their chosen best settings after running a series of </span>
</span><span id="TopicModelTuner-115"><a href="#TopicModelTuner-115"><span class="linenos">115</span></a><span class="sd">      candidate parameters.</span>
</span><span id="TopicModelTuner-116"><a href="#TopicModelTuner-116"><span class="linenos">116</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner-117"><a href="#TopicModelTuner-117"><span class="linenos">117</span></a><span class="sd">      The reason for this function is to return a BERTopic instance with create a </span>
</span><span id="TopicModelTuner-118"><a href="#TopicModelTuner-118"><span class="linenos">118</span></a><span class="sd">      UMAP_facade object as an argument to the BERTopic initialization, since any </span>
</span><span id="TopicModelTuner-119"><a href="#TopicModelTuner-119"><span class="linenos">119</span></a><span class="sd">      given HDBSCAN parameter set will be specific to a particular run of UMAP. </span>
</span><span id="TopicModelTuner-120"><a href="#TopicModelTuner-120"><span class="linenos">120</span></a><span class="sd">      Just using a tuned HDBSCAN</span>
</span><span id="TopicModelTuner-121"><a href="#TopicModelTuner-121"><span class="linenos">121</span></a><span class="sd">      instance (or simply using the parameters derived from a tuning session) will </span>
</span><span id="TopicModelTuner-122"><a href="#TopicModelTuner-122"><span class="linenos">122</span></a><span class="sd">      not provide the best results in a new BERTopic instance. This is because BERTopic</span>
</span><span id="TopicModelTuner-123"><a href="#TopicModelTuner-123"><span class="linenos">123</span></a><span class="sd">      will re-run UMAP each time fit() is called. Different runs of UMAP will have slightly </span>
</span><span id="TopicModelTuner-124"><a href="#TopicModelTuner-124"><span class="linenos">124</span></a><span class="sd">      different characteristics and will therefore perform differently with different </span>
</span><span id="TopicModelTuner-125"><a href="#TopicModelTuner-125"><span class="linenos">125</span></a><span class="sd">      HDBSCAN settings. HDBSCAN on the other hand will always return the same values assuming</span>
</span><span id="TopicModelTuner-126"><a href="#TopicModelTuner-126"><span class="linenos">126</span></a><span class="sd">      that all the paremeters, and the data being clustered, are the same.</span>
</span><span id="TopicModelTuner-127"><a href="#TopicModelTuner-127"><span class="linenos">127</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-128"><a href="#TopicModelTuner-128"><span class="linenos">128</span></a>      <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-129"><a href="#TopicModelTuner-129"><span class="linenos">129</span></a>                                      <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-130"><a href="#TopicModelTuner-130"><span class="linenos">130</span></a>                                      <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner-131"><a href="#TopicModelTuner-131"><span class="linenos">131</span></a>                                      <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">,</span>
</span><span id="TopicModelTuner-132"><a href="#TopicModelTuner-132"><span class="linenos">132</span></a>                                      <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span>
</span><span id="TopicModelTuner-133"><a href="#TopicModelTuner-133"><span class="linenos">133</span></a>                                      <span class="p">)</span>
</span><span id="TopicModelTuner-134"><a href="#TopicModelTuner-134"><span class="linenos">134</span></a>
</span><span id="TopicModelTuner-135"><a href="#TopicModelTuner-135"><span class="linenos">135</span></a>      <span class="k">return</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">umap_model</span><span class="o">=</span><span class="n">UMAP_facade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span><span class="p">),</span>
</span><span id="TopicModelTuner-136"><a href="#TopicModelTuner-136"><span class="linenos">136</span></a>                      <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="TopicModelTuner-137"><a href="#TopicModelTuner-137"><span class="linenos">137</span></a>
</span><span id="TopicModelTuner-138"><a href="#TopicModelTuner-138"><span class="linenos">138</span></a>    
</span><span id="TopicModelTuner-139"><a href="#TopicModelTuner-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">createEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-140"><a href="#TopicModelTuner-140"><span class="linenos">140</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-141"><a href="#TopicModelTuner-141"><span class="linenos">141</span></a><span class="sd">      Create embeddings using the embedding model specified during initiliazation.</span>
</span><span id="TopicModelTuner-142"><a href="#TopicModelTuner-142"><span class="linenos">142</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-143"><a href="#TopicModelTuner-143"><span class="linenos">143</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-144"><a href="#TopicModelTuner-144"><span class="linenos">144</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Embeddings already created, reset by setting embeddings=None&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-145"><a href="#TopicModelTuner-145"><span class="linenos">145</span></a>        
</span><span id="TopicModelTuner-146"><a href="#TopicModelTuner-146"><span class="linenos">146</span></a>      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-147"><a href="#TopicModelTuner-147"><span class="linenos">147</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Docs not specified, set docs=&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-148"><a href="#TopicModelTuner-148"><span class="linenos">148</span></a>        
</span><span id="TopicModelTuner-149"><a href="#TopicModelTuner-149"><span class="linenos">149</span></a>      <span class="k">if</span> <span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-150"><a href="#TopicModelTuner-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">=</span><span class="n">docs</span>
</span><span id="TopicModelTuner-151"><a href="#TopicModelTuner-151"><span class="linenos">151</span></a>             
</span><span id="TopicModelTuner-152"><a href="#TopicModelTuner-152"><span class="linenos">152</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
</span><span id="TopicModelTuner-153"><a href="#TopicModelTuner-153"><span class="linenos">153</span></a>    
</span><span id="TopicModelTuner-154"><a href="#TopicModelTuner-154"><span class="linenos">154</span></a>        
</span><span id="TopicModelTuner-155"><a href="#TopicModelTuner-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-156"><a href="#TopicModelTuner-156"><span class="linenos">156</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-157"><a href="#TopicModelTuner-157"><span class="linenos">157</span></a><span class="sd">      Reduce dimensionality of the embeddings</span>
</span><span id="TopicModelTuner-158"><a href="#TopicModelTuner-158"><span class="linenos">158</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-159"><a href="#TopicModelTuner-159"><span class="linenos">159</span></a>      <span class="k">try</span> <span class="p">:</span>
</span><span id="TopicModelTuner-160"><a href="#TopicModelTuner-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-161"><a href="#TopicModelTuner-161"><span class="linenos">161</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings set, call TMT.createEmbeddings() or set TMT.embeddings directly&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-162"><a href="#TopicModelTuner-162"><span class="linenos">162</span></a>      <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
</span><span id="TopicModelTuner-163"><a href="#TopicModelTuner-163"><span class="linenos">163</span></a>          <span class="k">pass</span> <span class="c1"># embeddings already set</span>
</span><span id="TopicModelTuner-164"><a href="#TopicModelTuner-164"><span class="linenos">164</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="TopicModelTuner-165"><a href="#TopicModelTuner-165"><span class="linenos">165</span></a>    
</span><span id="TopicModelTuner-166"><a href="#TopicModelTuner-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-167"><a href="#TopicModelTuner-167"><span class="linenos">167</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-168"><a href="#TopicModelTuner-168"><span class="linenos">168</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="TopicModelTuner-169"><a href="#TopicModelTuner-169"><span class="linenos">169</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-170"><a href="#TopicModelTuner-170"><span class="linenos">170</span></a>      <span class="k">try</span> <span class="p">:</span>
</span><span id="TopicModelTuner-171"><a href="#TopicModelTuner-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-172"><a href="#TopicModelTuner-172"><span class="linenos">172</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-173"><a href="#TopicModelTuner-173"><span class="linenos">173</span></a>      <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
</span><span id="TopicModelTuner-174"><a href="#TopicModelTuner-174"><span class="linenos">174</span></a>          <span class="k">pass</span> <span class="c1"># embeddings already set</span>
</span><span id="TopicModelTuner-175"><a href="#TopicModelTuner-175"><span class="linenos">175</span></a>
</span><span id="TopicModelTuner-176"><a href="#TopicModelTuner-176"><span class="linenos">176</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="TopicModelTuner-177"><a href="#TopicModelTuner-177"><span class="linenos">177</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="TopicModelTuner-178"><a href="#TopicModelTuner-178"><span class="linenos">178</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span><span id="TopicModelTuner-179"><a href="#TopicModelTuner-179"><span class="linenos">179</span></a>
</span><span id="TopicModelTuner-180"><a href="#TopicModelTuner-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-181"><a href="#TopicModelTuner-181"><span class="linenos">181</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-182"><a href="#TopicModelTuner-182"><span class="linenos">182</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="TopicModelTuner-183"><a href="#TopicModelTuner-183"><span class="linenos">183</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-184"><a href="#TopicModelTuner-184"><span class="linenos">184</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-185"><a href="#TopicModelTuner-185"><span class="linenos">185</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-186"><a href="#TopicModelTuner-186"><span class="linenos">186</span></a>
</span><span id="TopicModelTuner-187"><a href="#TopicModelTuner-187"><span class="linenos">187</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TopicModelTuner-188"><a href="#TopicModelTuner-188"><span class="linenos">188</span></a>
</span><span id="TopicModelTuner-189"><a href="#TopicModelTuner-189"><span class="linenos">189</span></a>      
</span><span id="TopicModelTuner-190"><a href="#TopicModelTuner-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-191"><a href="#TopicModelTuner-191"><span class="linenos">191</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-192"><a href="#TopicModelTuner-192"><span class="linenos">192</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided parameters.</span>
</span><span id="TopicModelTuner-193"><a href="#TopicModelTuner-193"><span class="linenos">193</span></a><span class="sd">      If docs has been set then the first 400 chars of each document will be </span>
</span><span id="TopicModelTuner-194"><a href="#TopicModelTuner-194"><span class="linenos">194</span></a><span class="sd">      shown as a hover over each data point.</span>
</span><span id="TopicModelTuner-195"><a href="#TopicModelTuner-195"><span class="linenos">195</span></a><span class="sd">  </span>
</span><span id="TopicModelTuner-196"><a href="#TopicModelTuner-196"><span class="linenos">196</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="TopicModelTuner-197"><a href="#TopicModelTuner-197"><span class="linenos">197</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-198"><a href="#TopicModelTuner-198"><span class="linenos">198</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>
</span><span id="TopicModelTuner-199"><a href="#TopicModelTuner-199"><span class="linenos">199</span></a>
</span><span id="TopicModelTuner-200"><a href="#TopicModelTuner-200"><span class="linenos">200</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="TopicModelTuner-201"><a href="#TopicModelTuner-201"><span class="linenos">201</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="TopicModelTuner-202"><a href="#TopicModelTuner-202"><span class="linenos">202</span></a>
</span><span id="TopicModelTuner-203"><a href="#TopicModelTuner-203"><span class="linenos">203</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-204"><a href="#TopicModelTuner-204"><span class="linenos">204</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="TopicModelTuner-205"><a href="#TopicModelTuner-205"><span class="linenos">205</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="TopicModelTuner-206"><a href="#TopicModelTuner-206"><span class="linenos">206</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="TopicModelTuner-207"><a href="#TopicModelTuner-207"><span class="linenos">207</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner-208"><a href="#TopicModelTuner-208"><span class="linenos">208</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-209"><a href="#TopicModelTuner-209"><span class="linenos">209</span></a>          
</span><span id="TopicModelTuner-210"><a href="#TopicModelTuner-210"><span class="linenos">210</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="TopicModelTuner-211"><a href="#TopicModelTuner-211"><span class="linenos">211</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-212"><a href="#TopicModelTuner-212"><span class="linenos">212</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-213"><a href="#TopicModelTuner-213"><span class="linenos">213</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="TopicModelTuner-214"><a href="#TopicModelTuner-214"><span class="linenos">214</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="TopicModelTuner-215"><a href="#TopicModelTuner-215"><span class="linenos">215</span></a>
</span><span id="TopicModelTuner-216"><a href="#TopicModelTuner-216"><span class="linenos">216</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span><span id="TopicModelTuner-217"><a href="#TopicModelTuner-217"><span class="linenos">217</span></a>
</span><span id="TopicModelTuner-218"><a href="#TopicModelTuner-218"><span class="linenos">218</span></a>
</span><span id="TopicModelTuner-219"><a href="#TopicModelTuner-219"><span class="linenos">219</span></a>
</span><span id="TopicModelTuner-220"><a href="#TopicModelTuner-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="nf">runHDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-221"><a href="#TopicModelTuner-221"><span class="linenos">221</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-222"><a href="#TopicModelTuner-222"><span class="linenos">222</span></a><span class="sd">      Cluster reduced embeddings. sample_size must be more than 0 and less than</span>
</span><span id="TopicModelTuner-223"><a href="#TopicModelTuner-223"><span class="linenos">223</span></a><span class="sd">      or equal to min_cluster_size.</span>
</span><span id="TopicModelTuner-224"><a href="#TopicModelTuner-224"><span class="linenos">224</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-225"><a href="#TopicModelTuner-225"><span class="linenos">225</span></a>
</span><span id="TopicModelTuner-226"><a href="#TopicModelTuner-226"><span class="linenos">226</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner-227"><a href="#TopicModelTuner-227"><span class="linenos">227</span></a>          <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-228"><a href="#TopicModelTuner-228"><span class="linenos">228</span></a>                                      <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner-229"><a href="#TopicModelTuner-229"><span class="linenos">229</span></a>                                      <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner-230"><a href="#TopicModelTuner-230"><span class="linenos">230</span></a>                                      <span class="n">min_samples</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="TopicModelTuner-231"><a href="#TopicModelTuner-231"><span class="linenos">231</span></a>                                      <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">,</span>
</span><span id="TopicModelTuner-232"><a href="#TopicModelTuner-232"><span class="linenos">232</span></a>                                      <span class="p">)</span>
</span><span id="TopicModelTuner-233"><a href="#TopicModelTuner-233"><span class="linenos">233</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner-234"><a href="#TopicModelTuner-234"><span class="linenos">234</span></a>          <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="TopicModelTuner-235"><a href="#TopicModelTuner-235"><span class="linenos">235</span></a>          <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_samples</span> <span class="o">=</span> <span class="n">sample_size</span>
</span><span id="TopicModelTuner-236"><a href="#TopicModelTuner-236"><span class="linenos">236</span></a>          <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_cluster_size</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="TopicModelTuner-237"><a href="#TopicModelTuner-237"><span class="linenos">237</span></a>  
</span><span id="TopicModelTuner-238"><a href="#TopicModelTuner-238"><span class="linenos">238</span></a>      <span class="k">return</span> <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span><span class="p">)</span>  
</span><span id="TopicModelTuner-239"><a href="#TopicModelTuner-239"><span class="linenos">239</span></a>
</span><span id="TopicModelTuner-240"><a href="#TopicModelTuner-240"><span class="linenos">240</span></a>
</span><span id="TopicModelTuner-241"><a href="#TopicModelTuner-241"><span class="linenos">241</span></a>        
</span><span id="TopicModelTuner-242"><a href="#TopicModelTuner-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">_runTests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchParams</span><span class="p">):</span>
</span><span id="TopicModelTuner-243"><a href="#TopicModelTuner-243"><span class="linenos">243</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-244"><a href="#TopicModelTuner-244"><span class="linenos">244</span></a><span class="sd">      Internal call to run a passel of HDBSCAN within a given range of parameters.</span>
</span><span id="TopicModelTuner-245"><a href="#TopicModelTuner-245"><span class="linenos">245</span></a><span class="sd">      cluster_size_range is a list of ints and sample_size_pct_range is a list of percentages e.g.</span>
</span><span id="TopicModelTuner-246"><a href="#TopicModelTuner-246"><span class="linenos">246</span></a><span class="sd">      [.1, .25, .50, .75, 1]. One of the percent values will be randomly chosen and </span>
</span><span id="TopicModelTuner-247"><a href="#TopicModelTuner-247"><span class="linenos">247</span></a><span class="sd">      multiplied by the randomly chosen cluster_size_range to produce a min_samples</span>
</span><span id="TopicModelTuner-248"><a href="#TopicModelTuner-248"><span class="linenos">248</span></a><span class="sd">      value for HDBSCAN. The calulated min_samples value must be larger than 0 and not </span>
</span><span id="TopicModelTuner-249"><a href="#TopicModelTuner-249"><span class="linenos">249</span></a><span class="sd">      greater than the selected cluster_size_range value.</span>
</span><span id="TopicModelTuner-250"><a href="#TopicModelTuner-250"><span class="linenos">250</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-251"><a href="#TopicModelTuner-251"><span class="linenos">251</span></a>      <span class="c1"># results = []</span>
</span><span id="TopicModelTuner-252"><a href="#TopicModelTuner-252"><span class="linenos">252</span></a>      <span class="c1"># for params in tqdm(searchParams) :</span>
</span><span id="TopicModelTuner-253"><a href="#TopicModelTuner-253"><span class="linenos">253</span></a>      <span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">ss</span><span class="p">))</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)]</span> 
</span><span id="TopicModelTuner-254"><a href="#TopicModelTuner-254"><span class="linenos">254</span></a>          <span class="c1"># results.append((params.cs, params.ss, self.runHDBSCAN(params.cs, params.ss)))</span>
</span><span id="TopicModelTuner-255"><a href="#TopicModelTuner-255"><span class="linenos">255</span></a>      <span class="n">RunResultsDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="TopicModelTuner-256"><a href="#TopicModelTuner-256"><span class="linenos">256</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;min_cluster_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tupe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="TopicModelTuner-257"><a href="#TopicModelTuner-257"><span class="linenos">257</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;sample_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tupe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="TopicModelTuner-258"><a href="#TopicModelTuner-258"><span class="linenos">258</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tupe</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</span><span id="TopicModelTuner-259"><a href="#TopicModelTuner-259"><span class="linenos">259</span></a>      <span class="n">uncategorized</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TopicModelTuner-260"><a href="#TopicModelTuner-260"><span class="linenos">260</span></a>      <span class="k">for</span> <span class="n">aDict</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tupe</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">tupe</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span> <span class="p">:</span>
</span><span id="TopicModelTuner-261"><a href="#TopicModelTuner-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">aDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
</span><span id="TopicModelTuner-262"><a href="#TopicModelTuner-262"><span class="linenos">262</span></a>            <span class="n">uncategorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aDict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TopicModelTuner-263"><a href="#TopicModelTuner-263"><span class="linenos">263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TopicModelTuner-264"><a href="#TopicModelTuner-264"><span class="linenos">264</span></a>            <span class="n">uncategorized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TopicModelTuner-265"><a href="#TopicModelTuner-265"><span class="linenos">265</span></a>      <span class="n">RunResultsDF</span><span class="p">[</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncategorized</span>
</span><span id="TopicModelTuner-266"><a href="#TopicModelTuner-266"><span class="linenos">266</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span><span class="p">,</span> <span class="n">RunResultsDF</span><span class="p">])</span>
</span><span id="TopicModelTuner-267"><a href="#TopicModelTuner-267"><span class="linenos">267</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TopicModelTuner-268"><a href="#TopicModelTuner-268"><span class="linenos">268</span></a>  
</span><span id="TopicModelTuner-269"><a href="#TopicModelTuner-269"><span class="linenos">269</span></a>      <span class="k">return</span> <span class="n">RunResultsDF</span>
</span><span id="TopicModelTuner-270"><a href="#TopicModelTuner-270"><span class="linenos">270</span></a>
</span><span id="TopicModelTuner-271"><a href="#TopicModelTuner-271"><span class="linenos">271</span></a>    <span class="k">def</span> <span class="nf">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size</span><span class="p">,</span> <span class="n">sample_size_pct</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-272"><a href="#TopicModelTuner-272"><span class="linenos">272</span></a>        <span class="n">sample_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cluster_size</span> <span class="o">*</span> <span class="n">sample_size_pct</span><span class="p">)</span>
</span><span id="TopicModelTuner-273"><a href="#TopicModelTuner-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="n">sample_size</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="TopicModelTuner-274"><a href="#TopicModelTuner-274"><span class="linenos">274</span></a>          <span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="TopicModelTuner-275"><a href="#TopicModelTuner-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>
</span><span id="TopicModelTuner-276"><a href="#TopicModelTuner-276"><span class="linenos">276</span></a>      
</span><span id="TopicModelTuner-277"><a href="#TopicModelTuner-277"><span class="linenos">277</span></a>  
</span><span id="TopicModelTuner-278"><a href="#TopicModelTuner-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">_genRandomSearchParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-279"><a href="#TopicModelTuner-279"><span class="linenos">279</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TopicModelTuner-280"><a href="#TopicModelTuner-280"><span class="linenos">280</span></a>      <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-281"><a href="#TopicModelTuner-281"><span class="linenos">281</span></a>        <span class="n">searchParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="TopicModelTuner-282"><a href="#TopicModelTuner-282"><span class="linenos">282</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">))],</span>
</span><span id="TopicModelTuner-283"><a href="#TopicModelTuner-283"><span class="linenos">283</span></a>                                        <span class="n">sample_size_pct_range</span><span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_size_pct_range</span><span class="p">))]</span>
</span><span id="TopicModelTuner-284"><a href="#TopicModelTuner-284"><span class="linenos">284</span></a>                                       <span class="p">)</span>
</span><span id="TopicModelTuner-285"><a href="#TopicModelTuner-285"><span class="linenos">285</span></a>        <span class="p">)</span>
</span><span id="TopicModelTuner-286"><a href="#TopicModelTuner-286"><span class="linenos">286</span></a>      <span class="k">return</span> <span class="n">searchParams</span>
</span><span id="TopicModelTuner-287"><a href="#TopicModelTuner-287"><span class="linenos">287</span></a>
</span><span id="TopicModelTuner-288"><a href="#TopicModelTuner-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">_genGridSearchParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-289"><a href="#TopicModelTuner-289"><span class="linenos">289</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TopicModelTuner-290"><a href="#TopicModelTuner-290"><span class="linenos">290</span></a>      <span class="k">for</span> <span class="n">cluster_size</span> <span class="ow">in</span> <span class="n">cluster_sizes</span> <span class="p">:</span>
</span><span id="TopicModelTuner-291"><a href="#TopicModelTuner-291"><span class="linenos">291</span></a>        <span class="k">for</span> <span class="n">sample_size_pct</span> <span class="ow">in</span> <span class="n">sample_size_pct_range</span> <span class="p">:</span>
</span><span id="TopicModelTuner-292"><a href="#TopicModelTuner-292"><span class="linenos">292</span></a>          <span class="n">searchParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_returnParamsFromCSandPercent</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">,</span> <span class="n">sample_size_pct</span><span class="p">))</span>
</span><span id="TopicModelTuner-293"><a href="#TopicModelTuner-293"><span class="linenos">293</span></a>      <span class="k">return</span> <span class="n">searchParams</span>
</span><span id="TopicModelTuner-294"><a href="#TopicModelTuner-294"><span class="linenos">294</span></a>  
</span><span id="TopicModelTuner-295"><a href="#TopicModelTuner-295"><span class="linenos">295</span></a>    <span class="k">def</span> <span class="nf">randomSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-296"><a href="#TopicModelTuner-296"><span class="linenos">296</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genRandomSearchParams</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span>
</span><span id="TopicModelTuner-297"><a href="#TopicModelTuner-297"><span class="linenos">297</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span><span id="TopicModelTuner-298"><a href="#TopicModelTuner-298"><span class="linenos">298</span></a>
</span><span id="TopicModelTuner-299"><a href="#TopicModelTuner-299"><span class="linenos">299</span></a>    <span class="k">def</span> <span class="nf">gridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-300"><a href="#TopicModelTuner-300"><span class="linenos">300</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genGridSearchParams</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span>
</span><span id="TopicModelTuner-301"><a href="#TopicModelTuner-301"><span class="linenos">301</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span><span id="TopicModelTuner-302"><a href="#TopicModelTuner-302"><span class="linenos">302</span></a>
</span><span id="TopicModelTuner-303"><a href="#TopicModelTuner-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">simpleSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-304"><a href="#TopicModelTuner-304"><span class="linenos">304</span></a>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-305"><a href="#TopicModelTuner-305"><span class="linenos">305</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length of cluster sizes and samples sizes lists must match&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner-306"><a href="#TopicModelTuner-306"><span class="linenos">306</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)])</span>
</span><span id="TopicModelTuner-307"><a href="#TopicModelTuner-307"><span class="linenos">307</span></a>  
</span><span id="TopicModelTuner-308"><a href="#TopicModelTuner-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">visualizeSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultsDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-309"><a href="#TopicModelTuner-309"><span class="linenos">309</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-310"><a href="#TopicModelTuner-310"><span class="linenos">310</span></a><span class="sd">      Runs iters number of randomly generated cluster size and sample range pairs</span>
</span><span id="TopicModelTuner-311"><a href="#TopicModelTuner-311"><span class="linenos">311</span></a><span class="sd">      against the embeddings. Note that sample sizes have to be a percentage value of </span>
</span><span id="TopicModelTuner-312"><a href="#TopicModelTuner-312"><span class="linenos">312</span></a><span class="sd">      a given cluster_size and cannot be 0. </span>
</span><span id="TopicModelTuner-313"><a href="#TopicModelTuner-313"><span class="linenos">313</span></a>
</span><span id="TopicModelTuner-314"><a href="#TopicModelTuner-314"><span class="linenos">314</span></a><span class="sd">      Returns both a plotly fig with a parrallel_coordinates chart of the run as well</span>
</span><span id="TopicModelTuner-315"><a href="#TopicModelTuner-315"><span class="linenos">315</span></a><span class="sd">      as a summarized version of the data produced by the run. Each run will produce</span>
</span><span id="TopicModelTuner-316"><a href="#TopicModelTuner-316"><span class="linenos">316</span></a><span class="sd">      its own summary table, but a history of all runs is also stored in the objects ResultsDF</span>
</span><span id="TopicModelTuner-317"><a href="#TopicModelTuner-317"><span class="linenos">317</span></a><span class="sd">      attribute.</span>
</span><span id="TopicModelTuner-318"><a href="#TopicModelTuner-318"><span class="linenos">318</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-319"><a href="#TopicModelTuner-319"><span class="linenos">319</span></a>    
</span><span id="TopicModelTuner-320"><a href="#TopicModelTuner-320"><span class="linenos">320</span></a>      <span class="c1"># if self.reducer_model.embedding_.sum() == 0  :</span>
</span><span id="TopicModelTuner-321"><a href="#TopicModelTuner-321"><span class="linenos">321</span></a>      <span class="c1">#     raise AttributeError(&#39;Reducer not run yet, call createReduction() first&#39;)</span>
</span><span id="TopicModelTuner-322"><a href="#TopicModelTuner-322"><span class="linenos">322</span></a>
</span><span id="TopicModelTuner-323"><a href="#TopicModelTuner-323"><span class="linenos">323</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">parallel_coordinates</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">,</span>
</span><span id="TopicModelTuner-324"><a href="#TopicModelTuner-324"><span class="linenos">324</span></a>                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> 
</span><span id="TopicModelTuner-325"><a href="#TopicModelTuner-325"><span class="linenos">325</span></a>                                    <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">,</span>
</span><span id="TopicModelTuner-326"><a href="#TopicModelTuner-326"><span class="linenos">326</span></a>                                            <span class="s2">&quot;sample_size&quot;</span><span class="p">:</span> <span class="s2">&quot;ample_size&quot;</span><span class="p">,</span> 
</span><span id="TopicModelTuner-327"><a href="#TopicModelTuner-327"><span class="linenos">327</span></a>                                            <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">:</span> <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">,</span>
</span><span id="TopicModelTuner-328"><a href="#TopicModelTuner-328"><span class="linenos">328</span></a>                                            <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">:</span> <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> <span class="p">},)</span>
</span><span id="TopicModelTuner-329"><a href="#TopicModelTuner-329"><span class="linenos">329</span></a>      <span class="k">return</span> <span class="n">fig</span>
</span><span id="TopicModelTuner-330"><a href="#TopicModelTuner-330"><span class="linenos">330</span></a>  
</span><span id="TopicModelTuner-331"><a href="#TopicModelTuner-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="nf">summarizeResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summaryDF</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-332"><a href="#TopicModelTuner-332"><span class="linenos">332</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-333"><a href="#TopicModelTuner-333"><span class="linenos">333</span></a><span class="sd">      Pass this a DataFrame with run results - either the summary DF from a given</span>
</span><span id="TopicModelTuner-334"><a href="#TopicModelTuner-334"><span class="linenos">334</span></a><span class="sd">      run or the historical table run and it will return a table where each record </span>
</span><span id="TopicModelTuner-335"><a href="#TopicModelTuner-335"><span class="linenos">335</span></a><span class="sd">      represents contains the smallest number of uncategorized documents for a given</span>
</span><span id="TopicModelTuner-336"><a href="#TopicModelTuner-336"><span class="linenos">336</span></a><span class="sd">      number of clusters.</span>
</span><span id="TopicModelTuner-337"><a href="#TopicModelTuner-337"><span class="linenos">337</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-338"><a href="#TopicModelTuner-338"><span class="linenos">338</span></a>      <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="TopicModelTuner-339"><a href="#TopicModelTuner-339"><span class="linenos">339</span></a>      <span class="k">for</span> <span class="n">num_clusters</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="p">:</span>
</span><span id="TopicModelTuner-340"><a href="#TopicModelTuner-340"><span class="linenos">340</span></a>            <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">resultSummaryDF</span><span class="p">,</span> <span class="n">summaryDF</span><span class="p">[</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">num_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]])</span>
</span><span id="TopicModelTuner-341"><a href="#TopicModelTuner-341"><span class="linenos">341</span></a>      <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TopicModelTuner-342"><a href="#TopicModelTuner-342"><span class="linenos">342</span></a>      <span class="k">return</span> <span class="n">resultSummaryDF</span>
</span><span id="TopicModelTuner-343"><a href="#TopicModelTuner-343"><span class="linenos">343</span></a>
</span><span id="TopicModelTuner-344"><a href="#TopicModelTuner-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner-345"><a href="#TopicModelTuner-345"><span class="linenos">345</span></a>             <span class="n">fname</span><span class="p">,</span>
</span><span id="TopicModelTuner-346"><a href="#TopicModelTuner-346"><span class="linenos">346</span></a>             <span class="n">save_docs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner-347"><a href="#TopicModelTuner-347"><span class="linenos">347</span></a>             <span class="n">save_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner-348"><a href="#TopicModelTuner-348"><span class="linenos">348</span></a>             <span class="n">save_viz_reduction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-349"><a href="#TopicModelTuner-349"><span class="linenos">349</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-350"><a href="#TopicModelTuner-350"><span class="linenos">350</span></a><span class="sd">      Saves the TMT object. User can choose whether or not to save docs, embeddings and/or</span>
</span><span id="TopicModelTuner-351"><a href="#TopicModelTuner-351"><span class="linenos">351</span></a><span class="sd">      the viz reduction</span>
</span><span id="TopicModelTuner-352"><a href="#TopicModelTuner-352"><span class="linenos">352</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-353"><a href="#TopicModelTuner-353"><span class="linenos">353</span></a>      
</span><span id="TopicModelTuner-354"><a href="#TopicModelTuner-354"><span class="linenos">354</span></a>      <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
</span><span id="TopicModelTuner-355"><a href="#TopicModelTuner-355"><span class="linenos">355</span></a>      <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span>
</span><span id="TopicModelTuner-356"><a href="#TopicModelTuner-356"><span class="linenos">356</span></a>      <span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span>
</span><span id="TopicModelTuner-357"><a href="#TopicModelTuner-357"><span class="linenos">357</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>
</span><span id="TopicModelTuner-358"><a href="#TopicModelTuner-358"><span class="linenos">358</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_docs</span> <span class="p">:</span>
</span><span id="TopicModelTuner-359"><a href="#TopicModelTuner-359"><span class="linenos">359</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-360"><a href="#TopicModelTuner-360"><span class="linenos">360</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embeddings</span> <span class="p">:</span>
</span><span id="TopicModelTuner-361"><a href="#TopicModelTuner-361"><span class="linenos">361</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-362"><a href="#TopicModelTuner-362"><span class="linenos">362</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_viz_reduction</span> <span class="p">:</span>
</span><span id="TopicModelTuner-363"><a href="#TopicModelTuner-363"><span class="linenos">363</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner-364"><a href="#TopicModelTuner-364"><span class="linenos">364</span></a>          <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="TopicModelTuner-365"><a href="#TopicModelTuner-365"><span class="linenos">365</span></a>          
</span><span id="TopicModelTuner-366"><a href="#TopicModelTuner-366"><span class="linenos">366</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner-367"><a href="#TopicModelTuner-367"><span class="linenos">367</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span>
</span><span id="TopicModelTuner-368"><a href="#TopicModelTuner-368"><span class="linenos">368</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span>
</span><span id="TopicModelTuner-369"><a href="#TopicModelTuner-369"><span class="linenos">369</span></a>     
</span><span id="TopicModelTuner-370"><a href="#TopicModelTuner-370"><span class="linenos">370</span></a>    <span class="nd">@staticmethod</span>    
</span><span id="TopicModelTuner-371"><a href="#TopicModelTuner-371"><span class="linenos">371</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner-372"><a href="#TopicModelTuner-372"><span class="linenos">372</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-373"><a href="#TopicModelTuner-373"><span class="linenos">373</span></a><span class="sd">      Restore a saved TMT object from disk</span>
</span><span id="TopicModelTuner-374"><a href="#TopicModelTuner-374"><span class="linenos">374</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner-375"><a href="#TopicModelTuner-375"><span class="linenos">375</span></a>      
</span><span id="TopicModelTuner-376"><a href="#TopicModelTuner-376"><span class="linenos">376</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>    
</span><span id="TopicModelTuner-377"><a href="#TopicModelTuner-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>TopicModelTuner (TMT) provides a set of tools to <br />
optimize the min_clust_size and min_sample parameters of HDBSCAN. It is written
to compliment BERTopic default models and assumes that HDBSCAN is being used
to cluster a UMAP reduction of embeddings. </p>

<p>A TMT instance can be initialized with the convenience TMT.wrapBERTopicModel() function which
returns a TMT instance initialized with the embedding model, HDBSCAN and UMAP
parameters in a given BERTopic model. Otherwise, a new TMT instance can be
created from scratch. In either case, once the optimized parameters have been identified
TMT.getBERTopicModel() will return a BERTopic instance with the desired parameters.</p>

<p>TMT does not explicitly provide functionality for testing alternative UMAP parameters or
HDBSCAN parameters other than min_cluster_size or min_samples. However both the HDBSCAN
and UMAP models are exposed within the class and can be set to any parameters desired.</p>
</div>


                            <div id="TopicModelTuner.__init__" class="classattr">
                                        <input id="TopicModelTuner.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TopicModelTuner</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">embeddings</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reducer_model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">hdbscan_model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">reducer_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span>)</span>

                <label class="view-source-button" for="TopicModelTuner.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.__init__-43"><a href="#TopicModelTuner.__init__-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-44"><a href="#TopicModelTuner.__init__-44"><span class="linenos">44</span></a>                 <span class="n">embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: pre-generated embeddings</span>
</span><span id="TopicModelTuner.__init__-45"><a href="#TopicModelTuner.__init__-45"><span class="linenos">45</span></a>                 <span class="n">embedding_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: set for alternative transformer embedding model</span>
</span><span id="TopicModelTuner.__init__-46"><a href="#TopicModelTuner.__init__-46"><span class="linenos">46</span></a>                 <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: can be set here or when embeddings are created manually</span>
</span><span id="TopicModelTuner.__init__-47"><a href="#TopicModelTuner.__init__-47"><span class="linenos">47</span></a>                 <span class="n">reducer_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: a UMAP instance</span>
</span><span id="TopicModelTuner.__init__-48"><a href="#TopicModelTuner.__init__-48"><span class="linenos">48</span></a>                 <span class="n">hdbscan_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#: an HDBSCAN instance</span>
</span><span id="TopicModelTuner.__init__-49"><a href="#TopicModelTuner.__init__-49"><span class="linenos">49</span></a>                 <span class="n">reducer_components</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="c1">#: for UMAP</span>
</span><span id="TopicModelTuner.__init__-50"><a href="#TopicModelTuner.__init__-50"><span class="linenos">50</span></a>                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span> <span class="c1">#: for UMAP</span>
</span><span id="TopicModelTuner.__init__-51"><a href="#TopicModelTuner.__init__-51"><span class="linenos">51</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.__init__-52"><a href="#TopicModelTuner.__init__-52"><span class="linenos">52</span></a><span class="sd">      Default initialization which assumes the BERTopic defaults for the embedding model </span>
</span><span id="TopicModelTuner.__init__-53"><a href="#TopicModelTuner.__init__-53"><span class="linenos">53</span></a><span class="sd">      (&#39;all-MiniLM-L6-v2&#39; sentence transformer) as well as HDBSCAN and UMAP parameters. </span>
</span><span id="TopicModelTuner.__init__-54"><a href="#TopicModelTuner.__init__-54"><span class="linenos">54</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner.__init__-55"><a href="#TopicModelTuner.__init__-55"><span class="linenos">55</span></a><span class="sd">      1) &#39;all-MiniLM-L6-v2&#39; sentence transformer as the default language model embedding.</span>
</span><span id="TopicModelTuner.__init__-56"><a href="#TopicModelTuner.__init__-56"><span class="linenos">56</span></a><span class="sd">      2) UMAP as the reduction method set to 5 features using the same parameters as BERTopic defaults to.</span>
</span><span id="TopicModelTuner.__init__-57"><a href="#TopicModelTuner.__init__-57"><span class="linenos">57</span></a><span class="sd">      3) HDBSCAN as the clustering mechansim</span>
</span><span id="TopicModelTuner.__init__-58"><a href="#TopicModelTuner.__init__-58"><span class="linenos">58</span></a>
</span><span id="TopicModelTuner.__init__-59"><a href="#TopicModelTuner.__init__-59"><span class="linenos">59</span></a><span class="sd">      Options include:</span>
</span><span id="TopicModelTuner.__init__-60"><a href="#TopicModelTuner.__init__-60"><span class="linenos">60</span></a>
</span><span id="TopicModelTuner.__init__-61"><a href="#TopicModelTuner.__init__-61"><span class="linenos">61</span></a><span class="sd">      - Using your own embeddings by setting TMT.embeddings after creating an instance</span>
</span><span id="TopicModelTuner.__init__-62"><a href="#TopicModelTuner.__init__-62"><span class="linenos">62</span></a><span class="sd">      - Using different UMAP settings or a different dimensional reduction method by setting TMT.reducer_model</span>
</span><span id="TopicModelTuner.__init__-63"><a href="#TopicModelTuner.__init__-63"><span class="linenos">63</span></a><span class="sd">      - Using different HDBSCAN parameters by setting TMT.hdbscan_model</span>
</span><span id="TopicModelTuner.__init__-64"><a href="#TopicModelTuner.__init__-64"><span class="linenos">64</span></a>
</span><span id="TopicModelTuner.__init__-65"><a href="#TopicModelTuner.__init__-65"><span class="linenos">65</span></a><span class="sd">      These can be set in the constructor or after instantiation by setting the instance variables.</span>
</span><span id="TopicModelTuner.__init__-66"><a href="#TopicModelTuner.__init__-66"><span class="linenos">66</span></a>
</span><span id="TopicModelTuner.__init__-67"><a href="#TopicModelTuner.__init__-67"><span class="linenos">67</span></a><span class="sd">      Unlike BERTopic, TMT has an option for saving both embeddings and the doc corpus - or optionally</span>
</span><span id="TopicModelTuner.__init__-68"><a href="#TopicModelTuner.__init__-68"><span class="linenos">68</span></a><span class="sd">      omitting them.</span>
</span><span id="TopicModelTuner.__init__-69"><a href="#TopicModelTuner.__init__-69"><span class="linenos">69</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.__init__-70"><a href="#TopicModelTuner.__init__-70"><span class="linenos">70</span></a>      
</span><span id="TopicModelTuner.__init__-71"><a href="#TopicModelTuner.__init__-71"><span class="linenos">71</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="c1">#: Passed through to UMAP</span>
</span><span id="TopicModelTuner.__init__-72"><a href="#TopicModelTuner.__init__-72"><span class="linenos">72</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span> <span class="c1">#: Can be set with pre-generated embedding</span>
</span><span id="TopicModelTuner.__init__-73"><a href="#TopicModelTuner.__init__-73"><span class="linenos">73</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="o">=</span><span class="n">reducer_components</span> 
</span><span id="TopicModelTuner.__init__-74"><a href="#TopicModelTuner.__init__-74"><span class="linenos">74</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.__init__-75"><a href="#TopicModelTuner.__init__-75"><span class="linenos">75</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">reducer_model</span>
</span><span id="TopicModelTuner.__init__-76"><a href="#TopicModelTuner.__init__-76"><span class="linenos">76</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="TopicModelTuner.__init__-77"><a href="#TopicModelTuner.__init__-77"><span class="linenos">77</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">hdbscan_model</span>
</span><span id="TopicModelTuner.__init__-78"><a href="#TopicModelTuner.__init__-78"><span class="linenos">78</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">ResultsDF</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.__init__-79"><a href="#TopicModelTuner.__init__-79"><span class="linenos">79</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner.__init__-80"><a href="#TopicModelTuner.__init__-80"><span class="linenos">80</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;paramPair&#39;</span><span class="p">,</span> <span class="s1">&#39;cs ss&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.__init__-81"><a href="#TopicModelTuner.__init__-81"><span class="linenos">81</span></a>
</span><span id="TopicModelTuner.__init__-82"><a href="#TopicModelTuner.__init__-82"><span class="linenos">82</span></a>      <span class="k">if</span> <span class="n">embedding_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.__init__-83"><a href="#TopicModelTuner.__init__-83"><span class="linenos">83</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="s1">&#39;all-MiniLM-L6-v2&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.__init__-84"><a href="#TopicModelTuner.__init__-84"><span class="linenos">84</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner.__init__-85"><a href="#TopicModelTuner.__init__-85"><span class="linenos">85</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">=</span><span class="n">embedding_model</span>
</span><span id="TopicModelTuner.__init__-86"><a href="#TopicModelTuner.__init__-86"><span class="linenos">86</span></a>          
</span><span id="TopicModelTuner.__init__-87"><a href="#TopicModelTuner.__init__-87"><span class="linenos">87</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner.__init__-88"><a href="#TopicModelTuner.__init__-88"><span class="linenos">88</span></a>      <span class="k">if</span> <span class="n">reducer_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> 
</span><span id="TopicModelTuner.__init__-89"><a href="#TopicModelTuner.__init__-89"><span class="linenos">89</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_components</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-90"><a href="#TopicModelTuner.__init__-90"><span class="linenos">90</span></a>                             <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-91"><a href="#TopicModelTuner.__init__-91"><span class="linenos">91</span></a>                             <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-92"><a href="#TopicModelTuner.__init__-92"><span class="linenos">92</span></a>                             <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
</span><span id="TopicModelTuner.__init__-93"><a href="#TopicModelTuner.__init__-93"><span class="linenos">93</span></a>                             <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="TopicModelTuner.__init__-94"><a href="#TopicModelTuner.__init__-94"><span class="linenos">94</span></a>          <span class="c1"># this is a kludge.  See below for test to see if UMAP model has been fitted.</span>
</span><span id="TopicModelTuner.__init__-95"><a href="#TopicModelTuner.__init__-95"><span class="linenos">95</span></a>          <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Default initialization which assumes the BERTopic defaults for the embedding model 
('all-MiniLM-L6-v2' sentence transformer) as well as HDBSCAN and UMAP parameters. </p>

<p>1) 'all-MiniLM-L6-v2' sentence transformer as the default language model embedding.
2) UMAP as the reduction method set to 5 features using the same parameters as BERTopic defaults to.
3) HDBSCAN as the clustering mechansim</p>

<p>Options include:</p>

<ul>
<li>Using your own embeddings by setting TMT.embeddings after creating an instance</li>
<li>Using different UMAP settings or a different dimensional reduction method by setting TMT.reducer_model</li>
<li>Using different HDBSCAN parameters by setting TMT.hdbscan_model</li>
</ul>

<p>These can be set in the constructor or after instantiation by setting the instance variables.</p>

<p>Unlike BERTopic, TMT has an option for saving both embeddings and the doc corpus - or optionally
omitting them.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.wrapBERTopicModel" class="classattr">
                                        <input id="TopicModelTuner.wrapBERTopicModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">wrapBERTopicModel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">BERTopicModel</span><span class="p">:</span> <span class="n">bertopic</span><span class="o">.</span><span class="n">_bertopic</span><span class="o">.</span><span class="n">BERTopic</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.wrapBERTopicModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.wrapBERTopicModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.wrapBERTopicModel-97"><a href="#TopicModelTuner.wrapBERTopicModel-97"><span class="linenos"> 97</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-98"><a href="#TopicModelTuner.wrapBERTopicModel-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">wrapBERTopicModel</span><span class="p">(</span><span class="n">BERTopicModel</span> <span class="p">:</span> <span class="n">BERTopic</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-99"><a href="#TopicModelTuner.wrapBERTopicModel-99"><span class="linenos"> 99</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-100"><a href="#TopicModelTuner.wrapBERTopicModel-100"><span class="linenos">100</span></a><span class="sd">      This is a helper function which returns a TMT instance using the values from a BERTopic instance.</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-101"><a href="#TopicModelTuner.wrapBERTopicModel-101"><span class="linenos">101</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-102"><a href="#TopicModelTuner.wrapBERTopicModel-102"><span class="linenos">102</span></a>  
</span><span id="TopicModelTuner.wrapBERTopicModel-103"><a href="#TopicModelTuner.wrapBERTopicModel-103"><span class="linenos">103</span></a>      <span class="k">return</span> <span class="n">TopicModelTuner</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-104"><a href="#TopicModelTuner.wrapBERTopicModel-104"><span class="linenos">104</span></a>                               <span class="n">reducer_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">umap_model</span><span class="p">,</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-105"><a href="#TopicModelTuner.wrapBERTopicModel-105"><span class="linenos">105</span></a>                               <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">BERTopicModel</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">,</span>
</span><span id="TopicModelTuner.wrapBERTopicModel-106"><a href="#TopicModelTuner.wrapBERTopicModel-106"><span class="linenos">106</span></a>                               <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This is a helper function which returns a TMT instance using the values from a BERTopic instance.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.getBERTopicModel" class="classattr">
                                        <input id="TopicModelTuner.getBERTopicModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getBERTopicModel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_cluster_size</span>, </span><span class="param"><span class="n">min_samples</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.getBERTopicModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.getBERTopicModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.getBERTopicModel-108"><a href="#TopicModelTuner.getBERTopicModel-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="nf">getBERTopicModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">):</span>
</span><span id="TopicModelTuner.getBERTopicModel-109"><a href="#TopicModelTuner.getBERTopicModel-109"><span class="linenos">109</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.getBERTopicModel-110"><a href="#TopicModelTuner.getBERTopicModel-110"><span class="linenos">110</span></a><span class="sd">      Returns a BERTopic model with the specified HDBSCAN parameters, regardles</span>
</span><span id="TopicModelTuner.getBERTopicModel-111"><a href="#TopicModelTuner.getBERTopicModel-111"><span class="linenos">111</span></a><span class="sd">      of whether or not the TMT instance was created using the default __init__() or </span>
</span><span id="TopicModelTuner.getBERTopicModel-112"><a href="#TopicModelTuner.getBERTopicModel-112"><span class="linenos">112</span></a><span class="sd">      the helper wrapBERTopicModel() funciton.</span>
</span><span id="TopicModelTuner.getBERTopicModel-113"><a href="#TopicModelTuner.getBERTopicModel-113"><span class="linenos">113</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner.getBERTopicModel-114"><a href="#TopicModelTuner.getBERTopicModel-114"><span class="linenos">114</span></a><span class="sd">      The user is left to specify their chosen best settings after running a series of </span>
</span><span id="TopicModelTuner.getBERTopicModel-115"><a href="#TopicModelTuner.getBERTopicModel-115"><span class="linenos">115</span></a><span class="sd">      candidate parameters.</span>
</span><span id="TopicModelTuner.getBERTopicModel-116"><a href="#TopicModelTuner.getBERTopicModel-116"><span class="linenos">116</span></a><span class="sd">      </span>
</span><span id="TopicModelTuner.getBERTopicModel-117"><a href="#TopicModelTuner.getBERTopicModel-117"><span class="linenos">117</span></a><span class="sd">      The reason for this function is to return a BERTopic instance with create a </span>
</span><span id="TopicModelTuner.getBERTopicModel-118"><a href="#TopicModelTuner.getBERTopicModel-118"><span class="linenos">118</span></a><span class="sd">      UMAP_facade object as an argument to the BERTopic initialization, since any </span>
</span><span id="TopicModelTuner.getBERTopicModel-119"><a href="#TopicModelTuner.getBERTopicModel-119"><span class="linenos">119</span></a><span class="sd">      given HDBSCAN parameter set will be specific to a particular run of UMAP. </span>
</span><span id="TopicModelTuner.getBERTopicModel-120"><a href="#TopicModelTuner.getBERTopicModel-120"><span class="linenos">120</span></a><span class="sd">      Just using a tuned HDBSCAN</span>
</span><span id="TopicModelTuner.getBERTopicModel-121"><a href="#TopicModelTuner.getBERTopicModel-121"><span class="linenos">121</span></a><span class="sd">      instance (or simply using the parameters derived from a tuning session) will </span>
</span><span id="TopicModelTuner.getBERTopicModel-122"><a href="#TopicModelTuner.getBERTopicModel-122"><span class="linenos">122</span></a><span class="sd">      not provide the best results in a new BERTopic instance. This is because BERTopic</span>
</span><span id="TopicModelTuner.getBERTopicModel-123"><a href="#TopicModelTuner.getBERTopicModel-123"><span class="linenos">123</span></a><span class="sd">      will re-run UMAP each time fit() is called. Different runs of UMAP will have slightly </span>
</span><span id="TopicModelTuner.getBERTopicModel-124"><a href="#TopicModelTuner.getBERTopicModel-124"><span class="linenos">124</span></a><span class="sd">      different characteristics and will therefore perform differently with different </span>
</span><span id="TopicModelTuner.getBERTopicModel-125"><a href="#TopicModelTuner.getBERTopicModel-125"><span class="linenos">125</span></a><span class="sd">      HDBSCAN settings. HDBSCAN on the other hand will always return the same values assuming</span>
</span><span id="TopicModelTuner.getBERTopicModel-126"><a href="#TopicModelTuner.getBERTopicModel-126"><span class="linenos">126</span></a><span class="sd">      that all the paremeters, and the data being clustered, are the same.</span>
</span><span id="TopicModelTuner.getBERTopicModel-127"><a href="#TopicModelTuner.getBERTopicModel-127"><span class="linenos">127</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.getBERTopicModel-128"><a href="#TopicModelTuner.getBERTopicModel-128"><span class="linenos">128</span></a>      <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.getBERTopicModel-129"><a href="#TopicModelTuner.getBERTopicModel-129"><span class="linenos">129</span></a>                                      <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.getBERTopicModel-130"><a href="#TopicModelTuner.getBERTopicModel-130"><span class="linenos">130</span></a>                                      <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner.getBERTopicModel-131"><a href="#TopicModelTuner.getBERTopicModel-131"><span class="linenos">131</span></a>                                      <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">,</span>
</span><span id="TopicModelTuner.getBERTopicModel-132"><a href="#TopicModelTuner.getBERTopicModel-132"><span class="linenos">132</span></a>                                      <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span>
</span><span id="TopicModelTuner.getBERTopicModel-133"><a href="#TopicModelTuner.getBERTopicModel-133"><span class="linenos">133</span></a>                                      <span class="p">)</span>
</span><span id="TopicModelTuner.getBERTopicModel-134"><a href="#TopicModelTuner.getBERTopicModel-134"><span class="linenos">134</span></a>
</span><span id="TopicModelTuner.getBERTopicModel-135"><a href="#TopicModelTuner.getBERTopicModel-135"><span class="linenos">135</span></a>      <span class="k">return</span> <span class="n">BERTopic</span><span class="p">(</span><span class="n">umap_model</span><span class="o">=</span><span class="n">UMAP_facade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span><span class="p">),</span>
</span><span id="TopicModelTuner.getBERTopicModel-136"><a href="#TopicModelTuner.getBERTopicModel-136"><span class="linenos">136</span></a>                      <span class="n">hdbscan_model</span><span class="o">=</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a BERTopic model with the specified HDBSCAN parameters, regardles
of whether or not the TMT instance was created using the default __init__() or 
the helper wrapBERTopicModel() funciton.</p>

<p>The user is left to specify their chosen best settings after running a series of 
candidate parameters.</p>

<p>The reason for this function is to return a BERTopic instance with create a 
UMAP_facade object as an argument to the BERTopic initialization, since any 
given HDBSCAN parameter set will be specific to a particular run of UMAP. 
Just using a tuned HDBSCAN
instance (or simply using the parameters derived from a tuning session) will 
not provide the best results in a new BERTopic instance. This is because BERTopic
will re-run UMAP each time fit() is called. Different runs of UMAP will have slightly 
different characteristics and will therefore perform differently with different 
HDBSCAN settings. HDBSCAN on the other hand will always return the same values assuming
that all the paremeters, and the data being clustered, are the same.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.createEmbeddings" class="classattr">
                                        <input id="TopicModelTuner.createEmbeddings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">createEmbeddings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">docs</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.createEmbeddings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.createEmbeddings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.createEmbeddings-139"><a href="#TopicModelTuner.createEmbeddings-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">createEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createEmbeddings-140"><a href="#TopicModelTuner.createEmbeddings-140"><span class="linenos">140</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.createEmbeddings-141"><a href="#TopicModelTuner.createEmbeddings-141"><span class="linenos">141</span></a><span class="sd">      Create embeddings using the embedding model specified during initiliazation.</span>
</span><span id="TopicModelTuner.createEmbeddings-142"><a href="#TopicModelTuner.createEmbeddings-142"><span class="linenos">142</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.createEmbeddings-143"><a href="#TopicModelTuner.createEmbeddings-143"><span class="linenos">143</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createEmbeddings-144"><a href="#TopicModelTuner.createEmbeddings-144"><span class="linenos">144</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Embeddings already created, reset by setting embeddings=None&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.createEmbeddings-145"><a href="#TopicModelTuner.createEmbeddings-145"><span class="linenos">145</span></a>        
</span><span id="TopicModelTuner.createEmbeddings-146"><a href="#TopicModelTuner.createEmbeddings-146"><span class="linenos">146</span></a>      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">docs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createEmbeddings-147"><a href="#TopicModelTuner.createEmbeddings-147"><span class="linenos">147</span></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Docs not specified, set docs=&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.createEmbeddings-148"><a href="#TopicModelTuner.createEmbeddings-148"><span class="linenos">148</span></a>        
</span><span id="TopicModelTuner.createEmbeddings-149"><a href="#TopicModelTuner.createEmbeddings-149"><span class="linenos">149</span></a>      <span class="k">if</span> <span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createEmbeddings-150"><a href="#TopicModelTuner.createEmbeddings-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">=</span><span class="n">docs</span>
</span><span id="TopicModelTuner.createEmbeddings-151"><a href="#TopicModelTuner.createEmbeddings-151"><span class="linenos">151</span></a>             
</span><span id="TopicModelTuner.createEmbeddings-152"><a href="#TopicModelTuner.createEmbeddings-152"><span class="linenos">152</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create embeddings using the embedding model specified during initiliazation.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.reduce" class="classattr">
                                        <input id="TopicModelTuner.reduce-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.reduce-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.reduce"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.reduce-155"><a href="#TopicModelTuner.reduce-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.reduce-156"><a href="#TopicModelTuner.reduce-156"><span class="linenos">156</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.reduce-157"><a href="#TopicModelTuner.reduce-157"><span class="linenos">157</span></a><span class="sd">      Reduce dimensionality of the embeddings</span>
</span><span id="TopicModelTuner.reduce-158"><a href="#TopicModelTuner.reduce-158"><span class="linenos">158</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.reduce-159"><a href="#TopicModelTuner.reduce-159"><span class="linenos">159</span></a>      <span class="k">try</span> <span class="p">:</span>
</span><span id="TopicModelTuner.reduce-160"><a href="#TopicModelTuner.reduce-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.reduce-161"><a href="#TopicModelTuner.reduce-161"><span class="linenos">161</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings set, call TMT.createEmbeddings() or set TMT.embeddings directly&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.reduce-162"><a href="#TopicModelTuner.reduce-162"><span class="linenos">162</span></a>      <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
</span><span id="TopicModelTuner.reduce-163"><a href="#TopicModelTuner.reduce-163"><span class="linenos">163</span></a>          <span class="k">pass</span> <span class="c1"># embeddings already set</span>
</span><span id="TopicModelTuner.reduce-164"><a href="#TopicModelTuner.reduce-164"><span class="linenos">164</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reduce dimensionality of the embeddings</p>
</div>


                            </div>
                            <div id="TopicModelTuner.createVizReduction" class="classattr">
                                        <input id="TopicModelTuner.createVizReduction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">createVizReduction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.createVizReduction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.createVizReduction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.createVizReduction-166"><a href="#TopicModelTuner.createVizReduction-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="nf">createVizReduction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createVizReduction-167"><a href="#TopicModelTuner.createVizReduction-167"><span class="linenos">167</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.createVizReduction-168"><a href="#TopicModelTuner.createVizReduction-168"><span class="linenos">168</span></a><span class="sd">      Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</span>
</span><span id="TopicModelTuner.createVizReduction-169"><a href="#TopicModelTuner.createVizReduction-169"><span class="linenos">169</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.createVizReduction-170"><a href="#TopicModelTuner.createVizReduction-170"><span class="linenos">170</span></a>      <span class="k">try</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createVizReduction-171"><a href="#TopicModelTuner.createVizReduction-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createVizReduction-172"><a href="#TopicModelTuner.createVizReduction-172"><span class="linenos">172</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No embeddings, either set TMT.embeddings= or call TMT.createEmbeddings()&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.createVizReduction-173"><a href="#TopicModelTuner.createVizReduction-173"><span class="linenos">173</span></a>      <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
</span><span id="TopicModelTuner.createVizReduction-174"><a href="#TopicModelTuner.createVizReduction-174"><span class="linenos">174</span></a>          <span class="k">pass</span> <span class="c1"># embeddings already set</span>
</span><span id="TopicModelTuner.createVizReduction-175"><a href="#TopicModelTuner.createVizReduction-175"><span class="linenos">175</span></a>
</span><span id="TopicModelTuner.createVizReduction-176"><a href="#TopicModelTuner.createVizReduction-176"><span class="linenos">176</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="p">)</span>
</span><span id="TopicModelTuner.createVizReduction-177"><a href="#TopicModelTuner.createVizReduction-177"><span class="linenos">177</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">n_components</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="TopicModelTuner.createVizReduction-178"><a href="#TopicModelTuner.createVizReduction-178"><span class="linenos">178</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Uses the reducer to create a 2D reduction of the embeddings to use for a scatter-plot representation</p>
</div>


                            </div>
                            <div id="TopicModelTuner.getVizCoords" class="classattr">
                                        <input id="TopicModelTuner.getVizCoords-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getVizCoords</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.getVizCoords-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.getVizCoords"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.getVizCoords-180"><a href="#TopicModelTuner.getVizCoords-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">getVizCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.getVizCoords-181"><a href="#TopicModelTuner.getVizCoords-181"><span class="linenos">181</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.getVizCoords-182"><a href="#TopicModelTuner.getVizCoords-182"><span class="linenos">182</span></a><span class="sd">      Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</span>
</span><span id="TopicModelTuner.getVizCoords-183"><a href="#TopicModelTuner.getVizCoords-183"><span class="linenos">183</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.getVizCoords-184"><a href="#TopicModelTuner.getVizCoords-184"><span class="linenos">184</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.getVizCoords-185"><a href="#TopicModelTuner.getVizCoords-185"><span class="linenos">185</span></a>          <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visualization reduction not performed, call createVizReduction first&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.getVizCoords-186"><a href="#TopicModelTuner.getVizCoords-186"><span class="linenos">186</span></a>
</span><span id="TopicModelTuner.getVizCoords-187"><a href="#TopicModelTuner.getVizCoords-187"><span class="linenos">187</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reducer</span><span class="o">.</span><span class="n">embedding_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Returns the X,Y coordinates for use in plotting a visualization of the embeddings.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.visualizeEmbeddings" class="classattr">
                                        <input id="TopicModelTuner.visualizeEmbeddings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualizeEmbeddings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_cluster_size</span>, </span><span class="param"><span class="n">sample_size</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.visualizeEmbeddings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.visualizeEmbeddings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.visualizeEmbeddings-190"><a href="#TopicModelTuner.visualizeEmbeddings-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">visualizeEmbeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-191"><a href="#TopicModelTuner.visualizeEmbeddings-191"><span class="linenos">191</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-192"><a href="#TopicModelTuner.visualizeEmbeddings-192"><span class="linenos">192</span></a><span class="sd">      Visualize the embeddings, clustered according to the provided parameters.</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-193"><a href="#TopicModelTuner.visualizeEmbeddings-193"><span class="linenos">193</span></a><span class="sd">      If docs has been set then the first 400 chars of each document will be </span>
</span><span id="TopicModelTuner.visualizeEmbeddings-194"><a href="#TopicModelTuner.visualizeEmbeddings-194"><span class="linenos">194</span></a><span class="sd">      shown as a hover over each data point.</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-195"><a href="#TopicModelTuner.visualizeEmbeddings-195"><span class="linenos">195</span></a><span class="sd">  </span>
</span><span id="TopicModelTuner.visualizeEmbeddings-196"><a href="#TopicModelTuner.visualizeEmbeddings-196"><span class="linenos">196</span></a><span class="sd">      Returns a plotly fig object</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-197"><a href="#TopicModelTuner.visualizeEmbeddings-197"><span class="linenos">197</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-198"><a href="#TopicModelTuner.visualizeEmbeddings-198"><span class="linenos">198</span></a>      <span class="n">topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runHDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-199"><a href="#TopicModelTuner.visualizeEmbeddings-199"><span class="linenos">199</span></a>
</span><span id="TopicModelTuner.visualizeEmbeddings-200"><a href="#TopicModelTuner.visualizeEmbeddings-200"><span class="linenos">200</span></a>      <span class="n">VizDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-201"><a href="#TopicModelTuner.visualizeEmbeddings-201"><span class="linenos">201</span></a>      <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVizCoords</span><span class="p">()</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-202"><a href="#TopicModelTuner.visualizeEmbeddings-202"><span class="linenos">202</span></a>
</span><span id="TopicModelTuner.visualizeEmbeddings-203"><a href="#TopicModelTuner.visualizeEmbeddings-203"><span class="linenos">203</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-204"><a href="#TopicModelTuner.visualizeEmbeddings-204"><span class="linenos">204</span></a>          <span class="n">wrappedtext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">]</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-205"><a href="#TopicModelTuner.visualizeEmbeddings-205"><span class="linenos">205</span></a>          <span class="n">VizDF</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrappedtext</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-206"><a href="#TopicModelTuner.visualizeEmbeddings-206"><span class="linenos">206</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-207"><a href="#TopicModelTuner.visualizeEmbeddings-207"><span class="linenos">207</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-208"><a href="#TopicModelTuner.visualizeEmbeddings-208"><span class="linenos">208</span></a>          <span class="n">hover_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-209"><a href="#TopicModelTuner.visualizeEmbeddings-209"><span class="linenos">209</span></a>          
</span><span id="TopicModelTuner.visualizeEmbeddings-210"><a href="#TopicModelTuner.visualizeEmbeddings-210"><span class="linenos">210</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">VizDF</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-211"><a href="#TopicModelTuner.visualizeEmbeddings-211"><span class="linenos">211</span></a>               <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-212"><a href="#TopicModelTuner.visualizeEmbeddings-212"><span class="linenos">212</span></a>               <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-213"><a href="#TopicModelTuner.visualizeEmbeddings-213"><span class="linenos">213</span></a>               <span class="n">hover_data</span> <span class="o">=</span> <span class="n">hover_data</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-214"><a href="#TopicModelTuner.visualizeEmbeddings-214"><span class="linenos">214</span></a>               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">])</span>
</span><span id="TopicModelTuner.visualizeEmbeddings-215"><a href="#TopicModelTuner.visualizeEmbeddings-215"><span class="linenos">215</span></a>
</span><span id="TopicModelTuner.visualizeEmbeddings-216"><a href="#TopicModelTuner.visualizeEmbeddings-216"><span class="linenos">216</span></a>      <span class="k">return</span> <span class="n">fig</span>    
</span></pre></div>


            <div class="docstring"><p>Visualize the embeddings, clustered according to the provided parameters.
If docs has been set then the first 400 chars of each document will be 
shown as a hover over each data point.</p>

<p>Returns a plotly fig object</p>
</div>


                            </div>
                            <div id="TopicModelTuner.runHDBSCAN" class="classattr">
                                        <input id="TopicModelTuner.runHDBSCAN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">runHDBSCAN</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_cluster_size</span>, </span><span class="param"><span class="n">sample_size</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.runHDBSCAN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.runHDBSCAN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.runHDBSCAN-220"><a href="#TopicModelTuner.runHDBSCAN-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="nf">runHDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.runHDBSCAN-221"><a href="#TopicModelTuner.runHDBSCAN-221"><span class="linenos">221</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.runHDBSCAN-222"><a href="#TopicModelTuner.runHDBSCAN-222"><span class="linenos">222</span></a><span class="sd">      Cluster reduced embeddings. sample_size must be more than 0 and less than</span>
</span><span id="TopicModelTuner.runHDBSCAN-223"><a href="#TopicModelTuner.runHDBSCAN-223"><span class="linenos">223</span></a><span class="sd">      or equal to min_cluster_size.</span>
</span><span id="TopicModelTuner.runHDBSCAN-224"><a href="#TopicModelTuner.runHDBSCAN-224"><span class="linenos">224</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.runHDBSCAN-225"><a href="#TopicModelTuner.runHDBSCAN-225"><span class="linenos">225</span></a>
</span><span id="TopicModelTuner.runHDBSCAN-226"><a href="#TopicModelTuner.runHDBSCAN-226"><span class="linenos">226</span></a>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
</span><span id="TopicModelTuner.runHDBSCAN-227"><a href="#TopicModelTuner.runHDBSCAN-227"><span class="linenos">227</span></a>          <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">HDBSCAN</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.runHDBSCAN-228"><a href="#TopicModelTuner.runHDBSCAN-228"><span class="linenos">228</span></a>                                      <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">,</span>
</span><span id="TopicModelTuner.runHDBSCAN-229"><a href="#TopicModelTuner.runHDBSCAN-229"><span class="linenos">229</span></a>                                      <span class="n">prediction_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner.runHDBSCAN-230"><a href="#TopicModelTuner.runHDBSCAN-230"><span class="linenos">230</span></a>                                      <span class="n">min_samples</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
</span><span id="TopicModelTuner.runHDBSCAN-231"><a href="#TopicModelTuner.runHDBSCAN-231"><span class="linenos">231</span></a>                                      <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">,</span>
</span><span id="TopicModelTuner.runHDBSCAN-232"><a href="#TopicModelTuner.runHDBSCAN-232"><span class="linenos">232</span></a>                                      <span class="p">)</span>
</span><span id="TopicModelTuner.runHDBSCAN-233"><a href="#TopicModelTuner.runHDBSCAN-233"><span class="linenos">233</span></a>      <span class="k">else</span> <span class="p">:</span>
</span><span id="TopicModelTuner.runHDBSCAN-234"><a href="#TopicModelTuner.runHDBSCAN-234"><span class="linenos">234</span></a>          <span class="n">hdbscan_model</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdbscan_model</span><span class="p">)</span>
</span><span id="TopicModelTuner.runHDBSCAN-235"><a href="#TopicModelTuner.runHDBSCAN-235"><span class="linenos">235</span></a>          <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_samples</span> <span class="o">=</span> <span class="n">sample_size</span>
</span><span id="TopicModelTuner.runHDBSCAN-236"><a href="#TopicModelTuner.runHDBSCAN-236"><span class="linenos">236</span></a>          <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">min_cluster_size</span> <span class="o">=</span> <span class="n">min_cluster_size</span>
</span><span id="TopicModelTuner.runHDBSCAN-237"><a href="#TopicModelTuner.runHDBSCAN-237"><span class="linenos">237</span></a>  
</span><span id="TopicModelTuner.runHDBSCAN-238"><a href="#TopicModelTuner.runHDBSCAN-238"><span class="linenos">238</span></a>      <span class="k">return</span> <span class="n">hdbscan_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reducer_model</span><span class="o">.</span><span class="n">embedding_</span><span class="p">)</span>  
</span></pre></div>


            <div class="docstring"><p>Cluster reduced embeddings. sample_size must be more than 0 and less than
or equal to min_cluster_size.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.randomSearch" class="classattr">
                                        <input id="TopicModelTuner.randomSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">randomSearch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cluster_size_range</span>, </span><span class="param"><span class="n">sample_size_pct_range</span>, </span><span class="param"><span class="n">iters</span><span class="o">=</span><span class="mi">20</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.randomSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.randomSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.randomSearch-295"><a href="#TopicModelTuner.randomSearch-295"><span class="linenos">295</span></a>    <span class="k">def</span> <span class="nf">randomSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.randomSearch-296"><a href="#TopicModelTuner.randomSearch-296"><span class="linenos">296</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genRandomSearchParams</span><span class="p">(</span><span class="n">cluster_size_range</span><span class="p">,</span> <span class="n">sample_size_pct_range</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span>
</span><span id="TopicModelTuner.randomSearch-297"><a href="#TopicModelTuner.randomSearch-297"><span class="linenos">297</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="TopicModelTuner.gridSearch" class="classattr">
                                        <input id="TopicModelTuner.gridSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gridSearch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cluster_sizes</span>, </span><span class="param"><span class="n">sample_sizes</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.gridSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.gridSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.gridSearch-299"><a href="#TopicModelTuner.gridSearch-299"><span class="linenos">299</span></a>    <span class="k">def</span> <span class="nf">gridSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.gridSearch-300"><a href="#TopicModelTuner.gridSearch-300"><span class="linenos">300</span></a>      <span class="n">searchParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genGridSearchParams</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span>
</span><span id="TopicModelTuner.gridSearch-301"><a href="#TopicModelTuner.gridSearch-301"><span class="linenos">301</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">(</span><span class="n">searchParams</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="TopicModelTuner.simpleSearch" class="classattr">
                                        <input id="TopicModelTuner.simpleSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">simpleSearch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cluster_sizes</span>, </span><span class="param"><span class="n">sample_sizes</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.simpleSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.simpleSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.simpleSearch-303"><a href="#TopicModelTuner.simpleSearch-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">simpleSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.simpleSearch-304"><a href="#TopicModelTuner.simpleSearch-304"><span class="linenos">304</span></a>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_sizes</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.simpleSearch-305"><a href="#TopicModelTuner.simpleSearch-305"><span class="linenos">305</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length of cluster sizes and samples sizes lists must match&#39;</span><span class="p">)</span>
</span><span id="TopicModelTuner.simpleSearch-306"><a href="#TopicModelTuner.simpleSearch-306"><span class="linenos">306</span></a>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runTests</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_paramPair</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cluster_sizes</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="p">)])</span>
</span></pre></div>


    

                            </div>
                            <div id="TopicModelTuner.visualizeSearch" class="classattr">
                                        <input id="TopicModelTuner.visualizeSearch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualizeSearch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">resultsDF</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.visualizeSearch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.visualizeSearch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.visualizeSearch-308"><a href="#TopicModelTuner.visualizeSearch-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">visualizeSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultsDF</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.visualizeSearch-309"><a href="#TopicModelTuner.visualizeSearch-309"><span class="linenos">309</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.visualizeSearch-310"><a href="#TopicModelTuner.visualizeSearch-310"><span class="linenos">310</span></a><span class="sd">      Runs iters number of randomly generated cluster size and sample range pairs</span>
</span><span id="TopicModelTuner.visualizeSearch-311"><a href="#TopicModelTuner.visualizeSearch-311"><span class="linenos">311</span></a><span class="sd">      against the embeddings. Note that sample sizes have to be a percentage value of </span>
</span><span id="TopicModelTuner.visualizeSearch-312"><a href="#TopicModelTuner.visualizeSearch-312"><span class="linenos">312</span></a><span class="sd">      a given cluster_size and cannot be 0. </span>
</span><span id="TopicModelTuner.visualizeSearch-313"><a href="#TopicModelTuner.visualizeSearch-313"><span class="linenos">313</span></a>
</span><span id="TopicModelTuner.visualizeSearch-314"><a href="#TopicModelTuner.visualizeSearch-314"><span class="linenos">314</span></a><span class="sd">      Returns both a plotly fig with a parrallel_coordinates chart of the run as well</span>
</span><span id="TopicModelTuner.visualizeSearch-315"><a href="#TopicModelTuner.visualizeSearch-315"><span class="linenos">315</span></a><span class="sd">      as a summarized version of the data produced by the run. Each run will produce</span>
</span><span id="TopicModelTuner.visualizeSearch-316"><a href="#TopicModelTuner.visualizeSearch-316"><span class="linenos">316</span></a><span class="sd">      its own summary table, but a history of all runs is also stored in the objects ResultsDF</span>
</span><span id="TopicModelTuner.visualizeSearch-317"><a href="#TopicModelTuner.visualizeSearch-317"><span class="linenos">317</span></a><span class="sd">      attribute.</span>
</span><span id="TopicModelTuner.visualizeSearch-318"><a href="#TopicModelTuner.visualizeSearch-318"><span class="linenos">318</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.visualizeSearch-319"><a href="#TopicModelTuner.visualizeSearch-319"><span class="linenos">319</span></a>    
</span><span id="TopicModelTuner.visualizeSearch-320"><a href="#TopicModelTuner.visualizeSearch-320"><span class="linenos">320</span></a>      <span class="c1"># if self.reducer_model.embedding_.sum() == 0  :</span>
</span><span id="TopicModelTuner.visualizeSearch-321"><a href="#TopicModelTuner.visualizeSearch-321"><span class="linenos">321</span></a>      <span class="c1">#     raise AttributeError(&#39;Reducer not run yet, call createReduction() first&#39;)</span>
</span><span id="TopicModelTuner.visualizeSearch-322"><a href="#TopicModelTuner.visualizeSearch-322"><span class="linenos">322</span></a>
</span><span id="TopicModelTuner.visualizeSearch-323"><a href="#TopicModelTuner.visualizeSearch-323"><span class="linenos">323</span></a>      <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">parallel_coordinates</span><span class="p">(</span><span class="n">resultsDF</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeSearch-324"><a href="#TopicModelTuner.visualizeSearch-324"><span class="linenos">324</span></a>                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> 
</span><span id="TopicModelTuner.visualizeSearch-325"><a href="#TopicModelTuner.visualizeSearch-325"><span class="linenos">325</span></a>                                    <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeSearch-326"><a href="#TopicModelTuner.visualizeSearch-326"><span class="linenos">326</span></a>                                            <span class="s2">&quot;sample_size&quot;</span><span class="p">:</span> <span class="s2">&quot;ample_size&quot;</span><span class="p">,</span> 
</span><span id="TopicModelTuner.visualizeSearch-327"><a href="#TopicModelTuner.visualizeSearch-327"><span class="linenos">327</span></a>                                            <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">:</span> <span class="s2">&quot;number_of_clusters&quot;</span><span class="p">,</span>
</span><span id="TopicModelTuner.visualizeSearch-328"><a href="#TopicModelTuner.visualizeSearch-328"><span class="linenos">328</span></a>                                            <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">:</span> <span class="s2">&quot;number_uncategorized&quot;</span><span class="p">,</span> <span class="p">},)</span>
</span><span id="TopicModelTuner.visualizeSearch-329"><a href="#TopicModelTuner.visualizeSearch-329"><span class="linenos">329</span></a>      <span class="k">return</span> <span class="n">fig</span>
</span></pre></div>


            <div class="docstring"><p>Runs iters number of randomly generated cluster size and sample range pairs
against the embeddings. Note that sample sizes have to be a percentage value of 
a given cluster_size and cannot be 0. </p>

<p>Returns both a plotly fig with a parrallel_coordinates chart of the run as well
as a summarized version of the data produced by the run. Each run will produce
its own summary table, but a history of all runs is also stored in the objects ResultsDF
attribute.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.summarizeResults" class="classattr">
                                        <input id="TopicModelTuner.summarizeResults-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">summarizeResults</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">summaryDF</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.summarizeResults-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.summarizeResults"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.summarizeResults-331"><a href="#TopicModelTuner.summarizeResults-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="nf">summarizeResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summaryDF</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.summarizeResults-332"><a href="#TopicModelTuner.summarizeResults-332"><span class="linenos">332</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.summarizeResults-333"><a href="#TopicModelTuner.summarizeResults-333"><span class="linenos">333</span></a><span class="sd">      Pass this a DataFrame with run results - either the summary DF from a given</span>
</span><span id="TopicModelTuner.summarizeResults-334"><a href="#TopicModelTuner.summarizeResults-334"><span class="linenos">334</span></a><span class="sd">      run or the historical table run and it will return a table where each record </span>
</span><span id="TopicModelTuner.summarizeResults-335"><a href="#TopicModelTuner.summarizeResults-335"><span class="linenos">335</span></a><span class="sd">      represents contains the smallest number of uncategorized documents for a given</span>
</span><span id="TopicModelTuner.summarizeResults-336"><a href="#TopicModelTuner.summarizeResults-336"><span class="linenos">336</span></a><span class="sd">      number of clusters.</span>
</span><span id="TopicModelTuner.summarizeResults-337"><a href="#TopicModelTuner.summarizeResults-337"><span class="linenos">337</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.summarizeResults-338"><a href="#TopicModelTuner.summarizeResults-338"><span class="linenos">338</span></a>      <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="TopicModelTuner.summarizeResults-339"><a href="#TopicModelTuner.summarizeResults-339"><span class="linenos">339</span></a>      <span class="k">for</span> <span class="n">num_clusters</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="p">:</span>
</span><span id="TopicModelTuner.summarizeResults-340"><a href="#TopicModelTuner.summarizeResults-340"><span class="linenos">340</span></a>            <span class="n">resultSummaryDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">resultSummaryDF</span><span class="p">,</span> <span class="n">summaryDF</span><span class="p">[</span><span class="n">summaryDF</span><span class="p">[</span><span class="s1">&#39;number_of_clusters&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">num_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;number_uncategorized&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]])</span>
</span><span id="TopicModelTuner.summarizeResults-341"><a href="#TopicModelTuner.summarizeResults-341"><span class="linenos">341</span></a>      <span class="n">resultSummaryDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TopicModelTuner.summarizeResults-342"><a href="#TopicModelTuner.summarizeResults-342"><span class="linenos">342</span></a>      <span class="k">return</span> <span class="n">resultSummaryDF</span>
</span></pre></div>


            <div class="docstring"><p>Pass this a DataFrame with run results - either the summary DF from a given
run or the historical table run and it will return a table where each record 
represents contains the smallest number of uncategorized documents for a given
number of clusters.</p>
</div>


                            </div>
                            <div id="TopicModelTuner.save" class="classattr">
                                        <input id="TopicModelTuner.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fname</span>,</span><span class="param">	<span class="n">save_docs</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">save_embeddings</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">save_viz_reduction</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.save-344"><a href="#TopicModelTuner.save-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TopicModelTuner.save-345"><a href="#TopicModelTuner.save-345"><span class="linenos">345</span></a>             <span class="n">fname</span><span class="p">,</span>
</span><span id="TopicModelTuner.save-346"><a href="#TopicModelTuner.save-346"><span class="linenos">346</span></a>             <span class="n">save_docs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner.save-347"><a href="#TopicModelTuner.save-347"><span class="linenos">347</span></a>             <span class="n">save_embeddings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TopicModelTuner.save-348"><a href="#TopicModelTuner.save-348"><span class="linenos">348</span></a>             <span class="n">save_viz_reduction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-349"><a href="#TopicModelTuner.save-349"><span class="linenos">349</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.save-350"><a href="#TopicModelTuner.save-350"><span class="linenos">350</span></a><span class="sd">      Saves the TMT object. User can choose whether or not to save docs, embeddings and/or</span>
</span><span id="TopicModelTuner.save-351"><a href="#TopicModelTuner.save-351"><span class="linenos">351</span></a><span class="sd">      the viz reduction</span>
</span><span id="TopicModelTuner.save-352"><a href="#TopicModelTuner.save-352"><span class="linenos">352</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.save-353"><a href="#TopicModelTuner.save-353"><span class="linenos">353</span></a>      
</span><span id="TopicModelTuner.save-354"><a href="#TopicModelTuner.save-354"><span class="linenos">354</span></a>      <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
</span><span id="TopicModelTuner.save-355"><a href="#TopicModelTuner.save-355"><span class="linenos">355</span></a>      <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span>
</span><span id="TopicModelTuner.save-356"><a href="#TopicModelTuner.save-356"><span class="linenos">356</span></a>      <span class="n">viz_reduction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span>
</span><span id="TopicModelTuner.save-357"><a href="#TopicModelTuner.save-357"><span class="linenos">357</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-358"><a href="#TopicModelTuner.save-358"><span class="linenos">358</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_docs</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-359"><a href="#TopicModelTuner.save-359"><span class="linenos">359</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.save-360"><a href="#TopicModelTuner.save-360"><span class="linenos">360</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_embeddings</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-361"><a href="#TopicModelTuner.save-361"><span class="linenos">361</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.save-362"><a href="#TopicModelTuner.save-362"><span class="linenos">362</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">save_viz_reduction</span> <span class="p">:</span>
</span><span id="TopicModelTuner.save-363"><a href="#TopicModelTuner.save-363"><span class="linenos">363</span></a>              <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TopicModelTuner.save-364"><a href="#TopicModelTuner.save-364"><span class="linenos">364</span></a>          <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="TopicModelTuner.save-365"><a href="#TopicModelTuner.save-365"><span class="linenos">365</span></a>          
</span><span id="TopicModelTuner.save-366"><a href="#TopicModelTuner.save-366"><span class="linenos">366</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
</span><span id="TopicModelTuner.save-367"><a href="#TopicModelTuner.save-367"><span class="linenos">367</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span>
</span><span id="TopicModelTuner.save-368"><a href="#TopicModelTuner.save-368"><span class="linenos">368</span></a>      <span class="bp">self</span><span class="o">.</span><span class="n">viz_reduction</span> <span class="o">=</span> <span class="n">viz_reduction</span>
</span></pre></div>


            <div class="docstring"><p>Saves the TMT object. User can choose whether or not to save docs, embeddings and/or
the viz reduction</p>
</div>


                            </div>
                            <div id="TopicModelTuner.load" class="classattr">
                                        <input id="TopicModelTuner.load-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">load</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fname</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TopicModelTuner.load-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TopicModelTuner.load"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TopicModelTuner.load-370"><a href="#TopicModelTuner.load-370"><span class="linenos">370</span></a>    <span class="nd">@staticmethod</span>    
</span><span id="TopicModelTuner.load-371"><a href="#TopicModelTuner.load-371"><span class="linenos">371</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">:</span>
</span><span id="TopicModelTuner.load-372"><a href="#TopicModelTuner.load-372"><span class="linenos">372</span></a>      <span class="sd">&#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.load-373"><a href="#TopicModelTuner.load-373"><span class="linenos">373</span></a><span class="sd">      Restore a saved TMT object from disk</span>
</span><span id="TopicModelTuner.load-374"><a href="#TopicModelTuner.load-374"><span class="linenos">374</span></a><span class="sd">      &#39;&#39;&#39;</span>
</span><span id="TopicModelTuner.load-375"><a href="#TopicModelTuner.load-375"><span class="linenos">375</span></a>      
</span><span id="TopicModelTuner.load-376"><a href="#TopicModelTuner.load-376"><span class="linenos">376</span></a>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span> <span class="p">:</span>    
</span><span id="TopicModelTuner.load-377"><a href="#TopicModelTuner.load-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Restore a saved TMT object from disk</p>
</div>


                            </div>
                </section>
                <section id="UMAP_facade">
                            <input id="UMAP_facade-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">UMAP_facade</span>:

                <label class="view-source-button" for="UMAP_facade-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UMAP_facade"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UMAP_facade-381"><a href="#UMAP_facade-381"><span class="linenos">381</span></a><span class="k">class</span> <span class="nc">UMAP_facade</span> <span class="p">:</span>
</span><span id="UMAP_facade-382"><a href="#UMAP_facade-382"><span class="linenos">382</span></a>    <span class="sd">&#39;&#39;&#39;</span>
</span><span id="UMAP_facade-383"><a href="#UMAP_facade-383"><span class="linenos">383</span></a><span class="sd">    Since by default BERTopic re-runs UMAP each time fit() is called,</span>
</span><span id="UMAP_facade-384"><a href="#UMAP_facade-384"><span class="linenos">384</span></a><span class="sd">    this class allows for a BERTopic instance to have fixed UMAP embedding. </span>
</span><span id="UMAP_facade-385"><a href="#UMAP_facade-385"><span class="linenos">385</span></a><span class="sd">    Necessary to achieve the best optimized HDBSCAN results because each </span>
</span><span id="UMAP_facade-386"><a href="#UMAP_facade-386"><span class="linenos">386</span></a><span class="sd">    UMAP reduction will vary and require slightly different HDBSCAN parameters.</span>
</span><span id="UMAP_facade-387"><a href="#UMAP_facade-387"><span class="linenos">387</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="UMAP_facade-388"><a href="#UMAP_facade-388"><span class="linenos">388</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">):</span>
</span><span id="UMAP_facade-389"><a href="#UMAP_facade-389"><span class="linenos">389</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="UMAP_facade-390"><a href="#UMAP_facade-390"><span class="linenos">390</span></a><span class="sd">        Pass in the umap_embeddings you want to optimize HDBSCAN for. </span>
</span><span id="UMAP_facade-391"><a href="#UMAP_facade-391"><span class="linenos">391</span></a><span class="sd">        &#39;&#39;&#39;</span> 
</span><span id="UMAP_facade-392"><a href="#UMAP_facade-392"><span class="linenos">392</span></a>
</span><span id="UMAP_facade-393"><a href="#UMAP_facade-393"><span class="linenos">393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings_</span> <span class="o">=</span> <span class="n">umap_embeddings</span>
</span><span id="UMAP_facade-394"><a href="#UMAP_facade-394"><span class="linenos">394</span></a>        
</span><span id="UMAP_facade-395"><a href="#UMAP_facade-395"><span class="linenos">395</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span>
</span><span id="UMAP_facade-396"><a href="#UMAP_facade-396"><span class="linenos">396</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="UMAP_facade-397"><a href="#UMAP_facade-397"><span class="linenos">397</span></a><span class="sd">        Does nothing except conform to the interface BERTopic expects.</span>
</span><span id="UMAP_facade-398"><a href="#UMAP_facade-398"><span class="linenos">398</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="UMAP_facade-399"><a href="#UMAP_facade-399"><span class="linenos">399</span></a>        
</span><span id="UMAP_facade-400"><a href="#UMAP_facade-400"><span class="linenos">400</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="UMAP_facade-401"><a href="#UMAP_facade-401"><span class="linenos">401</span></a>    
</span><span id="UMAP_facade-402"><a href="#UMAP_facade-402"><span class="linenos">402</span></a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="UMAP_facade-403"><a href="#UMAP_facade-403"><span class="linenos">403</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="UMAP_facade-404"><a href="#UMAP_facade-404"><span class="linenos">404</span></a><span class="sd">        Returns fixed embeddings,</span>
</span><span id="UMAP_facade-405"><a href="#UMAP_facade-405"><span class="linenos">405</span></a><span class="sd">        NOTE RE EMBEDDINGS PARAM</span>
</span><span id="UMAP_facade-406"><a href="#UMAP_facade-406"><span class="linenos">406</span></a><span class="sd">        &#39;&#39;&#39;</span> 
</span><span id="UMAP_facade-407"><a href="#UMAP_facade-407"><span class="linenos">407</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings_</span> 
</span></pre></div>


            <div class="docstring"><p>Since by default BERTopic re-runs UMAP each time fit() is called,
this class allows for a BERTopic instance to have fixed UMAP embedding. 
Necessary to achieve the best optimized HDBSCAN results because each 
UMAP reduction will vary and require slightly different HDBSCAN parameters.</p>
</div>


                            <div id="UMAP_facade.__init__" class="classattr">
                                        <input id="UMAP_facade.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">UMAP_facade</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">umap_embeddings</span></span>)</span>

                <label class="view-source-button" for="UMAP_facade.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UMAP_facade.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UMAP_facade.__init__-388"><a href="#UMAP_facade.__init__-388"><span class="linenos">388</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">):</span>
</span><span id="UMAP_facade.__init__-389"><a href="#UMAP_facade.__init__-389"><span class="linenos">389</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="UMAP_facade.__init__-390"><a href="#UMAP_facade.__init__-390"><span class="linenos">390</span></a><span class="sd">        Pass in the umap_embeddings you want to optimize HDBSCAN for. </span>
</span><span id="UMAP_facade.__init__-391"><a href="#UMAP_facade.__init__-391"><span class="linenos">391</span></a><span class="sd">        &#39;&#39;&#39;</span> 
</span><span id="UMAP_facade.__init__-392"><a href="#UMAP_facade.__init__-392"><span class="linenos">392</span></a>
</span><span id="UMAP_facade.__init__-393"><a href="#UMAP_facade.__init__-393"><span class="linenos">393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings_</span> <span class="o">=</span> <span class="n">umap_embeddings</span>
</span></pre></div>


            <div class="docstring"><p>Pass in the umap_embeddings you want to optimize HDBSCAN for.</p>
</div>


                            </div>
                            <div id="UMAP_facade.fit" class="classattr">
                                        <input id="UMAP_facade.fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="UMAP_facade.fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UMAP_facade.fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UMAP_facade.fit-395"><a href="#UMAP_facade.fit-395"><span class="linenos">395</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span>
</span><span id="UMAP_facade.fit-396"><a href="#UMAP_facade.fit-396"><span class="linenos">396</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="UMAP_facade.fit-397"><a href="#UMAP_facade.fit-397"><span class="linenos">397</span></a><span class="sd">        Does nothing except conform to the interface BERTopic expects.</span>
</span><span id="UMAP_facade.fit-398"><a href="#UMAP_facade.fit-398"><span class="linenos">398</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="UMAP_facade.fit-399"><a href="#UMAP_facade.fit-399"><span class="linenos">399</span></a>        
</span><span id="UMAP_facade.fit-400"><a href="#UMAP_facade.fit-400"><span class="linenos">400</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Does nothing except conform to the interface BERTopic expects.</p>
</div>


                            </div>
                            <div id="UMAP_facade.transform" class="classattr">
                                        <input id="UMAP_facade.transform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">transform</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="UMAP_facade.transform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UMAP_facade.transform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UMAP_facade.transform-402"><a href="#UMAP_facade.transform-402"><span class="linenos">402</span></a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
</span><span id="UMAP_facade.transform-403"><a href="#UMAP_facade.transform-403"><span class="linenos">403</span></a>        <span class="sd">&#39;&#39;&#39;</span>
</span><span id="UMAP_facade.transform-404"><a href="#UMAP_facade.transform-404"><span class="linenos">404</span></a><span class="sd">        Returns fixed embeddings,</span>
</span><span id="UMAP_facade.transform-405"><a href="#UMAP_facade.transform-405"><span class="linenos">405</span></a><span class="sd">        NOTE RE EMBEDDINGS PARAM</span>
</span><span id="UMAP_facade.transform-406"><a href="#UMAP_facade.transform-406"><span class="linenos">406</span></a><span class="sd">        &#39;&#39;&#39;</span> 
</span><span id="UMAP_facade.transform-407"><a href="#UMAP_facade.transform-407"><span class="linenos">407</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings_</span> 
</span></pre></div>


            <div class="docstring"><p>Returns fixed embeddings,
NOTE RE EMBEDDINGS PARAM</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>